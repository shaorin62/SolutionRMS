'****************************************************************************************
'Generated By   : MakeSFAR V.2.0.0 - 컨트롤 클래스 메이커
'시스템구분     : 솔루션명 /시스템명/Server Control Class
'실행   환경    : COM+ Service Server Package
'프로그램명     : ccTEST.vb
'기         능  : - 기능을 명시 합니다.
'특이  사항     : - 특이사항에 대해 표현
'                     -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 2004-03-30 오전 10:32:13 By MakeSFARV.2.0.0
'            2) 2004-03-30 오전 10:32:13 By 작성자명을 씁니다.
'****************************************************************************************

Imports System.Xml                        ' XML처리
Imports SCGLControl                       ' ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       ' ConfigurationClass
Imports SCGLUtil.cbSCGLErr            '오류처리 클래스
Imports SCGLUtil.cbSCGLXml           'XML처리 클래스
Imports SCGLUtil.cbSCGLUtil            '기타유틸리티 클래스
Imports ePDCO

' 엔티티 클래스 사용시 해당 엔티티 클래스의 프로젝트를 참조한 후 Imports 하십시요. 
' Imports 엔티티프로젝트

Public Class ccPDCOLOGIN
    Inherits ccControl

#Region "GROUP BLOCK : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccPDCOLOGIN"                  '자신의 클래스명
    'Private Const .DBConnStr = "Provider=SQLOLEDB;Data Source=10.110.10.86;Initial Catalog=MCDEV;DSN=MCDEV;UID=devadmin;Pwd=password"
    Private mobjceSC_EMPLOYEE_MST As ePDCO.ceSC_EMPLOYEE_MST           '사용할 Entity 변수 선언
#End Region

#Region "GROUP BLOCK : 외부에 공개 Method"


    Public Function SelectRtn_LOGINIDX(ByVal strInfoXML As String, _
                                       ByRef intRowCnt As Integer, _
                                       ByRef intColCnt As Integer, _
                                       ByVal strIDX As String, _
                                       ByVal strPASSWORD As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)

        strCols = "EMPNO,PASSWORD,EMP_NAME,CC_CODE,ISNULL(STARTLOGINDATE,'') STARTLOGINDATE"
        strWhere = "1=1"
        strFormat = "SELECT {0} FROM SC_EMPLOYEE_MST WHERE EMPNO = '" & strIDX & "' AND PASSWORD = '" & strPASSWORD & "' AND USE_YN = 'Y'"

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    Public Function SelectRtn_IDX(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strIDX As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)

        strCols = "USE_YN,EMPNO,PASSWORD,EMP_NAME,CC_CODE"
        strWhere = "1=1"
        strFormat = "SELECT {0} FROM SC_EMPLOYEE_MST WHERE EMPNO = '" & strIDX & "'"

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    'SelectRtn_Clipping
    Public Function SelectRtn_Clipping(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strIDX As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)

        strCols = "ISNULL(CLIPPINGLEVEL,0) CLIPPINGLEVEL"
        strWhere = "1=1"
        strFormat = "SELECT {0} FROM SC_EMPLOYEE_MST WHERE EMPNO = '" & strIDX & "'"

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_Clipping")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    Public Function SelectRtn_USER(ByVal strInfoXML As String, _
                                   ByRef intRowCnt As Integer, _
                                   ByRef intColCnt As Integer) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim strUSER As String
        SetConfig(strInfoXML) '기본정보 Setting


        strUSER = mobjSCGLConfig.WRKUSR
        strCols = "EMPNO,PASSWORD,EMP_NAME,CC_CODE,DBO.SC_DEPT_NAME_FUN(CC_CODE) DEPTNAME"
        strWhere = "1=1"
        strFormat = "SELECT {0} FROM SC_EMPLOYEE_MST WHERE EMPNO = '" & strUSER & "'"


        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_USER")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    Public Function SelectRtn_AUTH(ByVal strInfoXML As String, _
                                   ByRef intRowCnt As Integer, _
                                   ByRef intColCnt As Integer, _
                                   ByVal strPGMID As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim strUSER As String
        SetConfig(strInfoXML) '기본정보 Setting


        strUSER = mobjSCGLConfig.WRKUSR
        strCols = "PROGRAMID"
        strWhere = "1=1"
        strFormat = "SELECT {0} FROM SC_ROLE_MST WHERE USERID = '" & strUSER & "' AND PROGRAMID = '" & strPGMID & "'"


        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_AUTH")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function ClippingRtn(ByVal strInfoXML As String, _
                                ByVal strLoginIdx As String) As Integer
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strSEQ
        Dim strSQL As String
        SetConfig(strInfoXML) '기본정보 Setting

        With mobjSCGLConfig '기본정보를 가지고 있는 Config 개체

            Try
                'XML Element 변수 선언 (strMasterXML을 변환)
                Dim xmlRoot As XmlElement
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                mobjceSC_EMPLOYEE_MST = New ceSC_EMPLOYEE_MST(mobjSCGLConfig)

                strSQL = "UPDATE SC_EMPLOYEE_MST SET CLIPPINGLEVEL = ISNULL(CLIPPINGLEVEL,0) + 1 WHERE EMPNO = '" & strLoginIdx & "'"
                intRtn = mobjceSC_EMPLOYEE_MST.Clipping_Update(strSQL)


                '트랜잭션Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ClippingRtn")
            Finally
                'Resource해제
                .mobjSCGLSql.SQLDisconnect()
                mobjceSC_EMPLOYEE_MST.Dispose()
            End Try
        End With
    End Function
    Public Function ClippingEndRtn(ByVal strInfoXML As String, _
                                   ByVal strLoginIdx As String) As Integer
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strSEQ
        Dim strSQL As String
        SetConfig(strInfoXML) '기본정보 Setting

        With mobjSCGLConfig '기본정보를 가지고 있는 Config 개체

            Try
                'XML Element 변수 선언 (strMasterXML을 변환)
                Dim xmlRoot As XmlElement
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                mobjceSC_EMPLOYEE_MST = New ceSC_EMPLOYEE_MST(mobjSCGLConfig)

                strSQL = "UPDATE SC_EMPLOYEE_MST SET CLIPPINGLEVEL = 0,USE_YN = 'N' WHERE EMPNO = '" & strLoginIdx & "'"
                intRtn = mobjceSC_EMPLOYEE_MST.Clipping_Update(strSQL)


                '트랜잭션Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ClippingEndRtn")
            Finally
                'Resource해제
                .mobjSCGLSql.SQLDisconnect()
                mobjceSC_EMPLOYEE_MST.Dispose()
            End Try
        End With
    End Function
    'ProcessRtn_PwdUpdate
    Public Function ProcessRtn_PwdUpdate(ByVal strInfoXML As String, _
                                         ByVal strLoginIdx As String, _
                                         ByVal strPWD As String, _
                                         ByVal strDATE As String) As Integer
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strSEQ
        Dim strSQL As String
        SetConfig(strInfoXML) '기본정보 Setting

        With mobjSCGLConfig '기본정보를 가지고 있는 Config 개체

            Try
                'XML Element 변수 선언 (strMasterXML을 변환)
                Dim xmlRoot As XmlElement
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                mobjceSC_EMPLOYEE_MST = New ceSC_EMPLOYEE_MST(mobjSCGLConfig)

                strSQL = "UPDATE SC_EMPLOYEE_MST SET CLIPPINGLEVEL = 0,PASSWORD = '" & strPWD & "',STARTLOGINDATE = '" & strDATE & "' WHERE EMPNO = '" & strLoginIdx & "'"
                intRtn = mobjceSC_EMPLOYEE_MST.Clipping_Update(strSQL)


                '트랜잭션Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn_PwdUpdate")
            Finally
                'Resource해제
                .mobjSCGLSql.SQLDisconnect()
                mobjceSC_EMPLOYEE_MST.Dispose()
            End Try
        End With
    End Function
    Public Function ClippingCleanRtn(ByVal strInfoXML As String, _
                                   ByVal strLoginIdx As String) As Integer
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strSEQ
        Dim strSQL As String
        SetConfig(strInfoXML) '기본정보 Setting

        With mobjSCGLConfig '기본정보를 가지고 있는 Config 개체

            Try
                'XML Element 변수 선언 (strMasterXML을 변환)
                Dim xmlRoot As XmlElement
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                mobjceSC_EMPLOYEE_MST = New ceSC_EMPLOYEE_MST(mobjSCGLConfig)

                strSQL = "UPDATE SC_EMPLOYEE_MST SET CLIPPINGLEVEL = 0 WHERE EMPNO = '" & strLoginIdx & "'"
                intRtn = mobjceSC_EMPLOYEE_MST.Clipping_Update(strSQL)


                '트랜잭션Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ClippingCleanRtn")
            Finally
                'Resource해제
                .mobjSCGLSql.SQLDisconnect()
                mobjceSC_EMPLOYEE_MST.Dispose()
            End Try
        End With
    End Function
    '    Public Function strDETAIL_DIVAMT(ByVal strInfoXML As String, _
    '                                     ByVal vntData As Object) As Integer '데이터 INSERT/UPDATE
    '        Dim intRtn As Integer
    '        Dim i, intColCnt, intRows, intSEQ As Integer
    '        Dim dblID As Double '자동 ID 를사용할 때만 사용

    '        SetConfig(strInfoXML)
    '        With mobjSCGLConfig
    '            Try

    '                If IsArray(vntData) Then
    '                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
    '                    mobjceMD_TEST = New ceMD_TEST(mobjSCGLConfig)
    '                    '''vntData의 컬럼수, 로우수를 변수입력
    '                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
    '                    '''해당하는Row 만큼 Loop
    '                    Dim TETS

    '                    For i = 1 To intRows
    '                        intRtn = InsertRtn_MD_TEST(vntData, intColCnt, i)
    '                    Next
    '                End If

    '                Return intRows
    '            Catch err As Exception

    '                Throw RaiseSysErr(err, CLASS_NAME & ".strDETAIL_DIVAMT")
    '            Finally

    '                mobjceMD_TEST.Dispose()
    '            End Try
    '        End With
    '    End Function
#End Region

    '#Region "GROUP BLOCK : 외부에 비공개 Method"


    '    Private Function InsertRtn_MD_TEST(ByVal vntData As Object, ByVal intColCnt As Integer, ByVal intRow As Integer) As Integer
    '        Dim intRtn As Integer
    '        intRtn = mobjceMD_TEST.InsertDo(GetElement(vntData, "SEQ", intColCnt, intRow, NULL_NUM, True), _
    '                                        GetElement(vntData, "NAME", intColCnt, intRow, NULL_NUM, True), _
    '                                        GetElement(vntData, "ATTR01", intColCnt, intRow))
    '        Return intRtn
    '    End Function
    '#End Region
End Class
