'****************************************************************************************
'Generated By  : Kim Tae Ho 
'시스템구분    : RMS/PD/Server Control Class
'실행   환경   : COM+ Service Server Package
'프로그램명    : ccPDCMJOBNO.vb
'기         능 : - JOB Number 생성
'특이  사항    : - 
'                -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 2008.11.07 Kim Tae Ho
'            2) 
'****************************************************************************************

Imports System.Xml                  ' XML처리
Imports SCGLControl                 ' ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       ' ConfigurationClass
Imports SCGLUtil.cbSCGLErr          '오류처리 클래스
Imports SCGLUtil.cbSCGLXml          'XML처리 클래스
Imports SCGLUtil.cbSCGLUtil         '기타유틸리티 클래스
Imports ePDCO                       '엔터티 추가

' 엔티티 클래스 사용시 해당 엔티티 클래스의 프로젝트를 참조한 후 Imports 하십시요. 
' Imports 엔티티프로젝트PDCMACTUALRATE
Public Class ccPDCOACTUALRATE
    Inherits ccControl
#Region "GROUP BLOCK : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccPDCOACTUALRATE"                  '자신의 클래스명
    Private mobjcePD_JOBNO As ePDCO.cePD_JOBNO             '사용할 Entity 변수 선언
    Private mobjcePD_JOBNODEPT As ePDCO.cePD_JOBNODEPT
    Private mobjcePD_ACTUALRATE As ePDCO.cePD_ACTUALRATE


    'Private Const .DBConnStr = "Provider=SQLOLEDB;Data Source=10.110.10.86;Initial Catalog=MCDEV;DSN=MCDEV;UID=devadmin;Pwd=password"
#End Region

#Region "GROUP BLOCK : Function Section"


    '=============================================조회===============================================
    '==========================================================================
    ' =============== JOBNO 조회
    '==========================================================================

    Public Function SelectRtn(ByVal strInfoXML As String, _
                              ByRef intRowCnt As Integer, _
                              ByRef intColCnt As Integer, _
                              ByVal strFROM As String, _
                              ByVal strTO As String, _
                              ByVal strJOBNO As String, _
                              ByVal strJOBNAME As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strSubCols As String
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim Con1, Con2, Con3

        strCols = "V.PROJECTNO, V.JOBNAME, V.JOBNO, D.SEQ, "
        strCols = strCols & "DBO.SC_GET_HIGHCUSTNAME_FUN(V.CLIENTCODE) AS CLIENTNAME,"
        strCols = strCols & "DBO.SC_GET_CUSTNAME_FUN(V.TIMCODE) AS CLIENTSUBNAME,"
        strCols = strCols & "DBO.PD_JOBCUST_NAME_FUN(V.SUBSEQ) AS SUBSEQNAME,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.JOBGUBN) AS JOBGUBNNAME,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.CREPART) AS CREPARTNAME,"
        strCols = strCols & "V.REQDAY,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.ENDFLAG) AS ENDFLAGNAME"


        strSubCols = "PROJECTNO, JOBNAME, JOBNO, 1 SEQ, "
        strSubCols = strSubCols & "DBO.SC_GET_HIGHCUSTNAME_FUN(CLIENTCODE) AS CLIENTNAME,"
        strSubCols = strSubCols & "DBO.SC_GET_CUSTNAME_FUN(TIMCODE) AS CLIENTSUBNAME,"
        strSubCols = strSubCols & "DBO.PD_JOBCUST_NAME_FUN(SUBSEQ) AS SUBSEQNAME,"
        strSubCols = strSubCols & "DBO.MD_GETPUBNAME_FUN(JOBGUBN) AS JOBGUBNNAME,"
        strSubCols = strSubCols & "DBO.MD_GETPUBNAME_FUN(CREPART) AS CREPARTNAME,"
        strSubCols = strSubCols & "REQDAY,"
        strSubCols = strSubCols & "DBO.MD_GETPUBNAME_FUN(ENDFLAG) AS ENDFLAGNAME"


        If strFROM <> "" And strTO <> "" Then
            Con1 = String.Format(" AND (V.REQDAY BETWEEN '{0}' AND  '{1}')", strFROM, strTO)
        End If
        If strFROM <> "" And strTO = "" Then
            Con1 = String.Format(" AND (V.REQDAY >= '{0}')", strFROM)
        End If
        If strFROM = "" And strTO <> "" Then
            Con1 = String.Format(" AND (V.REQDAY <= '{0}')", strTO)
        End If


        If strJOBNO <> "" Then Con2 = String.Format(" AND (V.JOBNO = '{0}')", strJOBNO)
        If strJOBNAME <> "" Then Con3 = String.Format(" AND (V.JOBNAME LIKE '%{0}%')", strJOBNAME)


        strWhere = BuildFields(" ", Con1, Con2, Con3)

        strFormat = "SELECT {0} FROM v_JOBNO V, PD_DIVAMT D WHERE V.JOBNO = D.JOBNO {1}  "
        strFormat = strFormat & " UNION ALL "
        strFormat = strFormat & " SELECT * FROM(SELECT {2}  FROM V_JOBNO V WHERE 1=1 {1} ) a WHERE  "
        strFormat = strFormat & " NOT EXISTS ( SELECT JOBNO FROM PD_DIVAMT b WHERE a.JOBNO = b.JOBNO GROUP BY JOBNO) "


        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere, strSubCols)

            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
                ' ------ XML 데이터 조회
                'strXMLData = .mobjSCGLSql.SQLSelectXml(strSQL, intRowCnt, intColCnt)
                'Return strXMLData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function


    Public Function SelectRtn_Part(ByVal strInfoXML As String, _
                                   ByRef intRowCnt As Integer, _
                                   ByRef intColCnt As Integer, _
                                   ByVal strFROM As String, _
                                   ByVal strTO As String, _
                                   ByVal strJOBNO As String, _
                                   ByVal strJOBNAME As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strSubCols As String
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim Con1, Con2, Con3

        strCols = "V.PROJECTNO, V.JOBNAME, V.JOBNO, 1 SEQ, "
        strCols = strCols & "DBO.SC_GET_HIGHCUSTNAME_FUN(V.CLIENTCODE) AS CLIENTNAME,"
        strCols = strCols & "DBO.SC_GET_CUSTNAME_FUN(V.TIMCODE) AS CLIENTSUBNAME,"
        strCols = strCols & "DBO.PD_JOBCUST_NAME_FUN(V.SUBSEQ) AS SUBSEQNAME,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.JOBGUBN) AS JOBGUBNNAME,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.CREPART) AS CREPARTNAME,"
        strCols = strCols & "V.REQDAY,"
        strCols = strCols & "DBO.MD_GETPUBNAME_FUN(V.ENDFLAG) AS ENDFLAGNAME"


        


        If strFROM <> "" And strTO <> "" Then
            Con1 = String.Format(" AND (V.REQDAY BETWEEN '{0}' AND  '{1}')", strFROM, strTO)
        End If
        If strFROM <> "" And strTO = "" Then
            Con1 = String.Format(" AND (V.REQDAY >= '{0}')", strFROM)
        End If
        If strFROM = "" And strTO <> "" Then
            Con1 = String.Format(" AND (V.REQDAY <= '{0}')", strTO)
        End If


        If strJOBNO <> "" Then Con2 = String.Format(" AND (V.JOBNO = '{0}')", strJOBNO)
        If strJOBNAME <> "" Then Con3 = String.Format(" AND (V.JOBNAME LIKE '%{0}%')", strJOBNAME)


        strWhere = BuildFields(" ", Con1, Con2, Con3)

        strFormat = "SELECT {0} FROM v_JOBNO V WHERE 1=1 {1}  "


        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)

            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
                ' ------ XML 데이터 조회
                'strXMLData = .mobjSCGLSql.SQLSelectXml(strSQL, intRowCnt, intColCnt)
                'Return strXMLData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    '==========================================================================
    ' =============== JOBNODEPT 조회
    '==========================================================================
    Public Function SelectRtn_DTL_JOBNODEPT(ByVal strInfoXML As String, _
                                            ByRef intRowCnt As Integer, _
                                            ByRef intColCnt As Integer, _
                                            ByVal strJOBNO As String, _
                                            ByVal strJOBNOSEQ As String) As Object

        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim Con1, Con2

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            Try
                If strJOBNO <> "" Then Con1 = String.Format(" AND (JOBNO = '{0}')", strJOBNO)
                If strJOBNOSEQ <> "" Then Con2 = String.Format(" AND (JOBNOSEQ = '{0}')", strJOBNOSEQ)

                strWhere = BuildFields(" ", Con1, Con2)


                strFormat = " SELECT SEQ, "
                strFormat = strFormat & " DBO.SC_DEPT_NAME_FUN(DEPTCODE) AS DEPTNAME,"
                strFormat = strFormat & " DEPTCODE ,"
                strFormat = strFormat & " DBO.SC_EMPNAME_FUN(EMPNO) AS EMPNAME,"
                strFormat = strFormat & " EMPNO,JOBNOSEQ,ACTRATE"
                strFormat = strFormat & " FROM PD_JOBNODEPT"
                strFormat = strFormat & " WHERE 1=1 {0}"

                strSQL = String.Format(strFormat, strWhere)

                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function


    '==========================================================================
    ' =============== ACTUALRATE 조회
    '==========================================================================
    Public Function SelectRtn_DTL_ACTUALRATE(ByVal strInfoXML As String, _
                                             ByRef intRowCnt As Integer, _
                                             ByRef intColCnt As Integer, _
                                             ByVal strJOBNO As String, _
                                             ByVal strJOBNOSEQ As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim Con1, Con2


        strCols = " SEQ, "
        strCols = strCols & "DBO.SC_DEPT_NAME_FUN(ACTDEPTCD) AS ACTDEPTNAME,"
        strCols = strCols & "ACTDEPTCD ,"
        strCols = strCols & "ACTRATE,JOBNOSEQ"

        If strJOBNO <> "" Then Con1 = String.Format(" AND (JOBNO = '{0}')", strJOBNO)
        If strJOBNOSEQ <> "" Then Con2 = String.Format(" AND (JOBNOSEQ = '{0}')", strJOBNOSEQ)

        strWhere = BuildFields(" ", Con1, Con2)

        strFormat = "SELECT {0} FROM PD_ACTUALRATE WHERE 1=1 {1} "

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)

            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
                ' ------ XML 데이터 조회
                'strXMLData = .mobjSCGLSql.SQLSelectXml(strSQL, intRowCnt, intColCnt)
                'Return strXMLData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    '=============================================조회끝===============================================





    '=============================================저장 insert===============================================

    '==========================================================================
    ' ============== JOBNODEPT에 저장
    '==========================================================================
    Public Function ProcessRtn_DTL_JOBNODEPT(ByVal strInfoXML As String, _
                                             ByVal vntData As Object, _
                                             ByVal strJOBNO As String, _
                                             ByVal strJOBNOSEQ As String) As Integer '데이터 INSERT/UPDATE
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strNEWSEQ
        Dim dblJOBNOSEQ As Double
        Dim dblACTRATE As Double
        Dim dblSEQ As Double
        Dim strSQL As String

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                If IsArray(vntData) Then
                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjcePD_JOBNODEPT = New cePD_JOBNODEPT(mobjSCGLConfig)
                    '''vntData의 컬럼수, 로우수를 변수입력
                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
                    For i = 1 To intRows
                        'If GetElement(vntData, "CHK", intColCnt, i, OPTIONAL_STR) = 1 Then
                        dblACTRATE = CDbl(GetElement(vntData, "ACTRATE", intColCnt, i))

                        If GetElement(vntData, "SEQ", intColCnt, i, NULL_NUM, True) = -999999 Then
                            dblJOBNOSEQ = strJOBNOSEQ
                            strNEWSEQ = SelectRtn_SEQNO("PD_JOBNODEPT", strJOBNO)
                            intRtn = InsertRtn_DTL_JOBNODEPT(vntData, intColCnt, i, strJOBNO, strNEWSEQ, strJOBNOSEQ, CDbl(dblACTRATE))
                        Else
                            dblSEQ = GetElement(vntData, "SEQ", intColCnt, i, NULL_NUM, True)
                            intRtn = UpdateRtn_DTL_JOBNODEPT(vntData, intColCnt, i, strJOBNO, dblSEQ, dblACTRATE)
                        End If
                        'End If
                    Next
                End If
                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn_DTL_JOBNODEPT")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjcePD_JOBNODEPT.Dispose()
            End Try
        End With
    End Function


    '==========================================================================
    ' ============== ACTUALRATE에 저장
    '==========================================================================
    Public Function ProcessRtn_DTL_ACTUALRATE(ByVal strInfoXML As String, _
                                              ByVal vntData As Object, _
                                              ByVal strJOBNO As String, _
                                              ByVal strJOBNOSEQ As String) As Integer '데이터 INSERT/UPDATE
        Dim intRtn As Integer '결과값 변수
        Dim i, intColCnt, intRows As Integer '루프, 컬럼Cnt, 로우Cnt 변수
        Dim strNEWSEQ, strOLDSEQ
        Dim dblACTRATE
        Dim dblJOBNOSEQ As Double

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                If IsArray(vntData) Then
                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjcePD_ACTUALRATE = New cePD_ACTUALRATE(mobjSCGLConfig)
                    '''vntData의 컬럼수, 로우수를 변수입력
                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
                    For i = 1 To intRows
                        'If GetElement(vntData, "CHK", intColCnt, i, OPTIONAL_STR) = 1 Then
                        dblACTRATE = CDbl(GetElement(vntData, "ACTRATE", intColCnt, i))
                        If GetElement(vntData, "SEQ", intColCnt, i) = "" Then
                            dblJOBNOSEQ = strJOBNOSEQ
                            strNEWSEQ = SelectRtn_SEQNO("PD_ACTUALRATE", strJOBNO)
                            intRtn = InsertRtn_DTL_ACTUALRATE(vntData, intColCnt, i, strJOBNO, CInt(strNEWSEQ), CInt(strJOBNOSEQ), CDbl(dblACTRATE))
                        Else
                            strOLDSEQ = GetElement(vntData, "SEQ", intColCnt, i)
                            intRtn = UpdateRtn_DTL_ACTUALRATEL(vntData, intColCnt, i, strJOBNO, strOLDSEQ, dblACTRATE)
                        End If
                        'End If
                    Next
                End If
                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn_DTL_ACTUALRATE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjcePD_ACTUALRATE.Dispose()
            End Try
        End With

    End Function





    '==========================================================================
    '============== insert seq CODE 생성
    '==========================================================================
    Public Function SelectRtn_SEQNO(ByVal strEntity As String, _
                                    ByVal strJOBNO As String) As String

        Dim strSQL, strFormat, strRtn As String


        With mobjSCGLConfig '기본정보 Config 개체

            Try
                strSQL = "SELECT isnull(max(SEQ),0)+1 as SEQ FROM " & strEntity & " WHERE JOBNO = '" & strJOBNO & "'"
                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)
                Return strRtn
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_SEQNO")
            Finally
            End Try
        End With
    End Function

   
    '============== ProcessRtn JOBNO 삭제
    Public Function DeleteRtn_DTL_JOBNODEPT(ByVal strInfoXML As String, _
                                            ByVal strSEQ As String, _
                                            ByVal strJOBNO As String, _
                                            ByVal strJOBNOSEQ As String) As Integer

        Dim intRtn As Integer      'Return변수( 처리건수 또는 0 )

        SetConfig(strInfoXML)    '기본정보 Setting
        With mobjSCGLConfig    '기본정보 Config 개체
            Try
                ' 사용할Entity 개체생성(Config 정보를 넘겨생성)
                mobjcePD_JOBNODEPT = New cePD_JOBNODEPT(mobjSCGLConfig)
                ' DB 접속 및 트랜잭션 시작
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                ' 엔티티 오브젝트의 Delete 메소드 호출
                intRtn = mobjcePD_JOBNODEPT.DeleteDo(strSEQ, strJOBNO, strJOBNOSEQ)
                ' 트랜잭션 Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션 RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "DeleteRtn")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                '사용한 Entity(개체Dispose)
                mobjcePD_JOBNODEPT.Dispose()
            End Try
        End With
    End Function

    '============== ProcessRtn JOBNO 등록에서 삭제시, JOBNODEPT 바로삭제
    Public Function DeleteRtn_DTL_JOBNODEPT_JOBNO(ByVal strInfoXML As String, _
                                                  ByVal strSEQ As String, _
                                                  ByVal strJOBNO As String, _
                                                  ByVal strJOBNOSEQ As String) As Integer

        Dim intRtn As Integer      'Return변수( 처리건수 또는 0 )

        SetConfig(strInfoXML)    '기본정보 Setting
        With mobjSCGLConfig    '기본정보 Config 개체
            Try
                ' 사용할Entity 개체생성(Config 정보를 넘겨생성)
                mobjcePD_JOBNODEPT = New cePD_JOBNODEPT(mobjSCGLConfig)
                ' DB 접속 및 트랜잭션 시작
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                ' 엔티티 오브젝트의 Delete 메소드 호출
                intRtn = mobjcePD_JOBNODEPT.DeleteDo(strSEQ, strJOBNO, strJOBNOSEQ)
                ' 트랜잭션 Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션 RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "DeleteRtn")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                '사용한 Entity(개체Dispose)
                mobjcePD_JOBNODEPT.Dispose()
            End Try
        End With
    End Function

    '============== ProcessRtn JOBNO 등록에서 삭제시, JOBNODEPT 바로삭제
    Public Function DeleteRtn_DTL_JOBNODEPT_JOBNO2(ByVal strInfoXML As String, _
                                                   ByVal strJOBNO As String) As Integer

        Dim intRtn As Integer      'Return변수( 처리건수 또는 0 )

        SetConfig(strInfoXML)    '기본정보 Setting
        With mobjSCGLConfig    '기본정보 Config 개체
            Try
                ' 사용할Entity 개체생성(Config 정보를 넘겨생성)
                mobjcePD_JOBNODEPT = New cePD_JOBNODEPT(mobjSCGLConfig)
                ' DB 접속 및 트랜잭션 시작
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                ' 엔티티 오브젝트의 Delete 메소드 호출
                intRtn = mobjcePD_JOBNODEPT.DeleteDo2(strJOBNO)
                ' 트랜잭션 Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션 RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "DeleteRtn")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                '사용한 Entity(개체Dispose)
                mobjcePD_JOBNODEPT.Dispose()
            End Try
        End With
    End Function



    '============== ProcessRtn JOBNO 삭제
    Public Function DeleteRtn_DTL_ACTUALRATE(ByVal strInfoXML As String, _
                                             ByVal strSEQ As String, _
                                             ByVal strJOBNO As String, _
                                             ByVal strJOBNOSEQ As Double) As Integer

        Dim intRtn As Integer      'Return변수( 처리건수 또는 0 )

        SetConfig(strInfoXML)    '기본정보 Setting
        With mobjSCGLConfig    '기본정보 Config 개체
            Try
                ' 사용할Entity 개체생성(Config 정보를 넘겨생성)
                mobjcePD_ACTUALRATE = New cePD_ACTUALRATE(mobjSCGLConfig)
                ' DB 접속 및 트랜잭션 시작
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                ' 엔티티 오브젝트의 Delete 메소드 호출
                intRtn = mobjcePD_ACTUALRATE.DeleteDo(strSEQ, strJOBNO, strJOBNOSEQ)
                ' 트랜잭션 Commit
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                '트랜잭션 RollBack 및 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "DeleteRtn")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                '사용한 Entity(개체Dispose)
                mobjcePD_ACTUALRATE.Dispose()
            End Try
        End With
    End Function

#End Region


#Region "GROUP BLOCK 외부에 비공개: Entity Function Section"


    Private Function InsertRtn_DTL_JOBNODEPT(ByVal vntData As Object, _
                                             ByVal intColCnt As Integer, _
                                             ByVal intRow As Integer, _
                                             ByVal strJOBNO As String, _
                                             ByVal strNEWSEQ As String, _
                                             ByVal strJOBNOSEQ As String, _
                                             ByVal dblACTRATE As Double) As Integer

        Dim intRtn As Integer

        intRtn = mobjcePD_JOBNODEPT.InsertDo( _
                                              strJOBNO, _
                                              strNEWSEQ, _
                                              GetElement(vntData, "DEPTCODE", intColCnt, intRow), _
                                              GetElement(vntData, "EMPNO", intColCnt, intRow), _
                                              strJOBNOSEQ, _
                                              dblACTRATE)
        Return intRtn
    End Function



    Private Function InsertRtn_DTL_ACTUALRATE(ByVal vntData As Object, _
                                             ByVal intColCnt As Integer, _
                                             ByVal intRow As Integer, _
                                             ByVal strJOBNO As String, _
                                             ByVal strNEWSEQ As Integer, _
                                             ByVal strJOBNOSEQ As Integer, _
                                             ByVal dblACTRATE As Double) As Integer

        Dim intRtn As Integer

        intRtn = mobjcePD_ACTUALRATE.InsertDo( _
                                               strJOBNO, _
                                               strNEWSEQ, _
                                               GetElement(vntData, "ACTDEPTCD", intColCnt, intRow), _
                                               dblACTRATE, _
                                               strJOBNOSEQ)
        Return intRtn
    End Function





    Private Function UpdateRtn_DTL_JOBNODEPT(ByVal vntData As Object, _
                                             ByVal intColCnt As Integer, _
                                             ByVal intRow As Integer, _
                                             ByVal strJOBNO As String, _
                                             ByVal strOLDSEQ As String, _
                                             ByVal dblACTRATE As Double) As Integer

        Dim intRtn As Integer

        intRtn = mobjcePD_JOBNODEPT.UpdateDo( _
                                              strJOBNO, _
                                              GetElement(vntData, "SEQ", intColCnt, intRow), _
                                              GetElement(vntData, "DEPTCODE", intColCnt, intRow), _
                                              GetElement(vntData, "EMPNO", intColCnt, intRow), _
                                              GetElement(vntData, "JOBNOSEQ", intColCnt, intRow), _
                                              dblACTRATE)
        Return intRtn
    End Function



    Private Function UpdateRtn_DTL_ACTUALRATEL(ByVal vntData As Object, _
                                              ByVal intColCnt As Integer, _
                                              ByVal intRow As Integer, _
                                              ByVal strJOBNO As String, _
                                              ByVal strOLDSEQ As Integer, _
                                              ByVal dblACTRATE As Double) As Integer


        Dim intRtn As Integer

        intRtn = mobjcePD_ACTUALRATE.UpdateDo( _
                                               strJOBNO, _
                                               strOLDSEQ, _
                                               GetElement(vntData, "ACTDEPTCD", intColCnt, intRow), _
                                               dblACTRATE, _
                                               GetElement(vntData, "JOBNOSEQ", intColCnt, intRow))
        Return intRtn
    End Function

#End Region
End Class
