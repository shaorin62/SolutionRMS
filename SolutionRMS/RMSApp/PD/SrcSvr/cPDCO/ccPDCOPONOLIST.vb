'****************************************************************************************
'Generated By  : Kim Tae Ho 
'시스템구분    : RMS/PD/Server Control Class
'실행   환경   : COM+ Service Server Package
'프로그램명    : ccPDCMPONO.vb
'기         능 : - Project Number 생성
'특이  사항    : - 
'                -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 2008.11.07 Kim Tae Ho
'            2) 
'****************************************************************************************

Imports System.Xml                  ' XML처리
Imports SCGLControl                 ' ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       ' ConfigurationClass
Imports SCGLUtil.cbSCGLErr          '오류처리 클래스
Imports SCGLUtil.cbSCGLXml          'XML처리 클래스
Imports SCGLUtil.cbSCGLUtil         '기타유틸리티 클래스
Imports ePDCO                       '엔터티 추가

' 엔티티 클래스 사용시 해당 엔티티 클래스의 프로젝트를 참조한 후 Imports 하십시요. 
' Imports 엔티티프로젝트
Public Class ccPDCOPONOLIST
    Inherits ccControl
#Region "GROUP BLOCK : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccPDCOPONOLIST"                  '자신의 클래스명
    Private mobjcePD_PONO As ePDCO.cePD_PONO             '사용할 Entity 변수 선언
    'Private Const .DBConnStr = "Provider=SQLOLEDB;Data Source=10.110.10.86;Initial Catalog=MCDEV;DSN=MCDEV;UID=devadmin;Pwd=password"
#End Region

#Region "GROUP BLOCK : Function Section"
    ' =============== Project Code 조회
    Public Function SelectRtn(ByVal strInfoXML As String, _
                              ByRef intRowCnt As Integer, _
                              ByRef intColCnt As Integer, _
                              ByVal strFROM As String, _
                              ByVal strTO As String, _
                              ByVal strPONAME As String, _
                              ByVal strPONO As String, _
                              ByVal strCLIENTNAME As String, _
                              ByVal strCLIENTCODE As String) As Object

        Dim strCols As String         '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String          'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String    'XML  Return 변수(XML  을 사용할 때 선언)
        Dim Con1, Con2, Con3, Con4, Con5

        strCols = " PROJECTNO,"
        strCols = strCols & " PROJECTNM,"
        strCols = strCols & " CLIENTCODE,"
        strCols = strCols & " DBO.MD_GET_CUSTNAME_FUN(CLIENTCODE) CLIENTNAME,"
        strCols = strCols & " CLIENTSUBCODE,"
        strCols = strCols & " DBO.MD_GET_CUSTNAME_FUN(CLIENTSUBCODE)CLIENTSUBNAME,"
        strCols = strCols & " SUBSEQ,"
        strCols = strCols & " DBO.PD_JOBCUST_NAME_FUN(SUBSEQ) SUBSEQNAME,"
        strCols = strCols & " CASE ISNULL(GROUPGBN,'') WHEN '2' THEN '그룹' ELSE '비그룹' END AS GROUPGBN,"
        strCols = strCols & " CREDAY,"
        strCols = strCols & " CPDEPTCD,"
        strCols = strCols & " DBO.SC_DEPT_NAME_FUN(CPDEPTCD) CPDEPTNAME,"
        strCols = strCols & " CPEMPNO,"
        strCols = strCols & " DBO.SC_EMPNAME_FUN(CPEMPNO) CPEMPNAME,"
        strCols = strCols & " MEMO"

        If strFROM <> "" And strTO <> "" Then
            Con1 = String.Format(" AND (CREDAY BETWEEN '{0}' AND  '{1}')", strFROM, strTO)
        End If
        If strFROM <> "" And strTO = "" Then
            Con1 = String.Format(" AND (CREDAY > '{0}')", strFROM)
        End If
        If strFROM = "" And strTO <> "" Then
            Con1 = String.Format(" AND (CREDAY < '{0}')", strTO)
        End If


        If strPONAME <> "" Then Con2 = String.Format(" AND (PROJECTNM like '%{0}%')", strPONAME)
        If strPONO <> "" Then Con3 = String.Format(" AND (PROJECTNO = '{0}')", strPONO)
        If strCLIENTNAME <> "" Then Con4 = String.Format(" AND (LTRIM(DBO.MD_GET_CUSTNAME_FUN(CLIENTCODE)) like '%{0}%')", strCLIENTNAME)
        If strCLIENTCODE <> "" Then Con5 = String.Format(" AND (CLIENTCODE = '{0}')", strCLIENTCODE)
        strWhere = BuildFields(" ", Con1, Con2, Con3, Con4, Con5)
        strFormat = "SELECT {0} FROM PD_PONO WHERE 1=1 {1} ORDER BY PROJECTNO"

        SetConfig(strInfoXML) '기본정보 Setting
        With mobjSCGLConfig '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
                ' ------ XML 데이터 조회
                'strXMLData = .mobjSCGLSql.SQLSelectXml(strSQL, intRowCnt, intColCnt)
                'Return strXMLData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function


    Public Function SelectRtn_JOB(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strPONO As String) As Object

        Dim strCols As String        '컬럼변수
        Dim strWhere As String       'Where조건 변수
        Dim strFormat As String      'SQL Format 변수
        Dim strSQL As String         'SQL 변수
        Dim vntData As Object        'Array Return 변수(Array 를사용할 때 선언)
        Dim strXMLData As String     'XML  Return 변수(XML  을 사용할 때 선언)
        Dim Con1


        If strPONO <> "" Then Con1 = String.Format(" AND (PROJECTNO = '{0}')", strPONO)

        strWhere = BuildFields(" ", Con1)

        strCols = " PROJECTNO, "
        strCols = strCols & " JOBNO,"
        strCols = strCols & " JOBNAME,"
        strCols = strCols & " DBO.MD_GET_CUSTNAME_FUN(CLIENTCODE) CLIENTNAME,"
        strCols = strCols & " CLIENTSUBCODE,"
        strCols = strCols & " DBO.MD_GET_CUSTNAME_FUN(CLIENTSUBCODE) CLIENTSUBNAME,"
        strCols = strCols & " SUBSEQ,"
        strCols = strCols & " DBO.PD_JOBCUST_NAME_FUN(SUBSEQ) SUBSEQNAME,"
        strCols = strCols & " DBO.MD_GETPUBNAME_FUN(ENDFLAG) ENDFLAG,"
        strCols = strCols & " DBO.MD_GETPUBNAME_FUN(JOBGUBN) JOBGUBN,"
        strCols = strCols & " DBO.MD_GETPUBNAME_FUN(CREPART) CREPART,"
        strCols = strCols & " DBO.MD_GETPUBNAME_FUN(CREGUBN) CREGUBN,"
        strCols = strCols & " REQDAY,DBO.PD_COMMITION_FUN(CLIENTCODE) COMMITION,CLIENTCODE,PREESTNO"

        strFormat = "SELECT {0} FROM V_JOBNO WHERE 1=1 {1} ORDER BY JOBNO DESC"

        SetConfig(strInfoXML)   '기본정보 Setting
        With mobjSCGLConfig     '기본정보 Config 개체
            strSQL = String.Format(strFormat, strCols, strWhere)
            Try
                ' DB 접속
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                ' DB 접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
#End Region
#Region "GROUP BLOCK : Entity Function Section"

#End Region
End Class
