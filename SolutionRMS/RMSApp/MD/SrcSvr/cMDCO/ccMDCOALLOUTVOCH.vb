'****************************************************************************************
'Generated By: MakeSFAR V.2.0.0 - 컨트롤 클래스 메이커
'시스템구분    : 솔루션명 /시스템명/Server Control Class
'실행   환경    : COM+ Service Server Package
'프로그램명    : ccMDCMDEPTMST.vb
'기         능    : - 기능을 명시 합니다.
'특이  사항     : - 특이사항에 대해 표현
'                     -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 
'            2) 
'****************************************************************************************

Imports System.Xml                  ' XML처리
Imports SCGLControl                 ' ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       ' ConfigurationClass
Imports SCGLUtil.cbSCGLErr          '오류처리 클래스
Imports SCGLUtil.cbSCGLXml          'XML처리 클래스
Imports SCGLUtil.cbSCGLUtil         '기타유틸리티 클래스
Imports eMDCO                       '엔터티 추가

' 엔티티 클래스 사용시 해당 엔티티 클래스의 프로젝트를 참조한 후 Imports 하십시요. 
' Imports 엔티티프로젝트

Public Class ccMDCOALLOUTVOCH
    Inherits ccControl
#Region "GROUP BLOCK : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccMDCOALLOUTVOCH"                  '자신의 클래스명
    Private mobjceMD_TRUVOCH_MST As eMDCO.ceMD_TRUVOCH_MST
#End Region

#Region "GROUP BLOCK : 외부에비공개"
    Public Function Get_COMBO_VALUE(ByVal strInfoXML As String, _
                                    ByRef intRowCnt As Integer, _
                                    ByRef intColCnt As Integer, _
                                    ByVal strCODE As String) As Object

        Dim strSQL, strFormat, strSelFields As String
        Dim vntData As Object

        SetConfig(strInfoXML)   '기본정보 설정					

        '조회 필드 설정					
        strSelFields = "CODE, CODE_NAME"

        'SQL문 생성
        strFormat = "SELECT {0} " & _
                    "FROM SC_CODE " & _
                    "WHERE CLASS_CODE = '" & strCODE & "' and use_yn = 'Y'" & _
                    "ORDER BY SORT_SEQ "

        With mobjSCGLConfig
            strSQL = String.Format(strFormat, strSelFields)
            ''데이터 조회
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".Get_COMBO_VALUE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function Get_SUBCOMBO_VALUE(ByVal strInfoXML As String, _
                                       ByRef intRowCnt As Integer, _
                                       ByRef intColCnt As Integer, _
                                       ByVal strCODE As String) As Object

        Dim strSQL, strFormat As String
        Dim vntData As Object

        SetConfig(strInfoXML)   '기본정보 설정					

        '조회 필드 설정					
        strFormat = " SELECT "
        strFormat = strFormat & " BANK_TYPE CODE, "
        strFormat = strFormat & " BANK_TYPE CODE_NAME "
        strFormat = strFormat & " FROM SC_BANKTYPE_MST"
        strFormat = strFormat & " WHERE 1=1"
        strFormat = strFormat & " AND REPLACE(BUSINO,'-','') = '" & strCODE & "'"
        strFormat = strFormat & " AND USE_YN = 'Y'"

        With mobjSCGLConfig
            strSQL = String.Format(strFormat)

            ''데이터 조회
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".Get_SUBCOMBO_VALUE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_OUT(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strYEARMON As String, _
                                  ByVal strEDYEARMON As String, _
                                  ByVal strCLIENTCODE As String, _
                                  ByVal strCLIENTNAME As String, _
                                  ByVal strGBN As String, _
                                  ByVal strEXCLIENTCODE As String, _
                                  ByVal strEXCLIENTNAME As String) As Object

        Dim strSQL, strFormat, strWhere, strAND As String
        Dim vntData As Object
        Dim Con1, Con2, Con3, Con4 As String

        Con1 = "" : Con2 = "" : Con3 = "" : Con4 = ""

        SetConfig(strInfoXML)   '기본정보 설정
        With mobjSCGLConfig

            If strYEARMON <> "" And strEDYEARMON <> "" Then
                Con4 = String.Format(" AND (YEARMON BETWEEN '{0}' AND  '{1}')", strYEARMON, strEDYEARMON)
            End If
            If strYEARMON <> "" And strEDYEARMON = "" Then
                Con4 = String.Format(" AND (YEARMON >= '{0}')", strYEARMON)
            End If
            If strYEARMON = "" And strEDYEARMON <> "" Then
                Con4 = String.Format(" AND (YEARMON <= '{0}')", strEDYEARMON)
            End If

            If strCLIENTCODE <> "" Then Con1 = String.Format(" AND C.CLIENTCODE = '{0}'", strCLIENTCODE)

            If strGBN <> "" Then
                If strGBN = "rdT" Then
                    Con2 = " AND ISNULL(C.VOCHNO,'') <> '' "
                ElseIf strGBN = "rdF" Then
                    Con2 = " AND ISNULL(C.VOCHNO,'') = '' AND ISNULL(D.ERRMSG,'') = '' "
                ElseIf strGBN = "rdE" Then
                    Con2 = " AND ISNULL(D.ERRMSG,'') <> '' "
                ElseIf strGBN = "rdA" Then
                    Con2 = " "
                End If
            End If

            If strEXCLIENTCODE <> "" Then Con3 = String.Format(" AND DBO.SC_GET_BUSINO_FUN(C.EXCLIENTCODE) = DBO.SC_GET_BUSINO_FUN('{0}')", strEXCLIENTCODE)

            '조회 필드 설정
            strWhere = BuildFields(" ", Con1, Con2, Con3)
            strAND = BuildFields(" ", Con4)

            strFormat = strFormat & " SELECT "
            strFormat = strFormat & " 0 CHK,"
            strFormat = strFormat & " C.GFLAG, "
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.POSTINGDATE ELSE D.POSTINGDATE END POSTINGDATE,"
            strFormat = strFormat & " C.CLIENTNAME,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.CUSTOMERCODE ELSE D.CUSTOMERCODE END CUSTOMERCODE,"
            strFormat = strFormat & " C.CUSTNAME,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.SUMM ELSE D.SUMM END SUMM,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.BA ELSE D.BA END BA,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.COSTCENTER ELSE D.COSTCENTER END COSTCENTER,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.AMT ELSE D.SUMAMT END AMT,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.VAT ELSE D.VAT END VAT,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.SEMU ELSE D.SEMU END SEMU,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.BP ELSE D.BP END BP,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.DEMANDDAY ELSE D.DEMANDDAY END DEMANDDAY,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.DUEDATE ELSE D.DUEDATE END DUEDATE,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.VENDOR ELSE D.VENDOR END VENDOR,"
            strFormat = strFormat & " C.VENDORNAME,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.GBN ELSE D.GBN END GBN, "
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.ACCOUNT ELSE D.ACCOUNT END ACCOUNT,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.DEBTOR ELSE D.DEBTOR END DEBTOR,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.BMORDER ELSE D.BMORDER END AS  BMORDER,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN '' ELSE D.BANKTYPE END AS  BANKTYPE,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.documentdate ELSE D.documentdate END documentdate,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.prepayment ELSE D.prepayment END prepayment,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.fromdate ELSE D.fromdate END fromdate,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.todate ELSE D.todate END todate,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.SUMMTEXT ELSE D.SUMMTEXT END SUMMTEXT,"
            strFormat = strFormat & " C.AMTGBN,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.TAXYEARMON ELSE D.TAXYEARMON END TAXYEARMON,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.TAXNO ELSE D.TAXNO END TAXNO,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.VOCHNO ELSE D.VOCHNO END VOCHNO,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.RMSNO ELSE D.RMSNO END RMSNO,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.ERRCODE ELSE D.ERRCODE END ERRCODE,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.ERRMSG ELSE D.ERRMSG END ERRMSG,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.PAYCODE ELSE D.PAYCODE END PAYCODE,"
            strFormat = strFormat & " CASE ISNULL(D.POSTINGDATE,'') WHEN '' THEN C.MEDFLAG ELSE D.MEDFLAG END MEDFLAG,"
            strFormat = strFormat & " DENSE_RANK() OVER (ORDER BY C.EX_BISNO DESC) TRANSRANK,"
            strFormat = strFormat & " C.CLIENTCODE,"
            strFormat = strFormat & " C.EXCLIENTCODE,"
            strFormat = strFormat & " C.INPUT_MEDFLAG,"
            strFormat = strFormat & " CASE C.INPUT_MEDFLAG WHEN '01' THEN 'TV' WHEN '02' THEN 'RD' WHEN '10' THEN 'DMB' WHEN 'B' THEN '인쇄' WHEN 'A2' THEN '케이블' WHEN 'O' THEN '옥외' WHEN 'T' THEN '종편' ELSE '' END MEDFLAGNAME,"
            strFormat = strFormat & " C.DEPT_CD, GUBUN "
            strFormat = strFormat & " FROM (	"
            strFormat = strFormat & " 	SELECT "
            strFormat = strFormat & " 	GFLAG, POSTINGDATE, CLIENTNAME, CUSTOMERCODE, CUSTNAME, SUMM, BA, COSTCENTER, "
            strFormat = strFormat & " 	AMT, VAT, SEMU, BP, DEMANDDAY, DUEDATE, VENDOR, VENDORNAME, GBN, ACCOUNT, DEBTOR, BMORDER, "
            strFormat = strFormat & " 	documentdate, prepayment, fromdate, todate, SUMMTEXT, AMTGBN, TAXYEARMON, "
            strFormat = strFormat & " 	CASE ISNULL(ATTR06,0) WHEN 0 THEN  "
            strFormat = strFormat & " 		ROW_NUMBER() OVER ("
            strFormat = strFormat & " 		ORDER BY CLIENTCODE, DBO.SC_GET_BUSINO_FUN(EXCLIENTCODE), DEPT_CD, ISNULL(ATTR06,0)) + "
            strFormat = strFormat & " 				("
            strFormat = strFormat & " 					SELECT MAX(ATTR06) FROM ("
            strFormat = strFormat & " 						SELECT ISNULL(ATTR06,0) ATTR06 FROM MD_ELECTRIC_MEDIUM"
            strFormat = strFormat & " 						WHERE 1=1 "
            strFormat = strFormat & " 						{0} "
            strFormat = strFormat & " 						AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 						UNION ALL"
            strFormat = strFormat & " 						SELECT ISNULL(ATTR06,0) ATTR06 FROM MD_CATV_MEDIUM"
            strFormat = strFormat & " 						WHERE 1=1 "
            strFormat = strFormat & " 						{0} "
            strFormat = strFormat & " 						AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & "                       UNION ALL"
            strFormat = strFormat & " 						SELECT ISNULL(ATTR06,0) ATTR06 FROM MD_TOTAL_MEDIUM"
            strFormat = strFormat & " 						WHERE 1=1 "
            strFormat = strFormat & " 						{0} "
            strFormat = strFormat & " 						AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 						UNION ALL"
            strFormat = strFormat & " 						SELECT ISNULL(ATTR06,0) ATTR06 FROM MD_BOOKING_MEDIUM"
            strFormat = strFormat & " 						WHERE 1=1"
            strFormat = strFormat & " 						{0} "
            strFormat = strFormat & " 						AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 						UNION ALL"
            strFormat = strFormat & " 						SELECT ISNULL(SEQ,0) ATTR06 FROM MD_OUTDOOR_MEDIUM"
            strFormat = strFormat & " 						WHERE 1=1"
            strFormat = strFormat & " 						{0} "
            strFormat = strFormat & " 						AND  ISNULL(OUT_AMT,0) <> 0 AND ISNULL(PORTAL_SEQ,'') = 1"
            strFormat = strFormat & " 					) ATTR"
            strFormat = strFormat & " 				)  "
            strFormat = strFormat & "       	ELSE ISNULL(ATTR06,0) "
            strFormat = strFormat & "       	END TAXNO,"
            strFormat = strFormat & "       	VOCHNO, RMSNO, ERRCODE, ERRMSG, PAYCODE, MEDFLAG, EX_BISNO, CLIENTCODE,EXCLIENTCODE,"
            strFormat = strFormat & "       	INPUT_MEDFLAG, DEPT_CD, ATTR06, GUBUN"
            strFormat = strFormat & "       	FROM ("
            strFormat = strFormat & "       SELECT "
            strFormat = strFormat & "       '1' GFLAG, "
            strFormat = strFormat & "       REPLACE(CONVERT(VARCHAR(10), DATEADD(D,-DAY(DATEADD(M,1,AA.DEMANDDAY)), DATEADD(M,1, AA.DEMANDDAY  )),121 ) ,'-','')  POSTINGDATE,"
            strFormat = strFormat & "       DBO.SC_GET_HIGHCUSTNAME_FUN(AA.CLIENTCODE) CLIENTNAME, "
            strFormat = strFormat & "       REPLACE(DBO.SC_GET_BUSINO_FUN(AA.EXCLIENTCODE),'-','') CUSTOMERCODE, "
            strFormat = strFormat & "       DBO.SC_GET_HIGHCUSTNAME_FUN(AA.EXCLIENTCODE) CUSTNAME, "
            strFormat = strFormat & "       RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(AA.EXCLIENTCODE) )))))+'외주비' AS SUMM,  "
            strFormat = strFormat & "       dbo.SC_GET_BA(AA.dept_cd) as BA,"
            strFormat = strFormat & "       dbo.SC_GET_CCTR(AA.dept_cd) as costcenter,"
            strFormat = strFormat & "       CASE AA.INPUT_MEDFLAG WHEN '01' THEN ROUND(CASE DBO.MD_GET_AORMATTERCNT_FUN(AA.YEARMON,AA.CLIENTCODE,AA.EXCLIENTCODE,AA.INPUT_MEDFLAG,AA.GBN) WHEN 'Y' THEN BB.TVSUSU ELSE (ISNULL(AA.AMT,0)*BB.RATE) END * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) / 100,0)"
            strFormat = strFormat & "       WHEN '02' THEN ROUND(CASE DBO.MD_GET_AORMATTERCNT_FUN(AA.YEARMON,AA.CLIENTCODE,AA.EXCLIENTCODE,AA.INPUT_MEDFLAG,AA.GBN) WHEN 'Y' THEN BB.RDSUSU ELSE (ISNULL(AA.AMT,0)*BB.RATE) END * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) / 100,0)"
            strFormat = strFormat & "       WHEN '10' THEN ROUND((ISNULL(AA.AMT,0)*BB.RATE) * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE)/ 100,0)"
            strFormat = strFormat & "       ELSE "
            strFormat = strFormat & "       ROUND((ISNULL(AA.AMT,0)* BB.RATE) * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) /100,0)"
            strFormat = strFormat & "       END AMT, "
            strFormat = strFormat & "       CASE AA.INPUT_MEDFLAG WHEN '01' THEN ROUND((CASE DBO.MD_GET_AORMATTERCNT_FUN(AA.YEARMON,AA.CLIENTCODE,AA.EXCLIENTCODE,AA.INPUT_MEDFLAG,AA.GBN) WHEN 'Y' THEN BB.TVSUSU ELSE (ISNULL(AA.AMT,0)*BB.RATE) END * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) / 100) * 0.1,0) "
            strFormat = strFormat & "       WHEN '02' THEN ROUND((CASE DBO.MD_GET_AORMATTERCNT_FUN(AA.YEARMON,AA.CLIENTCODE,AA.EXCLIENTCODE,AA.INPUT_MEDFLAG,AA.GBN) WHEN 'Y' THEN BB.RDSUSU ELSE (ISNULL(AA.AMT,0)*BB.RATE) END * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) / 100) * 0.1,0) "
            strFormat = strFormat & "       WHEN '10' THEN ROUND(((ISNULL(AA.AMT,0)*BB.RATE) * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) / 100) * 0.1,0)"
            strFormat = strFormat & "       ELSE "
            strFormat = strFormat & "       ROUND(((ISNULL(AA.AMT,0)* BB.RATE) * DBO.MD_EXRATE_FUN(AA.EXCLIENTCODE, AA.YEARMON,AA.CLIENTCODE) /100) * 0.1 ,0)"
            strFormat = strFormat & "       END AS vat, "
            strFormat = strFormat & "       'I0' as SEMU,"
            strFormat = strFormat & "       '8000' as BP,"
            strFormat = strFormat & "       CONVERT(CHAR(8),DATEADD(DD,90,replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,AA.demandday)), dateadd(m,1, AA.demandday  )),121 ) ,'-','') ),112) AS DEMANDDAY, "
            strFormat = strFormat & "       CONVERT(CHAR(8),DATEADD(DD,60,AA.DEMANDDAY ),112) AS DUEDATE, "
            strFormat = strFormat & "       REPLACE(DBO.SC_GET_BUSINO_FUN(AA.EXCLIENTCODE),'-','') VENDOR, "
            strFormat = strFormat & "       DBO.SC_GET_HIGHCUSTNAME_FUN(AA.EXCLIENTCODE) VENDORNAME, "
            strFormat = strFormat & "       'O' GBN,  "
            strFormat = strFormat & "       '681150' as  ACCOUNT, "
            strFormat = strFormat & "       '404100' as  DEBTOR, "
            strFormat = strFormat & "       'AD0110' BMORDER,"
            strFormat = strFormat & "       AA.DEMANDDAY as documentdate,"
            strFormat = strFormat & "       '' as  prepayment,"
            strFormat = strFormat & "       '' as  fromdate,"
            strFormat = strFormat & "       '' as  todate,"
            strFormat = strFormat & "       RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(AA.EXCLIENTCODE) ))))) + ' 외주용역비' AS SUMMTEXT, "
            strFormat = strFormat & "       case when isnull(AA.AMT,0) < 0 then '-' else '+' end AMTGBN,"
            strFormat = strFormat & "       AA.YEARMON TAXYEARMON,  "
            strFormat = strFormat & "       CASE  ISNULL(EX_VOCH_NO,'') WHEN '' THEN '' ELSE EX_VOCH_NO END VOCHNO,"
            strFormat = strFormat & "       '' RMSNO, "
            strFormat = strFormat & "       '' ERRCODE, "
            strFormat = strFormat & "       '' ERRMSG,  "
            strFormat = strFormat & "       '' PAYCODE,"
            strFormat = strFormat & "       'AE2' MEDFLAG,  "
            strFormat = strFormat & "       DBO.SC_GET_BUSINO_FUN(AA.EXCLIENTCODE) EX_BISNO,"
            strFormat = strFormat & "       AA.CLIENTCODE,"
            strFormat = strFormat & "       AA.EXCLIENTCODE,"
            strFormat = strFormat & "       AA.INPUT_MEDFLAG, "
            strFormat = strFormat & "       AA.DEPT_CD,"
            strFormat = strFormat & "       AA.ATTR06,"
            strFormat = strFormat & "       AA.GBN GUBUN"
            strFormat = strFormat & "       FROM ("
            strFormat = strFormat & "       	SELECT "
            strFormat = strFormat & "       	YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, SUM(ISNULL(AMT,0)) AMT, "
            strFormat = strFormat & "       	CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "       	WHEN '02' THEN '02'"
            strFormat = strFormat & "       	WHEN '03' THEN '02'"
            strFormat = strFormat & "       	WHEN '10' THEN '10'"
            strFormat = strFormat & "       	WHEN '20' THEN '20'"
            strFormat = strFormat & "       	ELSE INPUT_MEDFLAG"
            strFormat = strFormat & "       	END INPUT_MEDFLAG, ISNULL(EX_VOCH_NO,'') EX_VOCH_NO, ISNULL(ATTR06,0) ATTR06,"
            strFormat = strFormat & "       	'SBS' GBN"
            strFormat = strFormat & "       	FROM MD_ELECTRIC_MEDIUM"
            strFormat = strFormat & "       	WHERE 1=1"
            strFormat = strFormat & "       	{0} "
            strFormat = strFormat & "       	AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & "       	AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '') "
            strFormat = strFormat & "       	AND REAL_MED_CODE = 'B01092'"
            strFormat = strFormat & "       	GROUP BY "
            strFormat = strFormat & "       	YEARMON, DEMANDDAY, CLIENTCODE,EXCLIENTCODE, DEPT_CD,"
            strFormat = strFormat & "       	CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "       	WHEN '02' THEN '02'"
            strFormat = strFormat & "       	WHEN '03' THEN '02'"
            strFormat = strFormat & "       	WHEN '10' THEN '10'"
            strFormat = strFormat & "       	WHEN '20' THEN '20'"
            strFormat = strFormat & "       	ELSE INPUT_MEDFLAG"
            strFormat = strFormat & "       	END, ISNULL(EX_VOCH_NO,''), ISNULL(ATTR06,0)"
            strFormat = strFormat & "       	union all"
            strFormat = strFormat & "       	SELECT "
            strFormat = strFormat & "       	YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, SUM(ISNULL(AMT,0)) AMT, "
            strFormat = strFormat & "       	CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "       	WHEN '02' THEN '02'"
            strFormat = strFormat & "       	WHEN '03' THEN '02'"
            strFormat = strFormat & "       	WHEN '10' THEN '10'"
            strFormat = strFormat & "       	WHEN '20' THEN '20'"
            strFormat = strFormat & "       	ELSE INPUT_MEDFLAG"
            strFormat = strFormat & "       	END INPUT_MEDFLAG, ISNULL(EX_VOCH_NO,'') EX_VOCH_NO, ISNULL(ATTR06,0) ATTR06,"
            strFormat = strFormat & "       	'KOBACO' GBN"
            strFormat = strFormat & "       	FROM MD_ELECTRIC_MEDIUM"
            strFormat = strFormat & "       	WHERE 1=1"
            strFormat = strFormat & "       	{0} "
            strFormat = strFormat & "       	AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & "       	AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '') "
            strFormat = strFormat & "       	AND REAL_MED_CODE <> 'B01092'"
            strFormat = strFormat & "       	GROUP BY "
            strFormat = strFormat & "       	YEARMON, DEMANDDAY, CLIENTCODE,EXCLIENTCODE, DEPT_CD,"
            strFormat = strFormat & "       	CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "       	WHEN '02' THEN '02'"
            strFormat = strFormat & "       	WHEN '03' THEN '02'"
            strFormat = strFormat & "       	WHEN '10' THEN '10'"
            strFormat = strFormat & "       	WHEN '20' THEN '20'"
            strFormat = strFormat & "       	ELSE INPUT_MEDFLAG"
            strFormat = strFormat & "       	END, ISNULL(EX_VOCH_NO,''), ISNULL(ATTR06,0)"
            strFormat = strFormat & "       ) AA"
            strFormat = strFormat & "       LEFT JOIN ("
            strFormat = strFormat & "           SELECT "
            strFormat = strFormat & "           A.YEARMON,"
            strFormat = strFormat & "           INPUT_MEDFLAG, CLIENTCODE,GBN,"
            strFormat = strFormat & "           CASE INPUT_MEDFLAG WHEN '01' THEN round(convert(float,SUM(TVSUSU))/convert(float,SUM(TVAMT)),4,1) "
            strFormat = strFormat & "           WHEN '02' THEN round(convert(float,SUM(RDSUSU))/convert(float,SUM(RDAMT)),4,1) "
            strFormat = strFormat & "           WHEN '10' THEN round(convert(float,SUM(DMBSUSU))/convert(float,SUM(DMBAMT)),4,1) "
            strFormat = strFormat & "           END RATE,"
            strFormat = strFormat & "           SUM(TVSUSU) TVSUSU,"
            strFormat = strFormat & "           SUM(RDSUSU) RDSUSU,"
            strFormat = strFormat & "           SUM(DMBSUSU) DMBSUSU"
            strFormat = strFormat & "           FROM ("
            strFormat = strFormat & "     	        SELECT  "
            strFormat = strFormat & "     	        YEARMON,CLIENTCODE,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '01' THEN ISNULL(AMT,0) ELSE 0 END) TVAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '01' THEN ISNULL(SUSU,0) ELSE 0 END) TVSUSU,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '02' THEN ISNULL(AMT,0) ELSE 0 END) RDAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '02' THEN ISNULL(SUSU,0) ELSE 0 END) RDSUSU,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '10' THEN ISNULL(AMT,0) ELSE 0 END) DMBAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '10' THEN ISNULL(SUSU,0) ELSE 0 END) DMBSUSU,"
            strFormat = strFormat & "     	        CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "     	        WHEN '02' THEN '02'"
            strFormat = strFormat & "     	        WHEN '03' THEN '02'"
            strFormat = strFormat & "     	        WHEN '10' THEN '10'"
            strFormat = strFormat & "     	        WHEN '20' THEN '20'"
            strFormat = strFormat & "     	        END INPUT_MEDFLAG,"
            strFormat = strFormat & " 		        'SBS' GBN"
            strFormat = strFormat & "     	        FROM MD_ELECTRIC_SUSUTEMP"
            strFormat = strFormat & "     	        WHERE 1=1"
            strFormat = strFormat & " 	            {0} "
            strFormat = strFormat & " 		        AND REAL_MED_CODE = 'B01092'"
            strFormat = strFormat & " 		        AND ISNULL(ATTR06,0) = 0"
            strFormat = strFormat & "     	        GROUP BY YEARMON, CLIENTCODE, "
            strFormat = strFormat & "     	        CASE INPUT_MEDFLAG WHEN '01' THEN '01' "
            strFormat = strFormat & "     	        WHEN '02' THEN '02'"
            strFormat = strFormat & "     	        WHEN '03' THEN '02'"
            strFormat = strFormat & "     	        WHEN '10' THEN '10'"
            strFormat = strFormat & "     	        WHEN '20' THEN '20'"
            strFormat = strFormat & "     	        END"
            strFormat = strFormat & " 		        UNION ALL"
            strFormat = strFormat & " 		        SELECT  "
            strFormat = strFormat & "     	        YEARMON,CLIENTCODE,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '01' THEN ISNULL(AMT,0) ELSE 0 END) TVAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '01' THEN ISNULL(SUSU,0) ELSE 0 END) TVSUSU,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '02' THEN ISNULL(AMT,0) ELSE 0 END) RDAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '02' THEN ISNULL(SUSU,0) ELSE 0 END) RDSUSU,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '10' THEN ISNULL(AMT,0) ELSE 0 END) DMBAMT,"
            strFormat = strFormat & "     	        SUM(CASE INPUT_MEDFLAG WHEN '10' THEN ISNULL(SUSU,0) ELSE 0 END) DMBSUSU,"
            strFormat = strFormat & "     	        CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
            strFormat = strFormat & "     	        WHEN '02' THEN '02'"
            strFormat = strFormat & "     	        WHEN '03' THEN '02'"
            strFormat = strFormat & "     	        WHEN '10' THEN '10'"
            strFormat = strFormat & "     	        WHEN '20' THEN '20'"
            strFormat = strFormat & "     	        END INPUT_MEDFLAG,"
            strFormat = strFormat & " 		        'KOBACO' GBN"
            strFormat = strFormat & "     	        FROM MD_ELECTRIC_SUSUTEMP"
            strFormat = strFormat & "     	        WHERE 1=1"
            strFormat = strFormat & " 	            {0} "
            strFormat = strFormat & " 	        	AND REAL_MED_CODE <> 'B01092'"
            strFormat = strFormat & " 	        	AND ISNULL(ATTR06,0) = 0"
            strFormat = strFormat & "             	GROUP BY YEARMON, CLIENTCODE, "
            strFormat = strFormat & "             	CASE INPUT_MEDFLAG WHEN '01' THEN '01' "
            strFormat = strFormat & "             	WHEN '02' THEN '02'"
            strFormat = strFormat & "             	WHEN '03' THEN '02'"
            strFormat = strFormat & "             	WHEN '10' THEN '10'"
            strFormat = strFormat & "             	WHEN '20' THEN '20'"
            strFormat = strFormat & "             	END"
            strFormat = strFormat & " 	        	UNION ALL"
            strFormat = strFormat & " 	        	SELECT "
            strFormat = strFormat & " 	        	YEARMON,CLIENTCODE,  "
            strFormat = strFormat & " 	        	SUM(AMT) TVAMT ,"
            strFormat = strFormat & " 	        	SUM(COMMISSION) TVSUSU,"
            strFormat = strFormat & " 	        	0 RDAMT,"
            strFormat = strFormat & " 	        	0 RDSUSU,"
            strFormat = strFormat & " 	        	0 DMBAMT,"
            strFormat = strFormat & " 	        	0 DMBSUSU,"
            strFormat = strFormat & " 	        	INPUT_MEDFLAG,"
            strFormat = strFormat & " 	        	'KOBACO' GBN"
            strFormat = strFormat & " 	        	FROM MD_ELECTRIC_MEDIUM"
            strFormat = strFormat & " 	        	WHERE 1=1"
            strFormat = strFormat & " 	            {0} "
            strFormat = strFormat & " 	        	AND VOCH_TYPE = '1'"
            strFormat = strFormat & " 	        	AND INPUT_MEDFLAG = '01'"
            strFormat = strFormat & " 	        	AND MEDCODE IN('B01857')"
            strFormat = strFormat & "               GROUP BY YEARMON, CLIENTCODE,CLIENTCODE, INPUT_MEDFLAG"
            strFormat = strFormat & "             ) A"
            strFormat = strFormat & "             GROUP BY YEARMON, CLIENTCODE, INPUT_MEDFLAG,GBN"
            strFormat = strFormat & "       ) BB"
            strFormat = strFormat & "       ON AA.YEARMON = BB.YEARMON AND AA.CLIENTCODE= BB.CLIENTCODE AND AA.INPUT_MEDFLAG = BB.INPUT_MEDFLAG AND AA.GBN = BB.GBN"
            strFormat = strFormat & "       WHERE 1=1 "
            strFormat = strFormat & " 		UNION ALL"
            strFormat = strFormat & " 		SELECT "
            strFormat = strFormat & " 		'1' GFLAG, "
            strFormat = strFormat & " 		replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','')  postingdate,"
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE),'-','') CUSTOMERCODE, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) CUSTNAME, "
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) )))))+'외주비' AS SUMM,  "
            strFormat = strFormat & " 		dbo.SC_GET_BA(a.dept_cd) as BA,"
            strFormat = strFormat & " 		dbo.SC_GET_CCTR(a.dept_cd) as costcenter,"
            strFormat = strFormat & " 		FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) AS amt,"
            strFormat = strFormat & " 		FLOOR(FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) * 0.1) AS vat,"
            strFormat = strFormat & " 		'I0' as SEMU,"
            strFormat = strFormat & " 		'8000' as BP,"
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,90,replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','') ),112) AS DEMANDDAY, "
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,60,A.DEMANDDAY ),112) AS DUEDATE, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(EXCLIENTCODE),'-','') VENDOR, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(EXCLIENTCODE) VENDORNAME, "
            strFormat = strFormat & " 		'O' GBN,  "
            strFormat = strFormat & " 		'681150' as  ACCOUNT, "
            strFormat = strFormat & " 		'404100' as  DEBTOR, "
            strFormat = strFormat & "       'AD0120' BMORDER,"
            strFormat = strFormat & " 		A.DEMANDDAY as documentdate,"
            strFormat = strFormat & " 		'' as  prepayment,"
            strFormat = strFormat & " 		'' as  fromdate,"
            strFormat = strFormat & " 		'' as  todate,"
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) ))))) + ' 외주용역비' AS SUMMTEXT, "
            strFormat = strFormat & " 		case when isnull(A.COMMISSION,0) < 0 then '-' else '+' end AMTGBN,"
            strFormat = strFormat & " 		YEARMON TAXYEARMON,  "
            strFormat = strFormat & " 		CASE  isnull(EX_VOCH_NO,'') WHEN '' THEN '' ELSE EX_VOCH_NO END VOCHNO, "
            strFormat = strFormat & " 		'' RMSNO, "
            strFormat = strFormat & " 		'' ERRCODE, "
            strFormat = strFormat & " 		'' ERRMSG,  "
            strFormat = strFormat & " 		'' PAYCODE,"
            strFormat = strFormat & " 		'A22' MEDFLAG,  "
            strFormat = strFormat & " 		DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE) EX_BISNO,"
            strFormat = strFormat & " 		A.CLIENTCODE,"
            strFormat = strFormat & " 		A.EXCLIENTCODE,"
            strFormat = strFormat & " 		'A2' INPUT_MEDFLAG, "
            strFormat = strFormat & " 		A.DEPT_CD,"
            strFormat = strFormat & " 		A.ATTR06, "
            strFormat = strFormat & " 		'' GUBUN "
            strFormat = strFormat & " 		FROM ("
            strFormat = strFormat & " 			SELECT YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,'') EX_VOCH_NO,"
            strFormat = strFormat & " 			SUM(ISNULL(COMMISSION,0)) COMMISSION, ISNULL(ATTR06,0) ATTR06"
            strFormat = strFormat & " 			FROM MD_CATV_MEDIUM"
            strFormat = strFormat & " 			WHERE 1=1"
            strFormat = strFormat & " 			{0} "
            strFormat = strFormat & " 			AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 			GROUP BY YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,''), ISNULL(ATTR06,0)"
            strFormat = strFormat & " 		) A"
            strFormat = strFormat & " 		UNION ALL		"
            strFormat = strFormat & " 		SELECT "
            strFormat = strFormat & " 		'1' GFLAG, "
            strFormat = strFormat & " 		replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','')  postingdate,"
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE),'-','') CUSTOMERCODE, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) CUSTNAME, "
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) )))))+'외주비' AS SUMM,  "
            strFormat = strFormat & " 		dbo.SC_GET_BA(a.dept_cd) as BA,"
            strFormat = strFormat & " 		dbo.SC_GET_CCTR(a.dept_cd) as costcenter,"
            strFormat = strFormat & " 		FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) AS amt,"
            strFormat = strFormat & " 		FLOOR(FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) * 0.1) AS vat,"
            strFormat = strFormat & " 		'I0' as SEMU,"
            strFormat = strFormat & " 		'8000' as BP,"
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,90,replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','') ),112) AS DEMANDDAY, "
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,60,A.DEMANDDAY ),112) AS DUEDATE, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(EXCLIENTCODE),'-','') VENDOR, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(EXCLIENTCODE) VENDORNAME, "
            strFormat = strFormat & " 		'O' GBN,  "
            strFormat = strFormat & " 		'681150' as  ACCOUNT, "
            strFormat = strFormat & " 		'404100' as  DEBTOR, "
            strFormat = strFormat & "       'AD0130' BMORDER,"
            strFormat = strFormat & " 		A.DEMANDDAY as documentdate,"
            strFormat = strFormat & " 		'' as  prepayment,"
            strFormat = strFormat & " 		'' as  fromdate,"
            strFormat = strFormat & " 		'' as  todate,"
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) ))))) + ' 외주용역비' AS SUMMTEXT, "
            strFormat = strFormat & " 		case when isnull(A.COMMISSION,0) < 0 then '-' else '+' end AMTGBN,"
            strFormat = strFormat & " 		YEARMON TAXYEARMON,  "
            strFormat = strFormat & " 		CASE ISNULL(EX_VOCH_NO,'') WHEN '' THEN '' ELSE EX_VOCH_NO END VOCHNO, "
            strFormat = strFormat & " 		'' RMSNO, "
            strFormat = strFormat & " 		'' ERRCODE, "
            strFormat = strFormat & " 		'' ERRMSG,  "
            strFormat = strFormat & " 		'' PAYCODE,"
            strFormat = strFormat & " 		'T2' MEDFLAG,  "
            strFormat = strFormat & " 		DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE) EX_BISNO,"
            strFormat = strFormat & " 		A.CLIENTCODE,"
            strFormat = strFormat & " 		A.EXCLIENTCODE,"
            strFormat = strFormat & " 		'T' INPUT_MEDFLAG, "
            strFormat = strFormat & " 		A.DEPT_CD,"
            strFormat = strFormat & " 		A.ATTR06, "
            strFormat = strFormat & " 		'' GUBUN "
            strFormat = strFormat & " 		FROM ("
            strFormat = strFormat & " 			SELECT YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,'') EX_VOCH_NO,"
            strFormat = strFormat & " 			SUM(ISNULL(COMMISSION,0)) COMMISSION, ISNULL(ATTR06,0) ATTR06"
            strFormat = strFormat & " 			FROM MD_TOTAL_MEDIUM"
            strFormat = strFormat & " 			WHERE 1=1"
            strFormat = strFormat & " 			{0} "
            strFormat = strFormat & " 			AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 			GROUP BY YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,''), ISNULL(ATTR06,0)"
            strFormat = strFormat & " 		) A"
            strFormat = strFormat & " 		UNION ALL"
            strFormat = strFormat & " 		SELECT "
            strFormat = strFormat & " 		'1' GFLAG, "
            strFormat = strFormat & " 		replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','')  postingdate,"
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE),'-','') CUSTOMERCODE, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) CUSTNAME, "
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) )))))+'외주비' AS SUMM,  "
            strFormat = strFormat & " 		dbo.SC_GET_BA(a.dept_cd) as BA,"
            strFormat = strFormat & " 		dbo.SC_GET_CCTR(a.dept_cd) as costcenter,"
            strFormat = strFormat & " 		FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) AS amt,"
            strFormat = strFormat & " 		FLOOR(FLOOR(isnull(A.COMMISSION,0) * DBO.MD_EXRATE_FUN(A.EXCLIENTCODE, A.YEARMON,A.CLIENTCODE) /100) * 0.1) AS vat,"
            strFormat = strFormat & " 		'I0' as SEMU,"
            strFormat = strFormat & " 		'8000' as BP,"
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,90,replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','') ),112) AS DEMANDDAY, "
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,60,A.DEMANDDAY ),112) AS DUEDATE, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(EXCLIENTCODE),'-','') VENDOR, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(EXCLIENTCODE) VENDORNAME, "
            strFormat = strFormat & " 		'O' GBN,  "
            strFormat = strFormat & " 		'681150' as  ACCOUNT, "
            strFormat = strFormat & " 		'404100' as  DEBTOR, "
            strFormat = strFormat & "       'AD0140' BMORDER,"
            strFormat = strFormat & " 		A.DEMANDDAY as documentdate,"
            strFormat = strFormat & " 		'' as  prepayment,"
            strFormat = strFormat & " 		'' as  fromdate,"
            strFormat = strFormat & " 		'' as  todate,"
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.EXCLIENTCODE) ))))) + ' 외주용역비' AS SUMMTEXT, "
            strFormat = strFormat & " 		case when isnull(A.COMMISSION,0) < 0 then '-' else '+' end AMTGBN,"
            strFormat = strFormat & " 		YEARMON TAXYEARMON,  "
            strFormat = strFormat & " 		CASE  ISNULL(EX_VOCH_NO,'') WHEN '' THEN '' ELSE EX_VOCH_NO END VOCHNO,"
            strFormat = strFormat & " 		'' RMSNO, "
            strFormat = strFormat & " 		'' ERRCODE, "
            strFormat = strFormat & " 		'' ERRMSG,  "
            strFormat = strFormat & " 		'' PAYCODE,"
            strFormat = strFormat & " 		'B22' MEDFLAG,  "
            strFormat = strFormat & " 		DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE) EX_BISNO,"
            strFormat = strFormat & " 		A.CLIENTCODE,"
            strFormat = strFormat & " 		A.EXCLIENTCODE,"
            strFormat = strFormat & " 		'B' INPUT_MEDFLAG, "
            strFormat = strFormat & " 		A.DEPT_CD, "
            strFormat = strFormat & " 		A.ATTR06, "
            strFormat = strFormat & " 		'' GUBUN "
            strFormat = strFormat & " 		FROM ("
            strFormat = strFormat & " 			SELECT YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,'') EX_VOCH_NO,"
            strFormat = strFormat & " 			SUM(ISNULL(COMMISSION,0)) COMMISSION, ISNULL(ATTR06,0) ATTR06"
            strFormat = strFormat & " 			FROM MD_BOOKING_MEDIUM"
            strFormat = strFormat & " 			WHERE 1=1"
            strFormat = strFormat & " 			{0} "
            strFormat = strFormat & " 			AND SUBSTRING(EXCLIENTCODE,1,1) = 'G'"
            strFormat = strFormat & " 			GROUP BY YEARMON, DEMANDDAY, CLIENTCODE, EXCLIENTCODE, DEPT_CD, ISNULL(EX_VOCH_NO,''), ISNULL(ATTR06,0)"
            strFormat = strFormat & " 		) A"
            strFormat = strFormat & " 		UNION ALL"
            strFormat = strFormat & " 		SELECT  "
            strFormat = strFormat & " 		'1' GFLAG, "
            strFormat = strFormat & " 		replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','') as postingdate,"
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE),'-','') CUSTOMERCODE, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(A.REAL_MED_CODE) CUSTNAME, "
            strFormat = strFormat & " 		RTRIM(LTRIM(CONVERT(CHAR(17),RTRIM(LTRIM(DBO.SC_GET_HIGHCUSTNAME_FUN(A.REAL_MED_CODE) )))))+'외주비' AS SUMM,  "
            strFormat = strFormat & " 		'6000' as BA,"
            strFormat = strFormat & " 		'66500' as costcenter,"
            strFormat = strFormat & " 		case when isnull(A.OUT_AMT,0) < 0 then abs(isnull(A.OUT_AMT,0)) else  dbo.lpad(A.OUT_AMT,13,'0') end  amt, "
            strFormat = strFormat & " 		case when isnull(A.OUT_AMT,0) < 0 then abs(CASE A.COMMI_TAX_FLAG WHEN 'Y' THEN FLOOR(A.OUT_AMT* 0.1) WHEN 'N' THEN 0 ELSE 0 END) else dbo.lpad(CASE A.COMMI_TAX_FLAG WHEN 'Y' THEN FLOOR(A.OUT_AMT* 0.1) WHEN 'N' THEN 0 ELSE 0 END,13,'0') end AS vat,  "
            strFormat = strFormat & " 		'I0' AS SEMU, "
            strFormat = strFormat & " 		'8000' BP,"
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,90,replace(CONVERT(VARCHAR(10), dateadd(d,-day(dateadd(m,1,a.demandday)), dateadd(m,1, a.demandday  )),121 ) ,'-','') ),112) AS DEMANDDAY, "
            strFormat = strFormat & " 		CONVERT(CHAR(8),DATEADD(DD,60,A.DEMANDDAY ),112) AS DUEDATE, "
            strFormat = strFormat & " 		REPLACE(DBO.SC_GET_BUSINO_FUN(REAL_MED_CODE),'-','') VENDOR, "
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(REAL_MED_CODE) VENDORNAME, "
            strFormat = strFormat & " 		'O' GBN,  "
            strFormat = strFormat & " 		'681150' as  ACCOUNT, "
            strFormat = strFormat & " 		'404100' as  DEBTOR, "
            strFormat = strFormat & " 		'AD0160' BMORDER,"
            strFormat = strFormat & " 		A.DEMANDDAY as documentdate,"
            strFormat = strFormat & " 		'' as  prepayment,"
            strFormat = strFormat & " 		'' as  fromdate,"
            strFormat = strFormat & " 		'' as  todate,"
            strFormat = strFormat & " 		DBO.SC_GET_HIGHCUSTNAME_FUN(CLIENTCODE)+'-'+DBO.SC_GET_HIGHCUSTNAME_FUN(REAL_MED_CODE)+' 외주용역비' AS SUMMTEXT ,  "
            strFormat = strFormat & " 		case when isnull(A.OUT_AMT,0) < 0 then '-' else '+' end AMTGBN,"
            strFormat = strFormat & " 		YEARMON TAXYEARMON,  "
            strFormat = strFormat & " 		CASE ISNULL(EX_VOCH_NO,'') WHEN '' THEN '' ELSE EX_VOCH_NO END VOCHNO, "
            strFormat = strFormat & " 		'' RMSNO, "
            strFormat = strFormat & " 		'' ERRCODE, "
            strFormat = strFormat & " 		'' ERRMSG,  "
            strFormat = strFormat & " 		'' PAYCODE,"
            strFormat = strFormat & " 		'D22' MEDFLAG, "
            strFormat = strFormat & " 		DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) EX_BISNO,"
            strFormat = strFormat & " 		A.CLIENTCODE,"
            strFormat = strFormat & " 		A.REAL_MED_CODE EXCLIENTCODE,"
            strFormat = strFormat & " 		'O' INPUT_MEDFLAG, "
            strFormat = strFormat & " 		'00006145' DEPT_CD,"
            strFormat = strFormat & " 		A.ATTR06, "
            strFormat = strFormat & " 		'' GUBUN "
            strFormat = strFormat & " 		FROM ("
            strFormat = strFormat & " 			SELECT YEARMON, DEMANDDAY, CLIENTCODE, REAL_MED_CODE, DEPT_CD, ISNULL(TRU_VOCH_NO,'') EX_VOCH_NO,"
            strFormat = strFormat & " 			SUM(ISNULL(OUT_AMT,0)) OUT_AMT, ISNULL(SEQ,0) ATTR06, COMMI_TAX_FLAG"
            strFormat = strFormat & " 			FROM MD_OUTDOOR_MEDIUM"
            strFormat = strFormat & " 			WHERE 1=1"
            strFormat = strFormat & " 			{0} "
            strFormat = strFormat & " 			and  isnull(out_amt,0) <> 0 AND ISNULL(PORTAL_SEQ,'') = 1"
            strFormat = strFormat & " 			GROUP BY YEARMON, DEMANDDAY, CLIENTCODE, REAL_MED_CODE, DEPT_CD, ISNULL(TRU_VOCH_NO,''), ISNULL(SEQ,0), COMMI_TAX_FLAG"
            strFormat = strFormat & " 		) A"
            strFormat = strFormat & " 	) B"
            strFormat = strFormat & " ) C"
            strFormat = strFormat & " LEFT JOIN MD_TRUVOCH_MST D"
            strFormat = strFormat & " ON C.TAXYEARMON = D.TAXYEARMON AND C.TAXNO = D.TAXNO AND D.GBN = 'O' AND D.RMSNO ='ALL' AND D.MEDFLAG IN('AE2','A22','B22','D22','T2')"
            strFormat = strFormat & " WHERE 1=1 {1}"
            strFormat = strFormat & " ORDER BY CLIENTNAME,INPUT_MEDFLAG "

            strSQL = String.Format(strFormat, strAND, strWhere)

            '데이터 조회
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_OUT")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function ProcessRtn(ByVal strInfoXML As String, _
                               ByVal vntData As Object, _
                               ByVal strRETURNLIST As String, _
                               ByVal strGBN As String, _
                               ByVal strMEDFLAG As String) As Integer

        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim strPOSTINGDATE As String
        Dim strDEMANDDAY As String
        Dim strDOCUMENTDATE As String
        Dim strDUEDATE As String
        Dim strFROMDATE As String
        Dim strTODATE As String
        Dim strTAXNOSEQ

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                If IsArray(vntData) Then

                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjceMD_TRUVOCH_MST = New ceMD_TRUVOCH_MST(mobjSCGLConfig)

                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
                    '''해당하는Row 만큼 Loop

                    If strGBN = "O" Then
                        For i = 1 To intRows
                            If GetElement(vntData, "CHK", intColCnt, i) = "1" Then
                                If GetElement(vntData, "POSTINGDATE", intColCnt, i, OPTIONAL_STR) <> "" Then strPOSTINGDATE = Replace(GetElement(vntData, "POSTINGDATE", intColCnt, i, OPTIONAL_STR), "-", "")
                                If GetElement(vntData, "DEMANDDAY", intColCnt, i, OPTIONAL_STR) <> "" Then strDEMANDDAY = Replace(GetElement(vntData, "DEMANDDAY", intColCnt, i, OPTIONAL_STR), "-", "")
                                If GetElement(vntData, "DOCUMENTDATE", intColCnt, i, OPTIONAL_STR) <> "" Then strDOCUMENTDATE = Replace(GetElement(vntData, "DOCUMENTDATE", intColCnt, i, OPTIONAL_STR), "-", "")
                                If GetElement(vntData, "FROMDATE", intColCnt, i, OPTIONAL_STR) <> "" Then strFROMDATE = Replace(GetElement(vntData, "FROMDATE", intColCnt, i, OPTIONAL_STR), "-", "")
                                If GetElement(vntData, "TODATE", intColCnt, i, OPTIONAL_STR) <> "" Then strTODATE = Replace(GetElement(vntData, "TODATE", intColCnt, i, OPTIONAL_STR), "-", "")
                                If GetElement(vntData, "DUEDATE", intColCnt, i, OPTIONAL_STR) <> "" Then strDUEDATE = Replace(GetElement(vntData, "DUEDATE", intColCnt, i, OPTIONAL_STR), "-", "")

                                intRtn = InsertRtn(vntData, intColCnt, i, strPOSTINGDATE, strDEMANDDAY, strFROMDATE, strTODATE, strDOCUMENTDATE, strDUEDATE, "")
                            End If
                        Next
                    End If

                    intRtn = UpdateRtn(strInfoXML, strRETURNLIST, strGBN, strMEDFLAG)
                End If

                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjceMD_TRUVOCH_MST.Dispose()
            End Try
        End With
    End Function

    Public Function UpdateRtn(ByVal strInfoXML As String, _
                              ByVal strRETURNLIST As String, _
                              ByVal strGBN As String, _
                              ByVal strMEDFLAG As String) As Integer


        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim firstArray
        Dim secondArray

        Dim strTAXYEARMON As String
        Dim intTAXNO As Integer
        Dim strDOC_STATUS As String
        Dim strDOC_MESSAGE As String
        Dim strVOCHNO As String
        Dim strIF_KEY As String

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                '.mobjSCGLSql.SQLConnect(.DBConnStr)
                '.mobjSCGLSql.SQLBeginTrans()

                firstArray = Split(strRETURNLIST, ":", -1, CompareMethod.Text)
                If strRETURNLIST <> "" Then

                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjceMD_TRUVOCH_MST = New ceMD_TRUVOCH_MST(mobjSCGLConfig)

                    For i = 0 To firstArray.length - 1
                        secondArray = Split(firstArray(i), "|", -1, CompareMethod.Text)

                        strTAXYEARMON = secondArray(0)
                        intTAXNO = CInt(secondArray(1))
                        strDOC_STATUS = secondArray(2)
                        strDOC_MESSAGE = Replace(secondArray(3), "'", "''")
                        strVOCHNO = secondArray(4)
                        strIF_KEY = secondArray(5)

                        If strDOC_STATUS = "S" Then
                            strDOC_STATUS = ""
                            strDOC_MESSAGE = ""
                        Else
                            strDOC_STATUS = "1"
                        End If

                        intRtn = UpdateRtn_VOCHNO(strGBN, strMEDFLAG, strTAXYEARMON, intTAXNO, strDOC_STATUS, strDOC_MESSAGE, strVOCHNO, strIF_KEY)
                    Next

                End If
                '.mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                ' .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".UpdateRtn")
            Finally
                '.mobjSCGLSql.SQLDisconnect()
                mobjceMD_TRUVOCH_MST.Dispose()

            End Try
        End With
    End Function


    Public Function UpdateRtn_OUT_Medium(ByVal strInfoXML As String, _
                                         ByVal vntData As Object) As Integer

        Dim strSQL As String

        Dim intRtn, intColCnt, intRows, i As Integer
        Dim strYEARMON, strCLIENTCODE, strREAL_MED_CODE, strEXCLIENTCODE, strDEPT_CD, strINPUT_MEDFLAG
        Dim intTAXNO
        Dim strGUBUN


        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)
                With mobjSCGLConfig
                    .mobjSCGLSql.SQLConnect(.DBConnStr)
                    .mobjSCGLSql.SQLBeginTrans()

                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
                    '''해당하는Row 만큼 Loop

                    For i = 1 To intRows
                        '체크가 되어있고 옥외가 아닌것 옥외인것은 따로 RMS 번호를 생성하지 않기때문에 쿼리가 없다는 오류를 생성할수 있어서 처리 하였습니다.20120227_OSH

                        If GetElement(vntData, "CHK", intColCnt, i, OPTIONAL_STR) = 1 Then
                            strCLIENTCODE = GetElement(vntData, "CLIENTCODE", intColCnt, i, OPTIONAL_STR)
                            strEXCLIENTCODE = GetElement(vntData, "EXCLIENTCODE", intColCnt, i, OPTIONAL_STR)
                            strINPUT_MEDFLAG = GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR)
                            strDEPT_CD = GetElement(vntData, "DEPT_CD", intColCnt, i, OPTIONAL_STR)
                            strYEARMON = GetElement(vntData, "TAXYEARMON", intColCnt, i, OPTIONAL_STR)
                            intTAXNO = GetElement(vntData, "TAXNO", intColCnt, i, NULL_NUM, True)
                            strGUBUN = GetElement(vntData, "GUBUN", intColCnt, i, OPTIONAL_STR)

                            If GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "01" Then

                                If strGUBUN = "KOBACO" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE <> 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                ElseIf strGUBUN = "SBS" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE = 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                End If

                            ElseIf GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "02" Then

                                If strGUBUN = "KOBACO" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE <> 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                ElseIf strGUBUN = "SBS" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE = 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                End If

                            ElseIf GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "10" Then

                                If strGUBUN = "KOBACO" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE <> 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                ElseIf strGUBUN = "SBS" Then
                                    strSQL = strSQL & " UPDATE MD_ELECTRIC_MEDIUM"
                                    strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                    strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                    strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                    strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                    strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"
                                    strSQL = strSQL & " AND REAL_MED_CODE = 'B01092'"
                                    strSQL = strSQL & " AND CASE INPUT_MEDFLAG WHEN '01' THEN '01'"
                                    strSQL = strSQL & " WHEN '02' THEN '02'"
                                    strSQL = strSQL & " WHEN '03' THEN '02'"
                                    strSQL = strSQL & " WHEN '10' THEN '10'"
                                    strSQL = strSQL & " WHEN '20' THEN '20'"
                                    strSQL = strSQL & " END  = '" & strINPUT_MEDFLAG & "'"

                                End If

                            ElseIf GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "A2" Then

                                strSQL = strSQL & " UPDATE MD_CATV_MEDIUM"
                                strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"

                            ElseIf GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "T" Then

                                strSQL = strSQL & " UPDATE MD_TOTAL_MEDIUM"
                                strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"

                            ElseIf GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) = "B" Then

                                strSQL = strSQL & " UPDATE MD_BOOKING_MEDIUM"
                                strSQL = strSQL & " SET ATTR06 = " & intTAXNO
                                strSQL = strSQL & " WHERE YEARMON= '" & strYEARMON & "'"
                                strSQL = strSQL & " AND CLIENTCODE = '" & strCLIENTCODE & "'"
                                strSQL = strSQL & " AND EXCLIENTCODE = '" & strEXCLIENTCODE & "'"
                                strSQL = strSQL & " AND DEPT_CD = '" & strDEPT_CD & "'"

                            End If

                            '옥외가 아닌것은 시퀸스를 업데이트 한다.옥외는 시퀸스 업데이트를 하지않고 넘어간다.
                            If GetElement(vntData, "INPUT_MEDFLAG", intColCnt, i, OPTIONAL_STR) <> "O" Then

                                mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)

                            End If

                            intRtn = intRtn + 1
                        End If
                    Next
                    .mobjSCGLSql.SQLCommitTrans()
                    Return intRtn
                End With
            Catch err As Exception
                mobjSCGLConfig.mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".UpdateRtn_OUT_Medium")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function VOCHDELL_BUY(ByVal strInfoXML As String, _
                                 ByVal strRETURNLIST As String, _
                                 ByVal strGBN As String, _
                                 ByVal strMEDFLAG As String, _
                                 ByVal strFLAG As String) As Integer
        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim firstArray
        Dim secondArray

        Dim strTAXYEARMON As String
        Dim intTAXNO As Integer
        Dim strDOC_STATUS As String
        Dim strDOC_MESSAGE As String
        Dim strVOCHNO As String

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                firstArray = Split(strRETURNLIST, ":", -1, CompareMethod.Text)
                If strRETURNLIST <> "" Then
                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjceMD_TRUVOCH_MST = New ceMD_TRUVOCH_MST(mobjSCGLConfig)

                    For i = 0 To firstArray.length - 1
                        secondArray = Split(firstArray(i), "|", -1, CompareMethod.Text)

                        strTAXYEARMON = secondArray(0)
                        intTAXNO = CInt(secondArray(1))
                        strDOC_STATUS = secondArray(2)
                        strDOC_MESSAGE = Replace(secondArray(3), "'", "''")
                        strVOCHNO = secondArray(4)

                        If strDOC_STATUS = "S" Then
                            '전표내역 삭제
                            intRtn = mobjceMD_TRUVOCH_MST.Delete_vochno_BUY(strTAXYEARMON, strVOCHNO, strGBN, strFLAG)
                            '세금계산서의 전표번호 '' 로 업데이트
                            intRtn = mobjceMD_TRUVOCH_MST.UpdateDelete_BUY(strTAXYEARMON, intTAXNO, strMEDFLAG, strGBN, strFLAG)
                        ElseIf strDOC_STATUS = "E" Then
                            '전표삭제시 SAP오류는 오류전표로 보내기위함.
                            strDOC_STATUS = "1"
                            intRtn = mobjceMD_TRUVOCH_MST.UpdateRtn_DELETEERR_BUYALL(strGBN, strTAXYEARMON, intTAXNO, strDOC_STATUS, strDOC_MESSAGE, strVOCHNO)
                        End If
                    Next

                End If

                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".VOCHDELL_BUY")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjceMD_TRUVOCH_MST.Dispose()

            End Try
        End With
    End Function

    Public Function DeleteRtn(ByVal strInfoXML As String, _
                                  ByVal vntData As Object) As Integer
        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim dblID As Double '자동 ID 를사용할 때만 사용
        Dim strSC_EMP_STATUS As String
        Dim vntData2 As Object
        Dim intSEQ As Double

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                If IsArray(vntData) Then
                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjceMD_TRUVOCH_MST = New ceMD_TRUVOCH_MST(mobjSCGLConfig)

                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)
                    '''해당하는Row 만큼 Loop
                    For i = 1 To intRows
                        If Trim(GetElement(vntData, "CHK", intColCnt, i)) = "" Then
                        Else
                            If GetElement(vntData, "CHK", intColCnt, i) = 1 And GetElement(vntData, "ERRCODE", intColCnt, i) = 1 Then
                                intRtn = DeleteRtn_ERR(vntData, intColCnt, i)
                            End If
                        End If
                    Next
                End If
                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".DeleteRtn")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjceMD_TRUVOCH_MST.Dispose()
            End Try
        End With
    End Function

    Public Function DeleteRtn_GANG_BUY(ByVal strInfoXML As String, _
                                       ByVal strTAXYEARMON As String, _
                                       ByVal intTAXNO As String, _
                                       ByVal strVOCHNO As String, _
                                       ByVal strGBN As String, _
                                       ByVal strMEDFLAG As String, _
                                       ByVal strFLAG As String) As Integer
        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim dblID As Double '자동 ID 를사용할 때만 사용
        Dim strSC_EMP_STATUS As String
        Dim vntData2 As Object
        Dim intSEQ As Double

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                mobjceMD_TRUVOCH_MST = New ceMD_TRUVOCH_MST(mobjSCGLConfig)

                intRtn = mobjceMD_TRUVOCH_MST.Delete_vochno_BUY(strTAXYEARMON, strVOCHNO, strGBN, strFLAG)
                '세금계산서의 전표번호 '' 로 업데이트
                intRtn = mobjceMD_TRUVOCH_MST.UpdateDelete_BUY(strTAXYEARMON, intTAXNO, strMEDFLAG, strGBN, strFLAG)

                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".DeleteRtn_GANG")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjceMD_TRUVOCH_MST.Dispose()
            End Try
        End With
    End Function

#End Region

#Region "GROUP BLOCK : 외부에 비공개 Method"
    Private Function InsertRtn(ByVal vntData As Object, _
                               ByVal intColCnt As Integer, _
                               ByVal intRow As Integer, _
                               ByVal strPOSTINGDATE As String, _
                               ByVal strDEMANDDAY As String, _
                               ByVal strFROMDATE As String, _
                               ByVal strTODATE As String, _
                               ByVal strDOCUMENTDATE As String, _
                               ByVal strDUEDATE As String, _
                               ByVal strATTR01 As String) As Integer


        Dim intRtn As Integer
        intRtn = mobjceMD_TRUVOCH_MST.InsertDo( _
                                       strPOSTINGDATE, _
                                       GetElement(vntData, "CUSTOMERCODE", intColCnt, intRow), _
                                       GetElement(vntData, "SUMM", intColCnt, intRow), _
                                       GetElement(vntData, "BA", intColCnt, intRow), _
                                       GetElement(vntData, "COSTCENTER", intColCnt, intRow), _
                                       GetElement(vntData, "AMT", intColCnt, intRow, NULL_NUM, True), _
                                       GetElement(vntData, "VAT", intColCnt, intRow, NULL_NUM, True), _
                                       GetElement(vntData, "SEMU", intColCnt, intRow), _
                                       GetElement(vntData, "BP", intColCnt, intRow), _
                                       strDEMANDDAY, _
                                       strDUEDATE, _
                                       GetElement(vntData, "VENDOR", intColCnt, intRow), _
                                       GetElement(vntData, "TAXYEARMON", intColCnt, intRow), _
                                       GetElement(vntData, "TAXNO", intColCnt, intRow, NULL_NUM, True), _
                                       GetElement(vntData, "GBN", intColCnt, intRow), _
                                       GetElement(vntData, "DEBTOR", intColCnt, intRow), _
                                       GetElement(vntData, "ACCOUNT", intColCnt, intRow), _
                                       strDOCUMENTDATE, _
                                       GetElement(vntData, "PAYCODE", intColCnt, intRow), _
                                       GetElement(vntData, "BANKTYPE", intColCnt, intRow), _
                                       GetElement(vntData, "BMORDER", intColCnt, intRow), _
                                       GetElement(vntData, "PREPAYMENT", intColCnt, intRow), _
                                       strFROMDATE, _
                                       strTODATE, _
                                       GetElement(vntData, "SUMMTEXT", intColCnt, intRow), _
                                       GetElement(vntData, "GFLAG", intColCnt, intRow), _
                                       "", _
                                       "ALL", _
                                       GetElement(vntData, "MEDFLAG", intColCnt, intRow), _
                                       strATTR01)

        Return intRtn
    End Function

    Private Function UpdateRtn_VOCHNO(ByVal strGBN As String, _
                                          ByVal strMEDFLAG As String, _
                                          ByVal strTAXYEARMON As String, _
                                          ByVal intTAXNO As Integer, _
                                          ByVal strDOC_STATUS As String, _
                                          ByVal strDOC_MESSAGE As String, _
                                          ByVal strVOCHNO As String, _
                                          ByVal strIF_KEY As String) As Integer

        Dim intRtn As Integer

        intRtn = mobjceMD_TRUVOCH_MST.UpdateRtn_VOCHNO( _
                                       strGBN, _
                                       strMEDFLAG, _
                                       strTAXYEARMON, _
                                       intTAXNO, _
                                       strDOC_STATUS, _
                                       strDOC_MESSAGE, _
                                       strVOCHNO, _
                                       strIF_KEY)

        Return intRtn
    End Function

    Private Function DeleteRtn_ERR(ByVal vntData As Object, _
                                   ByVal intColCnt As Integer, _
                                   ByVal intRow As Integer) As Integer

        Dim intRtn As Integer

        intRtn = mobjceMD_TRUVOCH_MST.Delete_ERR(GetElement(vntData, "TAXYEARMON", intColCnt, intRow), _
                                                 GetElement(vntData, "TAXNO", intColCnt, intRow), _
                                                 GetElement(vntData, "GBN", intColCnt, intRow), _
                                                 GetElement(vntData, "MEDFLAG", intColCnt, intRow))

        Return intRtn
    End Function

#End Region
End Class