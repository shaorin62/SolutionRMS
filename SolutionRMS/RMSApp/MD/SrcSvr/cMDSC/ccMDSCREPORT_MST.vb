'****************************************************************************************
'Generated By: MakeSFAR V.2.0.0 - 컨트롤 클래스 메이커 - 한화 S&C
'시스템구분 : 솔루션명 /시스템명/Server Control Class
'실행환경 : COM+ Service Server Package
'프로그램명 : ccMDCMEXECUTE.vb
'기능 : - 기능을 명시 합니다.
'특이  사항  : - 특이사항에 대해 표현
'-
'----------------------------------------------------------------------------------------
'HISTORY :1) 2004-03-30 오전 10:32:13 By MakeSFARV.2.0.0
'2) 2004-03-30 오전 10:32:13 By 작성자명을 씁니다.
'****************************************************************************************

Imports System.Xml ' XML처리 
Imports SCGLControl  ' ControlClass의 Base Class 
Imports SCGLUtil.cbSCGLConfig ' ConfigurationClass
Imports SCGLUtil.cbSCGLErr '오류처리 클래스
Imports SCGLUtil.cbSCGLXml  'XML처리 클래스
Imports SCGLUtil.cbSCGLUtil '기타유틸리티 클래스
Imports eMDCO

' 엔티티 클래스 사용시 해당 엔티티 클래스의 프로젝트를 참조한 후 Imports 하십시요. 
' Imports 엔티티프로젝트

Public Class ccMDSCREPORT_MST
    Inherits ccControl

#Region "GROUP BLOCK : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccMDSCREPORT_MST" '자신의 클래스명
    Private mobjceMD_REPORT_MSTTOTAL As eMDCO.ceMD_REPORT_MSTTOTAL '사용할 Entity 변수 선언
#End Region

#Region "GROUP BLOCK : Property 선언"
#End Region

#Region "GROUP BLOCK : Event 선언"
#End Region

#Region "GROUP BLOCK : 외부에 공개 Method"
    ' =============== 광고 매체 거래명세표
    Public Function SelectRtn_REPORT_MST(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strYEARMON As String, _
                                         ByVal strCLIENTCODE As String, _
                                         ByVal strGUBUN As String) As Object  'XML  데이터 조회시

        Dim strSQL As String
        Dim strFormet, strWhere As String
        Dim Con1, Con2 As String
        Dim vntData As Object

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML) '기본정보 설정

                Con1 = "" : Con2 = ""

                If strCLIENTCODE <> "" Then
                    If strGUBUN = "RO" Or strGUBUN = "SO" Or strGUBUN = "PO" Then
                        Con1 = String.Format("AND (DBO.PD_JOBCLIENTCODE_FUN(JOBNO) = '{0}')", strCLIENTCODE)
                    ElseIf strGUBUN = "OO" Then
                        Con1 = String.Format("AND (DBO.PD_JOBCLIENTCODE_FUN(JOBNO) = '{0}')", strCLIENTCODE)
                        Con2 = String.Format(" AND (CLIENTCODE = '{0}')", strCLIENTCODE)
                    Else
                        Con1 = String.Format(" AND (CLIENTCODE = '{0}')", strCLIENTCODE)
                    End If
                End If

                strWhere = BuildFields(" ", Con1)

                'value="A"  전파
                'value="B"  인쇄
                'value="DS" 옥외(취급액/매출액) 
                'value="DO" 옥외(외주비)
                'value="O"  온라인1
                'value="OS" 온라인2(매출액)
                'value="OO" 온라인2(외주비)
                'value="RS" 프로모션(매출액)
                'value="RO" 프로모션(외주비)
                'value="SS" SP.Comm(매출액) 
                'value="SO" SP.Comm(외주비)
                'value="PS" 제작(매출액)
                'value="PO" 제작(외주비)

                If strGUBUN = "A" Then '전파
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " 'CATV' GUBUN,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.REAL_MED_CODE) REAL_MED_NAME,"
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.MEDCODE) MEDNAME, "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME, "
                    strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMECATV_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE) SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT,  "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) BUSINO,"
                    strFormet = strFormet & " A.MEMO, 1 SORT_GBN"
                    strFormet = strFormet & " FROM MD_CATV_MEDIUM  A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_CATVTRANS_DTL "
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_CATVCOMMI_DTL "
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ "
                    strFormet = strFormet & " WHERE 1=1 "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE,  "
                    strFormet = strFormet & " A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE, "
                    strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMECATV_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE),"
                    strFormet = strFormet & " A.MEMO"
                    strFormet = strFormet & " UNION ALL  "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " 'CATV' GUBUN,"
                    strFormet = strFormet & " 'CATV 합계' REAL_MED_NAME,"
                    strFormet = strFormet & " '' MEDNAME, "
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT,  "
                    strFormet = strFormet & " '' BUSINO,"
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN"
                    strFormet = strFormet & " FROM MD_CATV_MEDIUM A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_CATVTRANS_DTL "
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_CATVCOMMI_DTL "
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ "
                    strFormet = strFormet & " WHERE 1=1 "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE  "
                    strFormet = strFormet & " UNION ALL  "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " '종합편성방송' GUBUN,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.REAL_MED_CODE) REAL_MED_NAME,"
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.MEDCODE) MEDNAME, "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME, "
                    strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMETOTAL_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE) SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT,  "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) BUSINO,"
                    strFormet = strFormet & " A.MEMO, 3 SORT_GBN"
                    strFormet = strFormet & " FROM MD_TOTAL_MEDIUM  A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_TOTALTRANS_DTL "
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_TOTALCOMMI_DTL "
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ "
                    strFormet = strFormet & " WHERE 1=1 "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE,  "
                    strFormet = strFormet & " A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE, "
                    strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMETOTAL_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE),"
                    strFormet = strFormet & " A.MEMO "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " '종합편성방송' GUBUN,"
                    strFormet = strFormet & " '종합편성방송 합계' REAL_MED_NAME,"
                    strFormet = strFormet & " '' MEDNAME, "
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT,  "
                    strFormet = strFormet & " '' BUSINO,"
                    strFormet = strFormet & " '' MEMO, 4 SORT_GBN"
                    strFormet = strFormet & " FROM MD_TOTAL_MEDIUM A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_TOTALTRANS_DTL "
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & "  SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & "  FROM MD_TOTALCOMMI_DTL "
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ "
                    strFormet = strFormet & " WHERE 1=1 "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE  "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " YEARMON,"
                    strFormet = strFormet & " '전파' GUBUN,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(REAL_MED_CODE) REAL_MED_NAME,"
                    strFormet = strFormet & " '' MEDNAME,"
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE))   AMT,"
                    strFormet = strFormet & " (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS VAT,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) + (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS SUMAMTVAT,"
                    strFormet = strFormet & " NULL COMMI_RATE,"
                    strFormet = strFormet & " SUM(ISNULL(SUSU,0)) COMMISSION,"
                    strFormet = strFormet & " SUM(ISNULL(SUSU,0)) + SUM(ISNULL(SUSU,0) * 0.1) SUMSUSUVAT,"
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(REAL_MED_CODE) BUSINO,"
                    strFormet = strFormet & " '' MEMO, 5 SORT_GBN "
                    strFormet = strFormet & " FROM MD_ELECTRIC_SUSUTEMP "
                    strFormet = strFormet & " WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " GROUP BY YEARMON, REAL_MED_CODE , CLIENTCODE "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " '전파' GUBUN,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(REAL_MED_CODE) REAL_MED_NAME,"
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(MEDCODE) MEDNAME, "
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT, "
                    strFormet = strFormet & " SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS VAT,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS SUMAMTVAT,"
                    strFormet = strFormet & " CASE SUM(ISNULL(AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(COMMISSION,0)) /  SUM(ISNULL(AMT,0)) * 100),2) END COMMI_RATE,"
                    strFormet = strFormet & " SUM(ISNULL(COMMISSION,0)) COMMISSION,"
                    strFormet = strFormet & " SUM(ISNULL(COMMISSION,0)) + SUM(ISNULL(COMMISSION,0) * 0.1) SUMSUSUVAT,"
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(REAL_MED_CODE) BUSINO,"
                    strFormet = strFormet & " MEMO, 6 SORT_GBN"
                    strFormet = strFormet & " FROM MD_ELECTRIC_MEDIUM "
                    strFormet = strFormet & " WHERE 1=1 "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " {0}"
                    strFormet = strFormet & " AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & " AND SPONSOR = 'Y'"
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE,  "
                    strFormet = strFormet & " REAL_MED_CODE, MEDCODE,"
                    strFormet = strFormet & " MEMO"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " YEARMON,"
                    strFormet = strFormet & " '전파' GUBUN,"
                    strFormet = strFormet & " '공중파 합계' REAL_MED_NAME,"
                    strFormet = strFormet & " '' MEDNAME,"
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(AMT) AMT, SUM(VAT) VAT,"
                    strFormet = strFormet & " SUM(SUMAMTVAT) SUMAMTVAT,"
                    strFormet = strFormet & " NULL COMMI_RATE,"
                    strFormet = strFormet & " SUM(COMMISSION) COMMISSION,"
                    strFormet = strFormet & " SUM(SUMSUSUVAT) SUMSUSUVAT,"
                    strFormet = strFormet & " '' BUSINO,"
                    strFormet = strFormet & " '' MEMO, 7 SORT_GBN"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & "  SELECT"
                    strFormet = strFormet & "  CLIENTCODE,"
                    strFormet = strFormet & "  YEARMON,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE))   AMT,"
                    strFormet = strFormet & "  (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS VAT,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) + (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS SUMAMTVAT,"
                    strFormet = strFormet & "  SUM(ISNULL(SUSU,0)) COMMISSION,"
                    strFormet = strFormet & "  SUM(ISNULL(SUSU,0)) + SUM(ISNULL(SUSU,0) * 0.1) SUMSUSUVAT "
                    strFormet = strFormet & "  FROM MD_ELECTRIC_SUSUTEMP "
                    strFormet = strFormet & "  WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  GROUP BY YEARMON ,CLIENTCODE  "
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT, "
                    strFormet = strFormet & "  SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS VAT,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) + SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS SUMAMTVAT,"
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) COMMISSION,"
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) + SUM(ISNULL(COMMISSION,0) * 0.1) SUMSUSUVAT"
                    strFormet = strFormet & "  FROM MD_ELECTRIC_MEDIUM "
                    strFormet = strFormet & "  WHERE 1=1 "
                    strFormet = strFormet & "  AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & "  AND SPONSOR = 'Y'"
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6) , CLIENTCODE  "
                    strFormet = strFormet & " ) A"
                    strFormet = strFormet & " GROUP BY YEARMON , CLIENTCODE  "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " YEARMON,"
                    strFormet = strFormet & " '총계' GUBUN,"
                    strFormet = strFormet & " '총  계' REAL_MED_NAME,"
                    strFormet = strFormet & " '' MEDNAME, "
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " '' SUBSEQNAME,"
                    strFormet = strFormet & " SUM(AMT) AMT, SUM(VAT) VAT,"
                    strFormet = strFormet & " SUM(SUMAMTVAT) SUMAMTVAT,"
                    strFormet = strFormet & " NULL COMMI_RATE,"
                    strFormet = strFormet & " SUM(COMMISSION) COMMISSION,"
                    strFormet = strFormet & " SUM(SUMSUSUVAT) SUMSUSUVAT,"
                    strFormet = strFormet & " '' BUSINO,"
                    strFormet = strFormet & " '' MEMO, 8 SORT_GBN"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  A.CLIENTCODE, "
                    strFormet = strFormet & "  SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT "
                    strFormet = strFormet & " FROM MD_CATV_MEDIUM A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & " SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & " FROM MD_CATVTRANS_DTL "
                    strFormet = strFormet & "  ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & "  LEFT JOIN ( "
                    strFormet = strFormet & " SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & " FROM MD_CATVCOMMI_DTL "
                    strFormet = strFormet & "  ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ  "
                    strFormet = strFormet & "  WHERE 1=1 "
                    strFormet = strFormet & "  AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & "  GROUP BY SUBSTRING(A.DEMANDDAY,1,6) , A.CLIENTCODE  "
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  A.CLIENTCODE, "
                    strFormet = strFormet & "  SUBSTRING(A.DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,"
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION,  "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT "
                    strFormet = strFormet & " FROM MD_TOTAL_MEDIUM A "
                    strFormet = strFormet & " LEFT JOIN ( "
                    strFormet = strFormet & " SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & " FROM MD_TOTALTRANS_DTL "
                    strFormet = strFormet & "  ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ "
                    strFormet = strFormet & "  LEFT JOIN ( "
                    strFormet = strFormet & " SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT "
                    strFormet = strFormet & " FROM MD_TOTALCOMMI_DTL "
                    strFormet = strFormet & "  ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ  "
                    strFormet = strFormet & "  WHERE 1=1 "
                    strFormet = strFormet & "  AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '')"
                    strFormet = strFormet & "  GROUP BY SUBSTRING(A.DEMANDDAY,1,6) , A.CLIENTCODE  "
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  YEARMON,"
                    strFormet = strFormet & "  SUM(AMT) AMT, SUM(VAT) VAT,"
                    strFormet = strFormet & "  SUM(SUMAMTVAT) SUMAMTVAT,"
                    strFormet = strFormet & "  SUM(COMMISSION) COMMISSION,"
                    strFormet = strFormet & "  SUM(SUMSUSUVAT) SUMSUSUVAT"
                    strFormet = strFormet & "  FROM ("
                    strFormet = strFormet & "  SELECT "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  YEARMON,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE))   AMT,"
                    strFormet = strFormet & "  (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS VAT,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) + (SUM(ISNULL(AMT,0) - DBO.MD_REPORT_AMT_FUN(YEARMON, CLIENTCODE, REAL_MED_CODE)) * 0.1) AS SUMAMTVAT,"
                    strFormet = strFormet & "  SUM(ISNULL(SUSU,0)) COMMISSION,"
                    strFormet = strFormet & "  SUM(ISNULL(SUSU,0)) + SUM(ISNULL(SUSU,0) * 0.1) SUMSUSUVAT "
                    strFormet = strFormet & "  FROM MD_ELECTRIC_SUSUTEMP "
                    strFormet = strFormet & "  WHERE YEARMON = '" & strYEARMON & "' "
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  GROUP BY YEARMON, CLIENTCODE"
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  CLIENTCODE, "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT, "
                    strFormet = strFormet & "  SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS VAT,"
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) + SUM(CASE ISNULL(TRU_TAX_FLAG,'N') WHEN 'Y' THEN ISNULL(AMT,0) * 0.1 ELSE 0 END) AS SUMAMTVAT,"
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) COMMISSION,"
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) + SUM(ISNULL(COMMISSION,0) * 0.1) SUMSUSUVAT "
                    strFormet = strFormet & "  FROM MD_ELECTRIC_MEDIUM "
                    strFormet = strFormet & "  WHERE 1=1 "
                    strFormet = strFormet & "  AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  {0}"
                    strFormet = strFormet & "  AND (ISNULL(TRU_TAX_NO,'') <> '' OR ISNULL(COMMI_TAX_NO,'') <> '') "
                    strFormet = strFormet & "  AND SPONSOR = 'Y' "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE "
                    strFormet = strFormet & "   ) A"
                    strFormet = strFormet & "  GROUP BY YEARMON , CLIENTCODE  "
                    strFormet = strFormet & "  ) C "
                    strFormet = strFormet & "  GROUP BY YEARMON ,CLIENTCODE  "
                    strFormet = strFormet & "  ORDER BY CLIENTNAME, YEARMON, SORT_GBN, REAL_MED_NAME, MEDNAME, TIMNAME, SUBSEQNAME "


                ElseIf strGUBUN = "B" Then '인쇄
                    'strFormet = " SELECT  "
                    'strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    'strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    'strFormet = strFormet & " '인쇄' GUBUN, "
                    'strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.REAL_MED_CODE) REAL_MED_NAME, "
                    'strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.MEDCODE) MEDNAME,  "
                    'strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME,  "
                    'strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMEPRINT_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE) SUBSEQNAME, "
                    'strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    'strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    'strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    'strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE, "
                    'strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    'strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT, "
                    'strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) BUSINO, "
                    'strFormet = strFormet & " A.MEMO, 1 SORT_GBN "
                    'strFormet = strFormet & " FROM MD_BOOKING_MEDIUM A"
                    'strFormet = strFormet & " LEFT JOIN ("
                    'strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    'strFormet = strFormet & " 	FROM MD_PRINTTRANS_DTL"
                    'strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    'strFormet = strFormet & " LEFT JOIN ("
                    'strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    'strFormet = strFormet & " 	FROM MD_PRINTCOMMI_DTL"
                    'strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    'strFormet = strFormet & " WHERE 1=1  "
                    'strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    'strFormet = strFormet & " {0} "
                    'strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    'strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),CLIENTCODE, "
                    'strFormet = strFormet & " A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE,  "
                    'strFormet = strFormet & " DBO.MD_REPORT_SUBSEQNAMEPRINT_FUN(SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE), "
                    'strFormet = strFormet & " A.MEMO "
                    'strFormet = strFormet & " UNION ALL "
                    'strFormet = strFormet & " SELECT  "
                    'strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    'strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    'strFormet = strFormet & " '인쇄' GUBUN, "
                    'strFormet = strFormet & " '총  계' REAL_MED_NAME, "
                    'strFormet = strFormet & " '' MEDNAME,  "
                    'strFormet = strFormet & " '' TIMNAME,  "
                    'strFormet = strFormet & " '' SUBSEQNAME, "
                    'strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    'strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    'strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    'strFormet = strFormet & " NULL  COMMI_RATE, "
                    'strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    'strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT, "
                    'strFormet = strFormet & " '' BUSINO, "
                    'strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    'strFormet = strFormet & " FROM MD_BOOKING_MEDIUM A"
                    'strFormet = strFormet & " LEFT JOIN ("
                    'strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    'strFormet = strFormet & " 	FROM MD_PRINTTRANS_DTL"
                    'strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    'strFormet = strFormet & " LEFT JOIN ("
                    'strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    'strFormet = strFormet & " 	FROM MD_PRINTCOMMI_DTL"
                    'strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    'strFormet = strFormet & " WHERE 1=1  "
                    'strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    'strFormet = strFormet & " {0} "
                    'strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    'strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE "
                    'strFormet = strFormet & " ORDER BY CLIENTNAME,YEARMON, SORT_GBN, REAL_MED_NAME, MEDNAME, TIMNAME, SUBSEQNAME "


                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " D.CUSTNAME CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '인쇄' GUBUN, "
                    strFormet = strFormet & " E.COMPANYNAME REAL_MED_NAME, "
                    strFormet = strFormet & " G.CUSTNAME MEDNAME,  "
                    strFormet = strFormet & " F.CUSTNAME TIMNAME,  "
                    strFormet = strFormet & " H.SEQNAME SUBSEQNAME, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END  COMMI_RATE, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT, "
                    strFormet = strFormet & " E.BUSINO BUSINO, "
                    strFormet = strFormet & " A.MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM MD_BOOKING_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_PRINTTRANS_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_PRINTCOMMI_DTL"
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    strFormet = strFormet & " LEFT JOIN SC_CUST_HDR D ON A.CLIENTCODE = D.HIGHCUSTCODE AND D.MEDFLAG = 'A'"
                    strFormet = strFormet & " LEFT JOIN SC_CUST_HDR E ON A.REAL_MED_CODE = E.HIGHCUSTCODE AND E.MEDFLAG = 'B'"
                    strFormet = strFormet & " LEFT JOIN SC_CUST_DTL F ON A.CLIENTCODE = F.HIGHCUSTCODE AND A.TIMCODE = F.CUSTCODE AND F.MEDFLAG = 'A'"
                    strFormet = strFormet & " LEFT JOIN SC_CUST_DTL G ON A.REAL_MED_CODE = G.HIGHCUSTCODE  AND A.MEDCODE = G.CUSTCODE AND G.MEDFLAG = 'B'"
                    strFormet = strFormet & " LEFT JOIN Sc_SUBSEQ_DTL H ON A.SUBSEQ = H.SEQNO AND A.CLIENTCODE = H.CUSTCODE AND A.TIMCODE = H.TIMCODE AND ISNULL(H.ATTR01,'') = 'Y'"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),CLIENTCODE, "
                    strFormet = strFormet & " A.REAL_MED_CODE, A.MEDCODE, A.TIMCODE, D.CUSTNAME, E.COMPANYNAME,E.BUSINO,F.CUSTNAME,G.CUSTNAME,"
                    strFormet = strFormet & " H.SEQNAME,"
                    strFormet = strFormet & " A.MEMO "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '인쇄' GUBUN, "
                    strFormet = strFormet & " '총  계' REAL_MED_NAME, "
                    strFormet = strFormet & " '' MEDNAME,  "
                    strFormet = strFormet & " '' TIMNAME,  "
                    strFormet = strFormet & " '' SUBSEQNAME, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " NULL  COMMI_RATE, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT, "
                    strFormet = strFormet & " '' BUSINO, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM MD_BOOKING_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_PRINTTRANS_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_PRINTCOMMI_DTL"
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME,YEARMON, SORT_GBN, REAL_MED_NAME, MEDNAME, TIMNAME, SUBSEQNAME "




                ElseIf strGUBUN = "DS" Then '옥외(취급액/매출액) 
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '옥외' GUBUN, "
                    strFormet = strFormet & " A.TITLE,  "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END COMMI_RATE, "
                    strFormet = strFormet & " A.MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM MD_OUTDOOR_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_OUTDOORCOMMI_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND ISNULL(A.COMMI_TAX_NO,'') <> '' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE, "
                    strFormet = strFormet & " A.TITLE, A.TIMCODE,  "
                    strFormet = strFormet & " A.MEMO "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '옥외' GUBUN, "
                    strFormet = strFormet & " '총  계' TITLE,  "
                    strFormet = strFormet & " '' TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END COMMI_RATE, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM MD_OUTDOOR_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_OUTDOORCOMMI_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND ISNULL(A.COMMI_TAX_NO,'') <> '' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, TITLE, TIMNAME "


                ElseIf strGUBUN = "DO" Then '옥외(외주비)
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '옥외' GUBUN, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.REAL_MED_CODE) REAL_MED_NAME, "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.OUT_AMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN ISNULL(A.OUT_AMT,0) * 0.1 ELSE B.VAT END) AS VAT  , "
                    strFormet = strFormet & " SUM(ISNULL(A.OUT_AMT,0)) + "
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN ISNULL(A.OUT_AMT,0) * 0.1 ELSE B.VAT END) AS SUMAMTVAT,"
                    strFormet = strFormet & " A.TITLE,  "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) BUSINO, "
                    strFormet = strFormet & " A.MEMO, 1 SORT_GBN ,"
                    strFormet = strFormet & " A.TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM MD_OUTDOOR_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN MD_TRUVOCH_MST B"
                    strFormet = strFormet & " ON A.YEARMON = B.TAXYEARMON AND A.SEQ = B.TAXNO AND B.GBN = 'O' AND B.MEDFLAG = 'D2'"
                    strFormet = strFormet & " AND A.TRU_VOCH_NO = B.VOCHNO"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND ISNULL(A.TRU_VOCH_NO,'') <> '' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE, "
                    strFormet = strFormet & " A.REAL_MED_CODE, A.TIMCODE, A.TITLE, "
                    strFormet = strFormet & " A.MEMO , A.TRU_VOCH_NO, C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '옥외' GUBUN, "
                    strFormet = strFormet & " '총  계' REAL_MED_NAME, "
                    strFormet = strFormet & " '' TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.OUT_AMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN ISNULL(A.OUT_AMT,0) * 0.1 ELSE B.VAT END) AS VAT  , "
                    strFormet = strFormet & " SUM(ISNULL(A.OUT_AMT,0)) + "
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN ISNULL(A.OUT_AMT,0) * 0.1 ELSE B.VAT END) AS SUMAMTVAT,"
                    strFormet = strFormet & " '' TITLE,  "
                    strFormet = strFormet & " '' BUSINO, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN ,"
                    strFormet = strFormet & " '' TRU_VOCH_NO,"
                    strFormet = strFormet & " '' PAYCODENAME,"
                    strFormet = strFormet & " '' DEMANDDAY,"
                    strFormet = strFormet & " '' DOCUMENTDATE"
                    strFormet = strFormet & " FROM MD_OUTDOOR_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN MD_TRUVOCH_MST B"
                    strFormet = strFormet & " ON A.YEARMON = B.TAXYEARMON AND A.SEQ = B.TAXNO AND B.GBN = 'O' AND B.MEDFLAG = 'D2'"
                    strFormet = strFormet & " AND A.TRU_VOCH_NO = B.VOCHNO"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND ISNULL(A.TRU_VOCH_NO,'') <> '' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, REAL_MED_NAME, TIMNAME "


                ElseIf strGUBUN = "O" Then '온라인1

                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '온라인I' GUBUN, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.REAL_MED_CODE) REAL_MED_NAME, "
                    strFormet = strFormet & " CASE A.VOCH_TYPE WHEN '0' THEN '매체광고비'  "
                    strFormet = strFormet & " WHEN '1' THEN '협찬광고비' "
                    strFormet = strFormet & " WHEN '2' THEN '키워드광고비' "
                    strFormet = strFormet & " END AS MEDNAME,  "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME,  "
                    strFormet = strFormet & " DBO.SC_GET_SUBSEQNAME_FUN(A.SUBSEQ) SUBSEQNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " CASE SUM(ISNULL(A.AMT,0)) WHEN 0 THEN 0 ELSE Round((SUM(ISNULL(A.COMMISSION,0)) /  SUM(ISNULL(A.AMT,0)) * 100),2) END COMMI_RATE, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT, "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.REAL_MED_CODE) BUSINO, "
                    strFormet = strFormet & " A.MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM MD_INTERNET_MEDIUM  A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_INTERNETTRANS_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_INTERNETCOMMI_DTL"
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE, "
                    strFormet = strFormet & " A.REAL_MED_CODE, A.TIMCODE,  A.SUBSEQ,"
                    strFormet = strFormet & " A.MEMO, A.VOCH_TYPE "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '온라인I' GUBUN, "
                    strFormet = strFormet & " '총  계' REAL_MED_NAME, "
                    strFormet = strFormet & " '' MEDNAME,  "
                    strFormet = strFormet & " '' TIMNAME,  "
                    strFormet = strFormet & " '' SUBSEQNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(B.VAT,0)) AS VAT, "
                    strFormet = strFormet & " SUM(ISNULL(A.AMT,0)) + SUM(ISNULL(B.VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " NULL COMMI_RATE, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) COMMISSION, "
                    strFormet = strFormet & " SUM(ISNULL(A.COMMISSION,0)) + SUM(ISNULL(C.VAT,0)) SUMSUSUVAT,"
                    strFormet = strFormet & " '' BUSINO, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM MD_INTERNET_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_INTERNETTRANS_DTL"
                    strFormet = strFormet & " ) B ON A.YEARMON = B.YEARMON AND A.SEQ = B.SEQ"
                    strFormet = strFormet & " LEFT JOIN ("
                    strFormet = strFormet & " 	SELECT TRUST_YEARMON YEARMON, TRUST_SEQ SEQ, AMT, VAT"
                    strFormet = strFormet & " 	FROM MD_INTERNETCOMMI_DTL"
                    strFormet = strFormet & " ) C ON A.YEARMON = C.YEARMON AND A.SEQ = C.SEQ"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND (ISNULL(A.TRU_TAX_NO,'') <> '' OR ISNULL(A.COMMI_TAX_NO,'') <> '') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6), A.CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, REAL_MED_NAME, MEDNAME, TIMNAME "


                ElseIf strGUBUN = "OS" Then '온라인2(매출액)

                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '온라인II' GUBUN, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO) PROJECTNAME, "
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(TIMCODE) TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN ,JOBNO"
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA07' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON,CLIENTCODE, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO), TIMCODE ,JOBNO"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '온라인II' GUBUN, "
                    strFormet = strFormet & " '총  계' PROJECTNAME, "
                    strFormet = strFormet & " '' TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN ,"
                    strFormet = strFormet & " '' JOBNO"
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA07' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON, CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, PROJECTNAME, TIMNAME ,JOBNO"

                ElseIf strGUBUN = "OO" Then '온라인2(외주비)

                    strFormet = " SELECT"
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.ADJDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " '온라인II' GUBUN,  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.OUTSCODE) EXCLIENTNAME,  "
                    strFormet = strFormet & " '광고제작비' SUMM,  "
                    strFormet = strFormet & " DBO.PD_JOBTIMNAME_FUN(A.JOBNO) TIMNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(A.ADJAMT,0)) AMT,"
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN CASE DBO.PD_TAXCODE_FUN(A.VATCODE) WHEN 'T' THEN FLOOR(A.AMT* 0.1) WHEN 'F' THEN 0 ELSE 0 END ELSE B.VAT END) AS VAT  ,"
                    strFormet = strFormet & " SUM(ISNULL(A.ADJAMT,0)) + SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN CASE DBO.PD_TAXCODE_FUN(A.VATCODE) WHEN 'T' THEN FLOOR(A.AMT* 0.1) WHEN 'F' THEN 0 ELSE 0 END ELSE B.VAT END) AS SUMAMTVAT,  "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.OUTSCODE) BUSINO,  "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN,"
                    strFormet = strFormet & " A.VOCHNO TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL A"
                    strFormet = strFormet & " LEFT JOIN PD_VOCH_MST B"
                    strFormet = strFormet & " ON SUBSTRING(A.PURCHASENO,1,6) = B.TAXYEARMON AND CAST(SUBSTRING(A.PURCHASENO,7,4) AS NUMERIC) = B.TAXNO"
                    strFormet = strFormet & " AND B.GBN = 'B'"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1"
                    strFormet = strFormet & " AND SUBSTRING(A.ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " " & Con1 & " "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(A.JOBNO) = 'PA07'  "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO),  "
                    strFormet = strFormet & " OUTSCODE, DBO.PD_JOBTIMNAME_FUN(A.JOBNO), "
                    strFormet = strFormet & " A.VOCHNO,"
                    strFormet = strFormet & " C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE,"
                    strFormet = strFormet & " b.VAT , A.VATCODE , A.AMT "
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUBSTRING(A.DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " '온라인II' GUBUN,  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.EXCLIENTCODE) EXCLIENTNAME,  "
                    strFormet = strFormet & " CASE A.VOCH_TYPE WHEN '0' THEN '매체광고 대행수수료'"
                    strFormet = strFormet & " WHEN '1' THEN '협찬광고 대행수수료'  "
                    strFormet = strFormet & " WHEN '2' THEN '키워드광고 대행수수료'  "
                    strFormet = strFormet & " END AS SUMM,"
                    strFormet = strFormet & " DBO.SC_GET_CUSTNAME_FUN(A.TIMCODE) TIMNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.EXSUSU,0)) AMT,"
                    strFormet = strFormet & " SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN FLOOR(ISNULL(A.EXSUSU,0) * 0.1) ELSE B.VAT END) AS VAT ,"
                    strFormet = strFormet & " SUM(ISNULL(A.EXSUSU,0)) + SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN FLOOR(ISNULL(A.EXSUSU,0) * 0.1) ELSE B.VAT END) AS SUMAMTVAT,  "
                    strFormet = strFormet & " DBO.SC_GET_BUSINO_FUN(A.EXCLIENTCODE) BUSINO,  "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN ,"
                    strFormet = strFormet & " A.EX_VOCH_NO TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM MD_INTERNET_MEDIUM A"
                    strFormet = strFormet & " LEFT JOIN MD_TRUVOCH_MST B"
                    strFormet = strFormet & " ON A.YEARMON = B.TAXYEARMON AND A.SEQ = B.TAXNO AND B.GBN = 'O' AND B.MEDFLAG = 'O2'"
                    strFormet = strFormet & " AND A.EX_VOCH_NO = B.VOCHNO"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1"
                    strFormet = strFormet & " AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " " & Con2 & " "
                    strFormet = strFormet & " AND (ISNULL(A.EX_VOCH_NO,'') <> '')  "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.DEMANDDAY,1,6),CLIENTCODE,  "
                    strFormet = strFormet & " A.EXCLIENTCODE, A.TIMCODE,"
                    strFormet = strFormet & " A.VOCH_TYPE, A.EX_VOCH_NO, "
                    strFormet = strFormet & " C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " CLIENTNAME, "
                    strFormet = strFormet & " YEARMON, "
                    strFormet = strFormet & " '온라인II' GUBUN, "
                    strFormet = strFormet & " '총  계' EXCLIENTNAME, "
                    strFormet = strFormet & " '' SUMM, "
                    strFormet = strFormet & " '' TIMNAME, "
                    strFormet = strFormet & " SUM(AMT) AMT, "
                    strFormet = strFormet & " SUM(VAT) VAT, "
                    strFormet = strFormet & " SUM(SUMAMTVAT) SUMAMTVAT, "
                    strFormet = strFormet & " '' BUSINO,  "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN  ,"
                    strFormet = strFormet & " '' TRU_VOCH_NO,"
                    strFormet = strFormet & " '' PAYCODENAME,"
                    strFormet = strFormet & " '' DEMANDDAY,"
                    strFormet = strFormet & " '' DOCUMENTDATE"
                    strFormet = strFormet & " FROM ( "
                    strFormet = strFormet & "  SELECT"
                    strFormet = strFormet & "  DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO) CLIENTNAME,  "
                    strFormet = strFormet & "  SUBSTRING(A.ADJDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " 	 SUM(ISNULL(A.ADJAMT,0)) AMT,"
                    strFormet = strFormet & " 	 SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN CASE DBO.PD_TAXCODE_FUN(A.VATCODE) WHEN 'T' THEN FLOOR(A.AMT* 0.1) WHEN 'F' THEN 0 ELSE 0 END ELSE B.VAT END) AS VAT  ,"
                    strFormet = strFormet & " 	 SUM(ISNULL(A.ADJAMT,0)) + SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN CASE DBO.PD_TAXCODE_FUN(A.VATCODE) WHEN 'T' THEN FLOOR(A.AMT* 0.1) WHEN 'F' THEN 0 ELSE 0 END ELSE B.VAT END) AS SUMAMTVAT "
                    strFormet = strFormet & "  FROM PD_EXE_DTL A left join PD_VOCH_MST B"
                    strFormet = strFormet & " 	 ON SUBSTRING(A.PURCHASENO,1,6) = B.TAXYEARMON "
                    strFormet = strFormet & " 	 AND CAST(SUBSTRING(A.PURCHASENO,7,4) AS NUMERIC) = B.TAXNO"
                    strFormet = strFormet & " 	 AND B.GBN = 'B'  "
                    strFormet = strFormet & "  WHERE 1=1"
                    strFormet = strFormet & "  AND SUBSTRING(A.ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & "" & Con1 & " "
                    strFormet = strFormet & "  AND DBO.PD_JOBGUBN_FUN(A.JOBNO) = 'PA07'  "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(A.ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO)  "
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT"
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & "  SUBSTRING(A.DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " 	 SUM(ISNULL(A.EXSUSU,0)) AMT,"
                    strFormet = strFormet & " 	 SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN FLOOR(ISNULL(A.EXSUSU,0) * 0.1) ELSE B.VAT END) AS VAT ,"
                    strFormet = strFormet & " 	 SUM(ISNULL(A.EXSUSU,0)) + SUM(CASE ISNULL(B.VAT,9999999999) WHEN 9999999999 THEN FLOOR(ISNULL(A.EXSUSU,0) * 0.1) ELSE B.VAT END) AS SUMAMTVAT"
                    strFormet = strFormet & "  FROM MD_INTERNET_MEDIUM A"
                    strFormet = strFormet & " 	 LEFT JOIN MD_TRUVOCH_MST B"
                    strFormet = strFormet & " 	 ON A.YEARMON = B.TAXYEARMON AND A.SEQ = B.TAXNO AND B.GBN = 'O' AND B.MEDFLAG = 'O2'"
                    strFormet = strFormet & " 	 AND A.EX_VOCH_NO = B.VOCHNO"
                    strFormet = strFormet & "  WHERE 1=1"
                    strFormet = strFormet & "  AND SUBSTRING(A.DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & "" & Con2 & " "
                    strFormet = strFormet & "  AND (ISNULL(A.EX_VOCH_NO,'') <> '')  "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(A.DEMANDDAY,1,6),A.CLIENTCODE,  "
                    strFormet = strFormet & "  A.EXCLIENTCODE, A.TIMCODE,"
                    strFormet = strFormet & "  A.VOCH_TYPE  "
                    strFormet = strFormet & " ) A "
                    strFormet = strFormet & " GROUP BY CLIENTNAME, YEARMON "
                    strFormet = strFormet & " ORDER BY CLIENTNAME , YEARMON, SORT_GBN, EXCLIENTNAME, TIMNAME "

                ElseIf strGUBUN = "RS" Then '프로모션(매출액)
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '프로모션' GUBUN, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO) PROJECTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & " AND DEPT_CD <> '11000536' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON,CLIENTCODE, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO) "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '프로모션' GUBUN, "
                    strFormet = strFormet & " '총  계' PROJECTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & " AND DEPT_CD <> '11000536' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON,CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, PROJECTNAME "

                ElseIf strGUBUN = "RO" Then '프로모션(외주비)

                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '프로모션' GUBUN, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.OUTSCODE) EXCLIENTNAME, "
                    strFormet = strFormet & " '용역비' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(A.ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(A.JOBNO) PROJECTNAME, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN ,"
                    strFormet = strFormet & " A.VOCHNO TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL A"
                    strFormet = strFormet & " LEFT JOIN PD_VOCH_MST B"
                    strFormet = strFormet & " ON SUBSTRING(A.PURCHASENO,1,6) = B.TAXYEARMON AND CAST(SUBSTRING(A.PURCHASENO,7,4) AS NUMERIC) = B.TAXNO"
                    strFormet = strFormet & " AND B.GBN = 'B'"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(A.JOBNO) = 'PA05' "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO) <> '11000536' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO), "
                    strFormet = strFormet & " A.OUTSCODE, DBO.PD_GET_JOBNO_PROJECTNM_FUN(A.JOBNO) , "
                    strFormet = strFormet & " A.VOCHNO,"
                    strFormet = strFormet & " C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '프로모션' GUBUN, "
                    strFormet = strFormet & " '총  계' EXCLIENTNAME, "
                    strFormet = strFormet & " '' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " '' PROJECTNAME, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN ,"
                    strFormet = strFormet & " '' TRU_VOCH_NO,"
                    strFormet = strFormet & " '' PAYCODENAME,"
                    strFormet = strFormet & " '' DEMANDDAY,"
                    strFormet = strFormet & " '' DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA05' "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_DEPTCDREAL_FUN(JOBNO) <> '11000536' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) "
                    strFormet = strFormet & " ORDER BY CLIENTNAME,YEARMON, SORT_GBN, EXCLIENTNAME "

                ElseIf strGUBUN = "SS" Then 'SP.Comm(매출액) 
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " 'Space .comm' GUBUN, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO) PROJECTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & " AND DEPT_CD = '11000536' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON,CLIENTCODE,  "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO) "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " 'Space .comm' GUBUN, "
                    strFormet = strFormet & " '총  계' PROJECTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & " AND DEPT_CD = '11000536' "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON, CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, PROJECTNAME "

                ElseIf strGUBUN = "SO" Then 'SP.Comm(외주비)

                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 'Space .comm' GUBUN, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.OUTSCODE) EXCLIENTNAME, "
                    strFormet = strFormet & " '용역비' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(A.ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(A.JOBNO) PROJECTNAME, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN ,"
                    strFormet = strFormet & " A.VOCHNO TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL A"
                    strFormet = strFormet & " LEFT JOIN PD_VOCH_MST B"
                    strFormet = strFormet & " ON SUBSTRING(A.PURCHASENO,1,6) = B.TAXYEARMON AND CAST(SUBSTRING(A.PURCHASENO,7,4) AS NUMERIC) = B.TAXNO"
                    strFormet = strFormet & " AND B.GBN = 'B'"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(A.JOBNO) = 'PA05' "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO) = '11000536' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO), "
                    strFormet = strFormet & " A.OUTSCODE, DBO.PD_GET_JOBNO_PROJECTNM_FUN(A.JOBNO) , "
                    strFormet = strFormet & " A.VOCHNO,"
                    strFormet = strFormet & " C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 'Space .comm' GUBUN, "
                    strFormet = strFormet & " '총  계' EXCLIENTNAME, "
                    strFormet = strFormet & " '' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " '' PROJECTNAME, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN ,"
                    strFormet = strFormet & " '' TRU_VOCH_NO,"
                    strFormet = strFormet & " '' PAYCODENAME,"
                    strFormet = strFormet & " '' DEMANDDAY,"
                    strFormet = strFormet & " '' DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA05' "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_DEPTCDREAL_FUN(JOBNO) = '11000536' "
                    strFormet = strFormet & " GROUP BY SUBSTRING(ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) "
                    strFormet = strFormet & " ORDER BY CLIENTNAME,YEARMON, SORT_GBN, EXCLIENTNAME "

                ElseIf strGUBUN = "PS" Then '제작(매출액)
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '제작' GUBUN, "
                    strFormet = strFormet & " JOBNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN not in('PA05','PA07') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON,CLIENTCODE, "
                    strFormet = strFormet & " DBO.PD_GET_JOBNO_PROJECTNM_FUN(JOBNO),JOBNAME "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " TAXYEARMON YEARMON, "
                    strFormet = strFormet & " '제작' GUBUN, "
                    strFormet = strFormet & " '총  계' JOBNAME, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) AMT,  "
                    strFormet = strFormet & " SUM(ISNULL(VAT,0)) VAT, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) + SUM(ISNULL(VAT,0)) AS SUMAMTVAT, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND JOBGUBN not in('PA05','PA07') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY TAXYEARMON, CLIENTCODE "
                    strFormet = strFormet & " ORDER BY CLIENTNAME, YEARMON, SORT_GBN, JOBNAME "

                ElseIf strGUBUN = "PO" Then '제작(외주비)
                    strFormet = " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(A.ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '제작' GUBUN, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(A.OUTSCODE) EXCLIENTNAME, "
                    strFormet = strFormet & " '용역비' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(A.ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " DBO.PD_JOBNAME_FUN(JOBNO) JOBNAME, "
                    strFormet = strFormet & " '' MEMO, 1 SORT_GBN ,"
                    strFormet = strFormet & " A.VOCHNO TRU_VOCH_NO,"
                    strFormet = strFormet & " SUBSTRING(C.CODE_NAME,10, LEN(C.CODE_NAME)) PAYCODENAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL A"
                    strFormet = strFormet & " LEFT JOIN PD_VOCH_MST B"
                    strFormet = strFormet & " ON SUBSTRING(A.PURCHASENO,1,6) = B.TAXYEARMON AND CAST(SUBSTRING(A.PURCHASENO,7,4) AS NUMERIC) = B.TAXNO"
                    strFormet = strFormet & " AND B.GBN = 'B'"
                    strFormet = strFormet & " LEFT JOIN SC_CODE C"
                    strFormet = strFormet & " ON C.CLASS_CODE = 'PD_PAYCODE' AND B.PAYCODE = C.CODE"
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(A.ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(A.JOBNO) not in('PA05','PA07') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(A.ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(A.JOBNO), "
                    strFormet = strFormet & " A.OUTSCODE, DBO.PD_JOBNAME_FUN(A.JOBNO) , "
                    strFormet = strFormet & " A.VOCHNO,"
                    strFormet = strFormet & " C.CODE_NAME,"
                    strFormet = strFormet & " B.DEMANDDAY,"
                    strFormet = strFormet & " B.DOCUMENTDATE"
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) CLIENTNAME, "
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '제작' GUBUN, "
                    strFormet = strFormet & " '총  계' EXCLIENTNAME, "
                    strFormet = strFormet & " '' SUMM, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) OUT_AMT,  "
                    strFormet = strFormet & " '' JOBNAME, "
                    strFormet = strFormet & " '' MEMO, 2 SORT_GBN ,"
                    strFormet = strFormet & " '' TRU_VOCH_NO,"
                    strFormet = strFormet & " '' PAYCODENAME,"
                    strFormet = strFormet & " '' DEMANDDAY,"
                    strFormet = strFormet & " '' DOCUMENTDATE"
                    strFormet = strFormet & " FROM PD_EXE_DTL "
                    strFormet = strFormet & " WHERE 1=1  "
                    strFormet = strFormet & " AND SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "'  "
                    strFormet = strFormet & " {0} "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(JOBNO) not in('PA05','PA07') "
                    strFormet = strFormet & " GROUP BY SUBSTRING(ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO) "
                    strFormet = strFormet & " ORDER BY CLIENTNAME,YEARMON, SORT_GBN, EXCLIENTNAME "
                End If

                strSQL = String.Format(strFormet, strWhere)

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function


    Public Function SelectRtn_REPORT_MST_TOTAL(ByVal strInfoXML As String, _
     ByRef intRowCnt As Integer, _
     ByRef intColCnt As Integer, _
     ByVal strYEARMON As String, _
     ByVal strGUBUN As String) As Object  'XML  데이터 조회시

        Dim strSQL As String
        Dim strFormet, strWhere As String
        Dim Con1 As String
        Dim vntData As Object
        Dim strFYEARMON
        Dim strCNT
        Dim i

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML) '기본정보 설정

                Con1 = ""

                If strYEARMON <> "" Then Con1 = String.Format(" AND (YEARMON = '{0}')", strYEARMON)

                strWhere = BuildFields(" ", Con1)

                'value="A"  취급액
                'value="B"  매출액
                'value="AO" AOR 및 대행수수료 
                'value="OU" 외주비
                'value="MC  월별 광고주별 매출이익
                'value="MR" 월별 매체별 매출이익

                If strGUBUN = "A" Then '취급액

                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " MAIN.YEARMON,"
                    strFormet = strFormet & " MAIN.CLIENTCODE,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(MAIN.CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " SUM(ISNULL(A.A,0)) A,"
                    strFormet = strFormet & " SUM(ISNULL(A.A2,0)) A2,"
                    strFormet = strFormet & " SUM(ISNULL(A.B,0)) B,"
                    strFormet = strFormet & " SUM(ISNULL(A.D,0)) D,"
                    strFormet = strFormet & " SUM(ISNULL(A.O1,0)) O1,"
                    strFormet = strFormet & " SUM(ISNULL(B.AMT,0)) O2,"
                    strFormet = strFormet & " SUM(ISNULL(C.AMT,0)) R,"
                    strFormet = strFormet & " SUM(ISNULL(D.AMT,0)) S,"
                    strFormet = strFormet & " SUM(ISNULL(E.AMT,0)) P,"
                    strFormet = strFormet & " 0 E,"
                    strFormet = strFormet & " SUM(ISNULL(A.SUMAMT,0))+SUM(ISNULL(B.AMT,0))+SUM(ISNULL(C.AMT,0))"
                    strFormet = strFormet & " + SUM(ISNULL(D.AMT,0))+SUM(ISNULL(E.AMT,0)) SUMAMT"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & " 	SELECT YEARMON, CLIENTCODE"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT "
                    strFormet = strFormet & "  		YEARMON,"
                    strFormet = strFormet & " 		CLIENTCODE"
                    strFormet = strFormet & " 		FROM MD_REPORTCOMMI_MST_V"
                    strFormet = strFormet & " 		WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & " 		UNION ALL"
                    strFormet = strFormet & " 		SELECT "
                    strFormet = strFormet & " 		SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 		CLIENTCODE"
                    strFormet = strFormet & " 		FROM PD_TAX_DTL"
                    strFormet = strFormet & " 		WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 		AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03')"
                    strFormet = strFormet & " 		AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	) BBBB GROUP BY YEARMON, CLIENTCODE"
                    strFormet = strFormet & " ) MAIN  "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	YEARMON,"
                    strFormet = strFormet & " 	CLIENTCODE,"
                    strFormet = strFormet & " 	DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(AMT,0) ELSE 0 END )A,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(AMT,0) ELSE 0 END) A2,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(AMT,0) ELSE 0 END) B,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(AMT,0) ELSE 0 END) D,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(AMT,0) ELSE 0 END) O1,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) SUMAMT"
                    strFormet = strFormet & " 	FROM MD_REPORTCOMMI_MST_V"
                    strFormet = strFormet & " 	WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & " GROUP BY YEARMON,CLIENTCODE"
                    strFormet = strFormet & " )A ON MAIN.YEARMON = A.YEARMON"
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = A.CLIENTCODE"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " (	"
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & "  	CLIENTCODE, "
                    strFormet = strFormet & " 	DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA07'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE"
                    strFormet = strFormet & " )B ON MAIN.YEARMON = B.YEARMON"
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = B.CLIENTCODE"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	CLIENTCODE, "
                    strFormet = strFormet & " 	DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA05'"
                    strFormet = strFormet & " 	AND DEPT_CD <> '11000536'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE"
                    strFormet = strFormet & " )C ON MAIN.YEARMON = C.YEARMON "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = C.CLIENTCODE"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	CLIENTCODE, "
                    strFormet = strFormet & " 	DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA05'"
                    strFormet = strFormet & " 	AND DEPT_CD = '11000536'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE"
                    strFormet = strFormet & " )D ON MAIN.YEARMON = D.YEARMON "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = D.CLIENTCODE"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	CLIENTCODE, "
                    strFormet = strFormet & " 	DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN not in('PA05','PA07','PA08')"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE"
                    strFormet = strFormet & " )E ON MAIN.YEARMON = E.YEARMON "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = E.CLIENTCODE"
                    strFormet = strFormet & " GROUP BY MAIN.YEARMON, MAIN.CLIENTCODE"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '' CLIENTCODE, "
                    strFormet = strFormet & " '기타' CLIENTNAME,"
                    strFormet = strFormet & " 0 A,"
                    strFormet = strFormet & " 0 A2,"
                    strFormet = strFormet & " 0 B,"
                    strFormet = strFormet & " 0 D,"
                    strFormet = strFormet & " 0 O1,"
                    strFormet = strFormet & " 0 O2,"
                    strFormet = strFormet & " 0 R,"
                    strFormet = strFormet & " 0 S,"
                    strFormet = strFormet & " 0 P,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) E,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) SUMAMT"
                    strFormet = strFormet & " FROM PD_TAX_DTL"
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " AND JOBGUBN in('PA08')"
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03')"
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " MAIN.YEARMON,"
                    strFormet = strFormet & " '' CLIENTCODE,"
                    strFormet = strFormet & " '총 계' CLIENTNAME,"
                    strFormet = strFormet & " ISNULL(A.A,0) A,"
                    strFormet = strFormet & " ISNULL(A.A2,0) A2,"
                    strFormet = strFormet & " ISNULL(A.B,0) B,"
                    strFormet = strFormet & " ISNULL(A.D,0) D,"
                    strFormet = strFormet & " ISNULL(A.O1,0) O1,"
                    strFormet = strFormet & " ISNULL(B.AMT,0) O2,"
                    strFormet = strFormet & " ISNULL(C.AMT,0) R,"
                    strFormet = strFormet & " ISNULL(D.AMT,0) S,"
                    strFormet = strFormet & " ISNULL(E.AMT,0) P,"
                    strFormet = strFormet & " ISNULL(F.E,0) E,"
                    strFormet = strFormet & " ISNULL(A.SUMAMT,0)+ISNULL(B.AMT,0)+ ISNULL(C.AMT,0)"
                    strFormet = strFormet & " +ISNULL(D.AMT,0)+ISNULL(E.AMT,0)+ISNULL(F.E,0) SUMAMT"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & " 	SELECT YEARMON"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT "
                    strFormet = strFormet & " 		YEARMON"
                    strFormet = strFormet & " 		FROM MD_REPORTCOMMI_MST_V"
                    strFormet = strFormet & " 		WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & " 		UNION ALL"
                    strFormet = strFormet & " 		SELECT "
                    strFormet = strFormet & " 		SUBSTRING(DEMANDDAY,1,6) YEARMON"
                    strFormet = strFormet & " 		FROM PD_TAX_DTL"
                    strFormet = strFormet & " 		WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 		AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03')"
                    strFormet = strFormet & " 		AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	) BBBB GROUP BY YEARMON"
                    strFormet = strFormet & " ) MAIN  "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	YEARMON,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(AMT,0) ELSE 0 END )A,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(AMT,0) ELSE 0 END) A2,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(AMT,0) ELSE 0 END) B,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(AMT,0) ELSE 0 END) D,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(AMT,0) ELSE 0 END) O1,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) SUMAMT"
                    strFormet = strFormet & " 	FROM MD_REPORTCOMMI_MST_V"
                    strFormet = strFormet & " 	WHERE YEARMON = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	GROUP BY YEARMON"
                    strFormet = strFormet & " )A ON MAIN.YEARMON = A.YEARMON"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " (	"
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA07'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " )B ON MAIN.YEARMON = B.YEARMON"
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA05'"
                    strFormet = strFormet & " 	AND DEPT_CD <> '11000536'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " )C ON MAIN.YEARMON = C.YEARMON "
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN = 'PA05'"
                    strFormet = strFormet & " 	AND DEPT_CD = '11000536'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " )D ON MAIN.YEARMON = D.YEARMON "
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	SUM(ISNULL(AMT,0)) AMT"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND JOBGUBN not in('PA05','PA07')"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " )E ON MAIN.YEARMON = E.YEARMON "
                    strFormet = strFormet & " LEFT JOIN"
                    strFormet = strFormet & " ("
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '' CLIENTCODE, "
                    strFormet = strFormet & " '기타' CLIENTNAME,"
                    strFormet = strFormet & " 0 A,"
                    strFormet = strFormet & " 0 A2,"
                    strFormet = strFormet & " 0 B,"
                    strFormet = strFormet & " 0 D,"
                    strFormet = strFormet & " 0 O1,"
                    strFormet = strFormet & " 0 O2,"
                    strFormet = strFormet & " 0 R,"
                    strFormet = strFormet & " 0 S,"
                    strFormet = strFormet & " 0 P,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) E,"
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) SUMAMT"
                    strFormet = strFormet & " FROM PD_TAX_DTL"
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "'"
                    strFormet = strFormet & " AND JOBGUBN in('PA08')"
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03')"
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6)"
                    strFormet = strFormet & " )F ON MAIN.YEARMON = F.YEARMON "


                ElseIf strGUBUN = "B" Then  '매출액 
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " MAIN.YEARMON, "
                    strFormet = strFormet & " MAIN.CLIENTCODE, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(MAIN.CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(A.A,0)) A, "
                    strFormet = strFormet & " SUM(ISNULL(A.A2,0)) A2, "
                    strFormet = strFormet & " SUM(ISNULL(A.B,0)) B, "
                    strFormet = strFormet & " SUM(ISNULL(A.D,0)) D, "
                    strFormet = strFormet & " SUM(ISNULL(A.O1,0)) O1, "
                    strFormet = strFormet & " SUM(ISNULL(B.AMT,0)) O2, "
                    strFormet = strFormet & " SUM(ISNULL(C.AMT,0)) R, "
                    strFormet = strFormet & " SUM(ISNULL(D.AMT,0)) S, "
                    strFormet = strFormet & " SUM(ISNULL(E.AMT,0)) P, "
                    strFormet = strFormet & " 0 E, "
                    strFormet = strFormet & " SUM(ISNULL(A.SUMCOMMISSION,0))+SUM(ISNULL(B.AMT,0))+SUM(ISNULL(C.AMT,0)) "
                    strFormet = strFormet & " + SUM(ISNULL(D.AMT,0))+SUM(ISNULL(E.AMT,0)) SUMAMT "
                    strFormet = strFormet & " FROM ( "
                    strFormet = strFormet & "  SELECT YEARMON, CLIENTCODE "
                    strFormet = strFormet & "  FROM ( "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "YEARMON, "
                    strFormet = strFormet & "CLIENTCODE "
                    strFormet = strFormet & "FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "WHERE YEARMON = '" & strYEARMON & "' "
                    strFormet = strFormet & "UNION ALL "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "CLIENTCODE "
                    strFormet = strFormet & "FROM PD_TAX_DTL "
                    strFormet = strFormet & "WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03') "
                    strFormet = strFormet & "AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  ) BBBB GROUP BY YEARMON, CLIENTCODE "
                    strFormet = strFormet & " ) MAIN"
                    strFormet = strFormet & " LEFT JOIN  "
                    strFormet = strFormet & " (  "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  YEARMON, "
                    strFormet = strFormet & "  CLIENTCODE, "
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(COMMISSION,0) ELSE 0 END )A, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(COMMISSION,0) ELSE 0 END) A2, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(COMMISSION,0) ELSE 0 END) B, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(COMMISSION,0) ELSE 0 END) D, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(COMMISSION,0) ELSE 0 END) O1, "
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) SUMCOMMISSION "
                    strFormet = strFormet & "  FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "  WHERE YEARMON = '" & strYEARMON & "' "
                    strFormet = strFormet & "  GROUP BY YEARMON,CLIENTCODE "
                    strFormet = strFormet & " )A ON MAIN.YEARMON = A.YEARMON "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = A.CLIENTCODE "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA07' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE "
                    strFormet = strFormet & " )B ON MAIN.YEARMON = B.YEARMON "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = B.CLIENTCODE "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & "  AND DEPT_CD <> '11000536' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE "
                    strFormet = strFormet & " )C ON MAIN.YEARMON = C.YEARMON  "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = C.CLIENTCODE "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & "  AND DEPT_CD = '11000536' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE "
                    strFormet = strFormet & " )D ON MAIN.YEARMON = D.YEARMON  "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = D.CLIENTCODE "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE,  "
                    strFormet = strFormet & "  DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN not in('PA05','PA07') "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE "
                    strFormet = strFormet & " )E ON MAIN.YEARMON = E.YEARMON  "
                    strFormet = strFormet & " AND MAIN.CLIENTCODE = E.CLIENTCODE "
                    strFormet = strFormet & " GROUP BY MAIN.YEARMON, MAIN.CLIENTCODE "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " '' CLIENTCODE,  "
                    strFormet = strFormet & " '기타' CLIENTNAME, "
                    strFormet = strFormet & " 0 A, "
                    strFormet = strFormet & " 0 A2, "
                    strFormet = strFormet & " 0 B, "
                    strFormet = strFormet & " 0 D, "
                    strFormet = strFormet & " 0 O1, "
                    strFormet = strFormet & " 0 O2, "
                    strFormet = strFormet & " 0 R, "
                    strFormet = strFormet & " 0 S, "
                    strFormet = strFormet & " 0 P, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) E, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) SUMAMT "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " AND JOBGUBN in('PA08') "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " MAIN.YEARMON, "
                    strFormet = strFormet & " '' CLIENTCODE, "
                    strFormet = strFormet & " '총 계' CLIENTNAME, "
                    strFormet = strFormet & " ISNULL(A.A,0) A, "
                    strFormet = strFormet & " ISNULL(A.A2,0) A2, "
                    strFormet = strFormet & " ISNULL(A.B,0) B, "
                    strFormet = strFormet & " ISNULL(A.D,0) D, "
                    strFormet = strFormet & " ISNULL(A.O1,0) O1, "
                    strFormet = strFormet & " ISNULL(B.AMT,0) O2, "
                    strFormet = strFormet & " ISNULL(C.AMT,0) R, "
                    strFormet = strFormet & " ISNULL(D.AMT,0) S, "
                    strFormet = strFormet & " ISNULL(E.AMT,0) P, "
                    strFormet = strFormet & " ISNULL(F.E,0) E, "
                    strFormet = strFormet & " ISNULL(A.SUMCOMMISSION,0)+ISNULL(B.AMT,0)+ ISNULL(C.AMT,0) "
                    strFormet = strFormet & " +ISNULL(D.AMT,0)+ISNULL(E.AMT,0)+ISNULL(F.E,0) SUMAMT "
                    strFormet = strFormet & " FROM ( "
                    strFormet = strFormet & "  SELECT YEARMON "
                    strFormet = strFormet & "  FROM ( "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "YEARMON "
                    strFormet = strFormet & "FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "WHERE YEARMON = '" & strYEARMON & "' "
                    strFormet = strFormet & "UNION ALL "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "SUBSTRING(DEMANDDAY,1,6) YEARMON "
                    strFormet = strFormet & "FROM PD_TAX_DTL "
                    strFormet = strFormet & "WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03') "
                    strFormet = strFormet & "AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  ) BBBB GROUP BY YEARMON "
                    strFormet = strFormet & " ) MAIN"
                    strFormet = strFormet & " LEFT JOIN  "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  YEARMON, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(COMMISSION,0) ELSE 0 END )A, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(COMMISSION,0) ELSE 0 END) A2, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(COMMISSION,0) ELSE 0 END) B, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(COMMISSION,0) ELSE 0 END) D, "
                    strFormet = strFormet & "  SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(COMMISSION,0) ELSE 0 END) O1, "
                    strFormet = strFormet & "  SUM(ISNULL(COMMISSION,0)) SUMCOMMISSION "
                    strFormet = strFormet & "  FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "  WHERE YEARMON = '" & strYEARMON & "' "
                    strFormet = strFormet & "  GROUP BY YEARMON "
                    strFormet = strFormet & " )A ON MAIN.YEARMON = A.YEARMON "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA07' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " )B ON MAIN.YEARMON = B.YEARMON "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & "  AND DEPT_CD <> '11000536' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " )C ON MAIN.YEARMON = C.YEARMON  "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN = 'PA05' "
                    strFormet = strFormet & "  AND DEPT_CD = '11000536' "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " )D ON MAIN.YEARMON = D.YEARMON  "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  SUM(ISNULL(AMT,0)) AMT "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & "  AND JOBGUBN not in('PA05','PA07') "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " )E ON MAIN.YEARMON = E.YEARMON  "
                    strFormet = strFormet & " LEFT JOIN "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " '' CLIENTCODE,  "
                    strFormet = strFormet & " '기타' CLIENTNAME, "
                    strFormet = strFormet & " 0 A, "
                    strFormet = strFormet & " 0 A2, "
                    strFormet = strFormet & " 0 B, "
                    strFormet = strFormet & " 0 D, "
                    strFormet = strFormet & " 0 O1, "
                    strFormet = strFormet & " 0 O2, "
                    strFormet = strFormet & " 0 R, "
                    strFormet = strFormet & " 0 S, "
                    strFormet = strFormet & " 0 P, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) E, "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) SUMAMT "
                    strFormet = strFormet & " FROM PD_TAX_DTL "
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " AND JOBGUBN in('PA08') "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & " )F ON MAIN.YEARMON = F.YEARMON "



                ElseIf strGUBUN = "AO" Then 'AOR 및 대행수수료
                    strCNT = 0
                    strCNT = SelectRtn_CNT(strInfoXML, strYEARMON)

                    strFormet = " select yearmon, clientcode, "
                    For i = 1 To strCNT
                        strFormet = strFormet & " isnull(A" & i & ",0) A" & i & ","
                    Next
                    strFormet = strFormet & " ASUM"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & " 	select yearmon, '광고주' clientcode, "
                    For i = 1 To strCNT
                        strFormet = strFormet & " isnull(B.A" & i & ",0) A" & i & ","
                    Next
                    strFormet = strFormet & " 	ASUM "
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		select"
                    strFormet = strFormet & " 		yearmon yearmon,"
                    For i = 1 To strCNT
                        strFormet = strFormet & "dbo.sc_get_highcompanyname_fun(max(A" & i & ")) A" & i & ","
                    Next

                    strFormet = strFormet & " 		max(ASUM) ASUM	"
                    strFormet = strFormet & " 		from ("
                    strFormet = strFormet & " 			select"
                    strFormet = strFormet & " 			yearmon,"
                    For i = 1 To strCNT
                        strFormet = strFormet & " case num when " & i & " then exclientcode else null end as A" & i & ","
                    Next

                    strFormet = strFormet & " 		 '계' ASUM	"
                    strFormet = strFormet & " 			from ( "
                    strFormet = strFormet & " 				select yearmon, row_number() over(order by exclientcode asc) as num, exclientcode "
                    strFormet = strFormet & " 				from MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & " 				where yearmon = '" & strYEARMON & "' and left(exclientcode,1) = 'G'"
                    strFormet = strFormet & " 				group by yearmon, exclientcode"
                    strFormet = strFormet & " 			) A"
                    strFormet = strFormet & " 		)D"
                    strFormet = strFormet & " 		group by yearmon"
                    strFormet = strFormet & " 	)B "
                    strFormet = strFormet & " 	union all"
                    strFormet = strFormet & " 	select"
                    strFormet = strFormet & " 	yearmon yearmon,"
                    strFormet = strFormet & " 	dbo.sc_get_highcompanyname_fun(clientcode) clientcode,"
                    For i = 1 To strCNT
                        strFormet = strFormet & " cast(max(A" & i & ") as varchar(20)) A" & i & ","
                    Next

                    strFormet = strFormet & " 	cast(SUM(ASUM) as varchar(20)) ASUM"
                    strFormet = strFormet & " 	from ("
                    strFormet = strFormet & " 		select"
                    strFormet = strFormet & " 		yearmon,"
                    strFormet = strFormet & " 		clientcode, "
                    For i = 1 To strCNT
                        strFormet = strFormet & "case num when " & i & " then exsusu else null end as A" & i & ","
                    Next

                    strFormet = strFormet & " 		EXSUSU ASUM "
                    strFormet = strFormet & " 		from ( "
                    strFormet = strFormet & " 			select yearmon, clientcode, DENSE_RANK() over(order by exclientcode asc) as num, exclientcode, sum(isnull(exsusu,0)) exsusu"
                    strFormet = strFormet & " 			from MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & " 			where yearmon = '" & strYEARMON & "' and left(exclientcode,1) = 'G'"
                    strFormet = strFormet & " 			group by yearmon, clientcode, exclientcode"
                    strFormet = strFormet & " 		) A"
                    strFormet = strFormet & " 	)D"
                    strFormet = strFormet & " 	group by yearmon, clientcode"
                    strFormet = strFormet & " )F "


                ElseIf strGUBUN = "OU" Then '외주비

                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " MAIN.YEARMON, "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(MAIN.CLIENTCODE) CLIENTNAME,"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA07' THEN A.ADJAMT ELSE 0 END) O2,"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD <> '11000536' THEN A.ADJAMT ELSE 0 END) R ,"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD = '11000536' THEN A.ADJAMT ELSE 0 END) S,"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN not in('PA05','PA07')  THEN A.ADJAMT ELSE 0 END) P,"
                    strFormet = strFormet & " 0 E, "
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA07' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD <> '11000536' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD = '11000536' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " SUM(CASE WHEN A.JOBGUBN not in('PA05','PA07')  THEN A.ADJAMT ELSE 0 END) SUMOUTAMT, 1 SORT_GBN "
                    strFormet = strFormet & " FROM "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & " 	SELECT  "
                    strFormet = strFormet & " 	YEARMON, CLIENTCODE "
                    strFormet = strFormet & " 	FROM "
                    strFormet = strFormet & " 	( "
                    strFormet = strFormet & " 		SELECT  "
                    strFormet = strFormet & " 		SUBSTRING(ADJDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " 		C.CLIENTCODE"
                    strFormet = strFormet & " 		FROM PD_EXE_DTL A, PD_JOBNO B, PD_PONO C"
                    strFormet = strFormet & " 		WHERE SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " 		AND A.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 		AND B.PROJECTNO = C.PROJECTNO"
                    strFormet = strFormet & " 	)AAA  GROUP BY YEARMON, CLIENTCODE "
                    strFormet = strFormet & " )MAIN "
                    strFormet = strFormet & " LEFT JOIN  "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & " 	SELECT  "
                    strFormet = strFormet & " 	SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	C.CLIENTCODE,"
                    strFormet = strFormet & " 	DBO.PD_JOBGUBN_FUN(A.JOBNO) JOBGUBN,"
                    strFormet = strFormet & " 	DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO) DEPT_CD,"
                    strFormet = strFormet & " 	SUM(ISNULL(ADJAMT,0)) ADJAMT "
                    strFormet = strFormet & " 	FROM PD_EXE_DTL A, PD_JOBNO B, PD_PONO C"
                    strFormet = strFormet & " 	WHERE 1=1  "
                    strFormet = strFormet & " 	AND SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " 	AND A.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 	AND B.PROJECTNO = C.PROJECTNO"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(ADJDAY,1,6), C.CLIENTCODE,"
                    strFormet = strFormet & " 	DBO.PD_JOBGUBN_FUN(A.JOBNO), DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO)"
                    strFormet = strFormet & " )A ON MAIN.YEARMON = A.YEARMON AND MAIN.CLIENTCODE = A.CLIENTCODE "
                    strFormet = strFormet & " GROUP BY MAIN.YEARMON, MAIN.CLIENTCODE"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '기타(GBS/사보)' CLIENTNAME, "
                    strFormet = strFormet & " 0 O2, "
                    strFormet = strFormet & " 0 R, "
                    strFormet = strFormet & " 0 S, "
                    strFormet = strFormet & " 0 P, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) E, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) SUMOUTAMT,1 SORT_GBN "
                    strFormet = strFormet & " FROM PD_EXE_DTL "
                    strFormet = strFormet & " WHERE SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(JOBNO) in('PA08') "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY SUBSTRING(ADJDAY,1,6),DBO.PD_JOBCLIENTCOMPANYNAME_FUN(JOBNO)"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " YEARMON, "
                    strFormet = strFormet & " '총 계' CLIENTNAME,"
                    strFormet = strFormet & " SUM(ISNULL(O2,0)) O2,"
                    strFormet = strFormet & " SUM(ISNULL(R,0)) R,"
                    strFormet = strFormet & " SUM(ISNULL(S,0)) S,"
                    strFormet = strFormet & " SUM(ISNULL(P,0)) P,"
                    strFormet = strFormet & " SUM(ISNULL(E,0)) E,"
                    strFormet = strFormet & " SUM(ISNULL(SUMOUTAMT,0)) SUMOUTAMT,"
                    strFormet = strFormet & " 2 SORT_GBN "
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	MAIN.YEARMON, "
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA07' THEN A.ADJAMT ELSE 0 END) O2,"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD <> '11000536' THEN A.ADJAMT ELSE 0 END) R ,"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD = '11000536' THEN A.ADJAMT ELSE 0 END) S,"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN not in('PA05','PA07')  THEN A.ADJAMT ELSE 0 END) P,"
                    strFormet = strFormet & " 	0 E, "
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA07' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD <> '11000536' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN = 'PA05' AND A.DEPT_CD = '11000536' THEN A.ADJAMT ELSE 0 END)+"
                    strFormet = strFormet & " 	SUM(CASE WHEN A.JOBGUBN not in('PA05','PA07')  THEN A.ADJAMT ELSE 0 END) SUMOUTAMT"
                    strFormet = strFormet & " 	FROM "
                    strFormet = strFormet & " 	( "
                    strFormet = strFormet & " 		SELECT  "
                    strFormet = strFormet & " 		YEARMON"
                    strFormet = strFormet & " 		FROM "
                    strFormet = strFormet & " 		( "
                    strFormet = strFormet & " 			SELECT  "
                    strFormet = strFormet & " 			SUBSTRING(ADJDAY,1,6) YEARMON  "
                    strFormet = strFormet & " 			FROM PD_EXE_DTL A, PD_JOBNO B, PD_PONO C"
                    strFormet = strFormet & " 			WHERE SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " 			AND A.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 			AND B.PROJECTNO = C.PROJECTNO"
                    strFormet = strFormet & " 		)AAA  GROUP BY YEARMON"
                    strFormet = strFormet & " 	)MAIN "
                    strFormet = strFormet & " 	LEFT JOIN  "
                    strFormet = strFormet & " 	( "
                    strFormet = strFormet & " 		SELECT  "
                    strFormet = strFormet & " 		SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 		DBO.PD_JOBGUBN_FUN(A.JOBNO) JOBGUBN,"
                    strFormet = strFormet & " 		DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO) DEPT_CD,"
                    strFormet = strFormet & " 		SUM(ISNULL(ADJAMT,0)) ADJAMT "
                    strFormet = strFormet & " 		FROM PD_EXE_DTL A, PD_JOBNO B, PD_PONO C"
                    strFormet = strFormet & " 		WHERE 1=1  "
                    strFormet = strFormet & " 		AND SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " 		AND A.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 		AND B.PROJECTNO = C.PROJECTNO"
                    strFormet = strFormet & " 		GROUP BY SUBSTRING(ADJDAY,1,6),"
                    strFormet = strFormet & " 		DBO.PD_JOBGUBN_FUN(A.JOBNO), DBO.PD_JOBNO_DEPTCDREAL_FUN(A.JOBNO)"
                    strFormet = strFormet & " 	)A ON MAIN.YEARMON = A.YEARMON"
                    strFormet = strFormet & " 	GROUP BY MAIN.YEARMON"
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT  "
                    strFormet = strFormet & " 	SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	0 O2, "
                    strFormet = strFormet & " 	0 R, "
                    strFormet = strFormet & " 	0 S, "
                    strFormet = strFormet & " 	0 P, "
                    strFormet = strFormet & " 	SUM(ISNULL(ADJAMT,0)) E, "
                    strFormet = strFormet & " 	SUM(ISNULL(ADJAMT,0)) SUMOUTAMT"
                    strFormet = strFormet & " 	FROM PD_EXE_DTL "
                    strFormet = strFormet & " 	WHERE SUBSTRING(ADJDAY,1,6) = '" & strYEARMON & "' "
                    strFormet = strFormet & " 	AND DBO.PD_JOBGUBN_FUN(JOBNO) in('PA08') "
                    strFormet = strFormet & " 	AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(ADJDAY,1,6)"
                    strFormet = strFormet & " ) SUMMAIN"
                    strFormet = strFormet & " GROUP BY YEARMON"
                    strFormet = strFormet & " ORDER BY SORT_GBN ,CLIENTNAME DESC "




                ElseIf strGUBUN = "MC" Then '월별 광고주별 매출이익
                    strFYEARMON = Mid(strYEARMON, 1, 4) + "01"

                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " CLIENTCODE,DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME , "
                    strFormet = strFormet & " SUM(A1) A1,SUM(A2) A2, SUM(A3) A3, SUM(A4) A4, SUM(A5) A5, SUM(A6) A6, SUM(A7) A7, SUM(A8) A8,  "
                    strFormet = strFormet & " SUM(A9) A9, SUM(A10) A10,SUM(A11) A11,SUM(A12) A12, "
                    strFormet = strFormet & " SUM(A1)+SUM(A2)+SUM(A3)+SUM(A4)+SUM(A5)+SUM(A6)+SUM(A7)+SUM(A8)+ "
                    strFormet = strFormet & " SUM(A9)+SUM(A10)+SUM(A11)+SUM(A12) AMTSUM "
                    strFormet = strFormet & " FROM  "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT "
                    strFormet = strFormet & "  YEARMON,CLIENTCODE, "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '01' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A1,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '02' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A2,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '03' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A3,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '04' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A4,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '05' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A5,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '06' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A6,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '07' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A7,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '08' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A8,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '09' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A9,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '10' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A10,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '11' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A11,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '12' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A12 "
                    strFormet = strFormet & "  FROM "
                    strFormet = strFormet & "  ( "
                    strFormet = strFormet & "SELECT "
                    strFormet = strFormet & "MAIN.YEARMON, MAIN.CLIENTCODE , "
                    strFormet = strFormet & "ISNULL(A.SUMCOMMISSION,0)+ISNULL(B.O,0)+ISNULL(B.R,0)+ISNULL(B.P,0) ME, "
                    strFormet = strFormet & "ISNULL(C.O,0)+ISNULL(C.R,0)+ISNULL(C.P,0) OUT "
                    strFormet = strFormet & "FROM "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " YEARMON, CLIENTCODE "
                    strFormet = strFormet & " FROM "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  YEARMON, "
                    strFormet = strFormet & "  CLIENTCODE "
                    strFormet = strFormet & "  FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "  WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "  AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03') "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  UNION ALL"
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(ADJDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE "
                    strFormet = strFormet & "  FROM PD_EXE_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " )CLIENT GROUP BY YEARMON, CLIENTCODE "
                    strFormet = strFormet & ")MAIN  "
                    strFormet = strFormet & "LEFT JOIN "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " YEARMON,  "
                    strFormet = strFormet & " CLIENTCODE,  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(COMMISSION,0) ELSE 0 END )A,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(COMMISSION,0) ELSE 0 END) A2,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(COMMISSION,0) ELSE 0 END) B,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(COMMISSION,0) ELSE 0 END) D,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(COMMISSION,0) ELSE 0 END) O1,  "
                    strFormet = strFormet & " SUM(ISNULL(COMMISSION,0)) SUMCOMMISSION  "
                    strFormet = strFormet & " FROM MD_REPORTCOMMI_MST_V  "
                    strFormet = strFormet & " WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " GROUP BY YEARMON,CLIENTCODE  "
                    strFormet = strFormet & ")A ON MAIN.YEARMON = A.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = A.CLIENTCODE "
                    strFormet = strFormet & "LEFT JOIN  "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " CLIENTCODE,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN = 'PA07' THEN ISNULL(AMT,0) ELSE 0 END) O,  "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN = 'PA05' THEN ISNULL(AMT,0) ELSE 0 END) R, "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN not in('PA05','PA07') THEN ISNULL(AMT,0) ELSE 0 END) P  "
                    strFormet = strFormet & " FROM PD_TAX_DTL  "
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6)between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999  "
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE  "
                    strFormet = strFormet & ")B ON MAIN.YEARMON = B.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = B.CLIENTCODE "
                    strFormet = strFormet & "LEFT JOIN  "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA07' THEN ISNULL(ADJAMT,0) ELSE 0 END) O, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA05' THEN ISNULL(ADJAMT,0) ELSE 0 END) R, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) not in('PA05','PA07') THEN ISNULL(ADJAMT,0) ELSE 0 END) P "
                    strFormet = strFormet & " FROM PD_EXE_DTL  "
                    strFormet = strFormet & " WHERE 1=1"
                    strFormet = strFormet & " AND SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " GROUP BY  DBO.PD_JOBCLIENTCODE_FUN(JOBNO),SUBSTRING(ADJDAY,1,6) "
                    strFormet = strFormet & ")C ON MAIN.YEARMON = C.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = C.CLIENTCODE "
                    strFormet = strFormet & "  )ALLSUM "
                    strFormet = strFormet & " )hap GROUP BY CLIENTCODE "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " CLIENTCODE,'기타(GBS/사보)' CLIENTNAME , "
                    strFormet = strFormet & " SUM(A1) A1,SUM(A2) A2, SUM(A3) A3, SUM(A4) A4, SUM(A5) A5, SUM(A6) A6, SUM(A7) A7, SUM(A8) A8,  "
                    strFormet = strFormet & " SUM(A9) A9, SUM(A10) A01,SUM(A11) A11,SUM(A12) A12, "
                    strFormet = strFormet & " SUM(A1)+SUM(A2)+SUM(A3)+SUM(A4)+SUM(A5)+SUM(A6)+SUM(A7)+SUM(A8)+ "
                    strFormet = strFormet & " SUM(A9)+SUM(A10)+SUM(A11)+SUM(A12) AUMAMT "
                    strFormet = strFormet & " FROM "
                    strFormet = strFormet & "  ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  A.YEARMON, '기타(GBS/사보)'CLIENTCODE, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '01' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A1, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '02' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A2, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '03' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A3, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '04' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A4, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '05' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A5, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '06' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A6, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '07' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A7, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '08' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A8, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '09' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A9, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '10' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A10, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '11' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A11, "
                    strFormet = strFormet & "  case when substring(a.yearmon,5,2) = '12' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A12 "
                    strFormet = strFormet & "  FROM  "
                    strFormet = strFormet & "  ( "
                    strFormet = strFormet & "SELECT"
                    strFormet = strFormet & "SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE, "
                    strFormet = strFormet & "'기타(GBS/사보)' CLIENTNAME,  "
                    strFormet = strFormet & "SUM(ISNULL(AMT,0)) E  "
                    strFormet = strFormet & "FROM PD_TAX_DTL"
                    strFormet = strFormet & "WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "AND JOBGUBN in('PA08')"
                    strFormet = strFormet & "AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03')"
                    strFormet = strFormet & "AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & "GROUP BY  SUBSTRING(DEMANDDAY,1,6),DBO.PD_JOBCLIENTCODE_FUN(JOBNO) "
                    strFormet = strFormet & "  )A  "
                    strFormet = strFormet & "  LEFT JOIN "
                    strFormet = strFormet & "  ( "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & "DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE, "
                    strFormet = strFormet & "'기타(GBS/사보)' CLIENTNAME, "
                    strFormet = strFormet & "SUM(ISNULL(ADJAMT,0)) E "
                    strFormet = strFormet & "FROM PD_EXE_DTL "
                    strFormet = strFormet & "WHERE SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "AND DBO.PD_JOBGUBN_FUN(JOBNO) in('PA08') "
                    strFormet = strFormet & "AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & "AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "GROUP BY SUBSTRING(ADJDAY,1,6),DBO.PD_JOBCLIENTCODE_FUN(JOBNO) "
                    strFormet = strFormet & "  )B ON A.YEARMON = B.YEARMON "
                    strFormet = strFormet & "  AND A.CLIENTCODE = B.CLIENTCODE "
                    strFormet = strFormet & " )ETC GROUP BY CLIENTCODE "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " ''CLIENTCODE, '총 계' CLIENTNAME , "
                    strFormet = strFormet & " SUM(A1) A1,SUM(A2) A2, SUM(A3) A3, SUM(A4) A4, SUM(A5) A5, SUM(A6) A6, SUM(A7) A7, SUM(A8) A8,  "
                    strFormet = strFormet & " SUM(A9) A9, SUM(A10) A01,SUM(A11) A11,SUM(A12) A12, "
                    strFormet = strFormet & " SUM(A1)+SUM(A2)+SUM(A3)+SUM(A4)+SUM(A5)+SUM(A6)+SUM(A7)+SUM(A8)+ "
                    strFormet = strFormet & " SUM(A9)+SUM(A10)+SUM(A11)+SUM(A12) AUMAMT "
                    strFormet = strFormet & " FROM  "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT "
                    strFormet = strFormet & "  ''CLIENTCODE,'총 계'CLIENTNAME, "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '01' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A1,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '02' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A2,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '03' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A3,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '04' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A4,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '05' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A5,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '06' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A6,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '07' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A7,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '08' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A8,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '09' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A9,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '10' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A10,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '11' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A11,  "
                    strFormet = strFormet & "  case when substring(yearmon,5,2) = '12' then ISNULL(ME,0)-ISNULL(OUT,0) else 0 end A12, "
                    strFormet = strFormet & "  0 SUMAMT "
                    strFormet = strFormet & "  FROM "
                    strFormet = strFormet & "  ( "
                    strFormet = strFormet & "SELECT "
                    strFormet = strFormet & "MAIN.YEARMON, MAIN.CLIENTCODE , "
                    strFormet = strFormet & "ISNULL(A.SUMCOMMISSION,0)+ISNULL(B.O,0)+ISNULL(B.R,0)+ISNULL(B.P,0) ME, "
                    strFormet = strFormet & "ISNULL(C.O,0)+ISNULL(C.R,0)+ISNULL(C.P,0) OUT "
                    strFormet = strFormet & "FROM "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " YEARMON, CLIENTCODE "
                    strFormet = strFormet & " FROM "
                    strFormet = strFormet & " ( "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  YEARMON, "
                    strFormet = strFormet & "  CLIENTCODE "
                    strFormet = strFormet & "  FROM MD_REPORTCOMMI_MST_V "
                    strFormet = strFormet & "  WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "  UNION ALL "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  CLIENTCODE "
                    strFormet = strFormet & "  FROM PD_TAX_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & "  AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) NOT in('PB01', 'PO03') "
                    strFormet = strFormet & "  AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & "  UNION ALL"
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  SUBSTRING(ADJDAY,1,6) YEARMON,  "
                    strFormet = strFormet & "  DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE "
                    strFormet = strFormet & "  FROM PD_EXE_DTL "
                    strFormet = strFormet & "  WHERE SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " )CLIENT GROUP BY YEARMON, CLIENTCODE "
                    strFormet = strFormet & ")MAIN  "
                    strFormet = strFormet & "LEFT JOIN "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " YEARMON,  "
                    strFormet = strFormet & " CLIENTCODE,  "
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20') THEN ISNULL(COMMISSION,0) ELSE 0 END )A,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('A2') THEN ISNULL(COMMISSION,0) ELSE 0 END) A2,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(COMMISSION,0) ELSE 0 END) B,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(COMMISSION,0) ELSE 0 END) D,  "
                    strFormet = strFormet & " SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(COMMISSION,0) ELSE 0 END) O1,  "
                    strFormet = strFormet & " SUM(ISNULL(COMMISSION,0)) SUMCOMMISSION  "
                    strFormet = strFormet & " FROM MD_REPORTCOMMI_MST_V  "
                    strFormet = strFormet & " WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " GROUP BY YEARMON,CLIENTCODE  "
                    strFormet = strFormet & ")A ON MAIN.YEARMON = A.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = A.CLIENTCODE "
                    strFormet = strFormet & "LEFT JOIN  "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,"
                    strFormet = strFormet & " CLIENTCODE,"
                    strFormet = strFormet & " DBO.SC_GET_HIGHCOMPANYNAME_FUN(CLIENTCODE) CLIENTNAME, "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN = 'PA07' THEN ISNULL(AMT,0) ELSE 0 END) O,  "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN = 'PA05' THEN ISNULL(AMT,0) ELSE 0 END) R, "
                    strFormet = strFormet & " SUM(CASE WHEN JOBGUBN not in('PA05','PA07') THEN ISNULL(AMT,0) ELSE 0 END) P  "
                    strFormet = strFormet & " FROM PD_TAX_DTL  "
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6)between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999  "
                    strFormet = strFormet & " GROUP BY SUBSTRING(DEMANDDAY,1,6), CLIENTCODE  "
                    strFormet = strFormet & ")B ON MAIN.YEARMON = B.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = B.CLIENTCODE "
                    strFormet = strFormet & "LEFT JOIN  "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " DBO.PD_JOBCLIENTCODE_FUN(JOBNO) CLIENTCODE, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA07' THEN ISNULL(ADJAMT,0) ELSE 0 END) O, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) = 'PA05' THEN ISNULL(ADJAMT,0) ELSE 0 END) R, "
                    strFormet = strFormet & " SUM(CASE WHEN DBO.PD_JOBGUBN_FUN(JOBNO) not in('PA05','PA07') THEN ISNULL(ADJAMT,0) ELSE 0 END) P "
                    strFormet = strFormet & " FROM PD_EXE_DTL  "
                    strFormet = strFormet & " WHERE 1=1"
                    strFormet = strFormet & " AND SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " GROUP BY  DBO.PD_JOBCLIENTCODE_FUN(JOBNO),SUBSTRING(ADJDAY,1,6) "
                    strFormet = strFormet & ")C ON MAIN.YEARMON = C.YEARMON "
                    strFormet = strFormet & "AND MAIN.CLIENTCODE = C.CLIENTCODE "
                    strFormet = strFormet & "  )ALLSUM "
                    strFormet = strFormet & " UNION ALL "
                    strFormet = strFormet & "  SELECT  "
                    strFormet = strFormet & "  ''CLIENTCODE,'총 계' CLIENTNAME , "
                    strFormet = strFormet & "  SUM(A1) A1,SUM(A2) A2, SUM(A3) A3, SUM(A4) A4, SUM(A5) A5, SUM(A6) A6, SUM(A7) A7, SUM(A8) A8,  "
                    strFormet = strFormet & "  SUM(A9) A9, SUM(A10) A01,SUM(A11) A11,SUM(A12) A12, "
                    strFormet = strFormet & "  SUM(A1)+SUM(A2)+SUM(A3)+SUM(A4)+SUM(A5)+SUM(A6)+SUM(A7)+SUM(A8)+ "
                    strFormet = strFormet & "  SUM(A9)+SUM(A10)+SUM(A11)+SUM(A12) AUMAMT "
                    strFormet = strFormet & "  FROM "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & "SELECT  "
                    strFormet = strFormet & "A.YEARMON,''CLIENTCODE,'총 계'CLIENTNAME, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '01' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A1, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '02' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A2, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '03' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A3, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '04' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A4, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '05' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A5, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '06' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A6, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '07' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A7, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '08' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A8, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '09' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A9, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '10' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A10, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '11' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A11, "
                    strFormet = strFormet & "case when substring(a.yearmon,5,2) = '12' then ISNULL(A.E,0)-ISNULL(B.E,0) else 0 end A12 "
                    strFormet = strFormet & "FROM  "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT"
                    strFormet = strFormet & " SUBSTRING(DEMANDDAY,1,6) YEARMON,  "
                    strFormet = strFormet & " '' CLIENTCODE, "
                    strFormet = strFormet & " '기타(GBS/사보)' CLIENTNAME,  "
                    strFormet = strFormet & " SUM(ISNULL(AMT,0)) E  "
                    strFormet = strFormet & " FROM PD_TAX_DTL"
                    strFormet = strFormet & " WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " AND JOBGUBN in('PA08')"
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03')"
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999"
                    strFormet = strFormet & " GROUP BY  SUBSTRING(DEMANDDAY,1,6) "
                    strFormet = strFormet & ")A  "
                    strFormet = strFormet & "LEFT JOIN "
                    strFormet = strFormet & "( "
                    strFormet = strFormet & " SELECT  "
                    strFormet = strFormet & " SUBSTRING(ADJDAY,1,6) YEARMON, "
                    strFormet = strFormet & " '' CLIENTCODE, "
                    strFormet = strFormet & " '기타(GBS/사보)' CLIENTNAME, "
                    strFormet = strFormet & " SUM(ISNULL(ADJAMT,0)) E "
                    strFormet = strFormet & " FROM PD_EXE_DTL "
                    strFormet = strFormet & " WHERE SUBSTRING(ADJDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " AND DBO.PD_JOBGUBN_FUN(JOBNO) in('PA08') "
                    strFormet = strFormet & " AND DBO.PD_JOBNO_CREPARTCODE_FUN(JOBNO) in('PB01', 'PO03') "
                    strFormet = strFormet & " AND ISNULL(ATTR10,0) <> 999999 "
                    strFormet = strFormet & " GROUP BY SUBSTRING(ADJDAY,1,6) "
                    strFormet = strFormet & ")B ON A.YEARMON = B.YEARMON "
                    strFormet = strFormet & "  )ETC GROUP BY CLIENTNAME "
                    strFormet = strFormet & " )hap GROUP BY CLIENTNAME "

                ElseIf strGUBUN = "MR" Then '월별 매체별 매출이익
                    strFYEARMON = Mid(strYEARMON, 1, 4) + "01"

                    strFormet = strFormet & " SELECT "
                    strFormet = strFormet & " YEARMON, GBN, AMTGBN,"
                    strFormet = strFormet & " SUM(A) A, SUM(B) B, SUM(O) O, SUM(D) D, SUM(R) R, SUM(P) P, SUM(E) E,"
                    strFormet = strFormet & " SUM(A) + SUM(B) + SUM(O) + SUM(D) + SUM(R) + SUM(P) + SUM(E) SUMAMT"
                    strFormet = strFormet & " FROM ("
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	YEARMON,  "
                    strFormet = strFormet & " 	'취급액' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 1 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20','A2') THEN ISNULL(AMT,0) ELSE 0 END )A,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(AMT,0) ELSE 0 END) B,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(AMT,0) ELSE 0 END) O,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(AMT,0) ELSE 0 END) D,  "
                    strFormet = strFormet & " 	0 R,"
                    strFormet = strFormet & " 	0 P,"
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM MD_REPORTCOMMI_MST_V  "
                    strFormet = strFormet & " 	WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	GROUP BY YEARMON  "
                    strFormet = strFormet & " 	union all"
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	'취급액' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 1 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A,"
                    strFormet = strFormet & " 	0 B,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA07' THEN ISNULL(AMT,0) ELSE 0 END) O,"
                    strFormet = strFormet & " 	0 D,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA05' THEN ISNULL(AMT,0) ELSE 0 END) R,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN not in('PA05','PA07') THEN ISNULL(AMT,0) ELSE 0 END) P,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA08' AND B.CREPART in('PB01', 'PO03') THEN ISNULL(AMT,0) ELSE 0 END) E"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL "
                    strFormet = strFormet & " 	LEFT JOIN ("
                    strFormet = strFormet & " 		SELECT JOBNO, CREPART FROM PD_JOBNO"
                    strFormet = strFormet & " 	)B ON PD_TAX_DTL.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999  "
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)  "
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'취급액' GBN, '경영계획' AMTGBN, 1 SORT_GBN, 2 SORT_AMTGBN,"
                    strFormet = strFormet & " 	ISNULL(MM.A,0) A, ISNULL(MM.B,0) B, ISNULL(MM.O,0) O, "
                    strFormet = strFormet & " 	ISNULL(MM.D,0) D, ISNULL(MM.R,0) R, ISNULL(MM.P,0) P, "
                    strFormet = strFormet & " 	ISNULL(MM.E,0) E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA LEFT JOIN MD_REPORT_MSTTOTAL MM"
                    strFormet = strFormet & " 	ON MA.YEARMON = MM.YEARMON AND MM.GBN = '취급액'"
                    strFormet = strFormet & " 	WHERE MA.YEARMON  between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'취급액' GBN, '차이' AMTGBN, 1 SORT_GBN, 3 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, 0 B, 0 O, "
                    strFormet = strFormet & " 	0 D, 0 R, 0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA"
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	YEARMON,  "
                    strFormet = strFormet & " 	'매출액' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 2 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20','A2') THEN ISNULL(COMMISSION,0) ELSE 0 END )A,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(COMMISSION,0) ELSE 0 END) B,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(COMMISSION,0) ELSE 0 END) O,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(COMMISSION,0) ELSE 0 END) D,  "
                    strFormet = strFormet & " 	0 R,"
                    strFormet = strFormet & " 	0 P,"
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM MD_REPORTCOMMI_MST_V  "
                    strFormet = strFormet & " 	WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	GROUP BY YEARMON  "
                    strFormet = strFormet & " 	union all"
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	SUBSTRING(DEMANDDAY,1,6) YEARMON, "
                    strFormet = strFormet & " 	'매출액' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 2 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A,"
                    strFormet = strFormet & " 	0 B,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA07' THEN ISNULL(AMT,0) ELSE 0 END) O,"
                    strFormet = strFormet & " 	0 D,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA05' THEN ISNULL(AMT,0) ELSE 0 END) R,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN not in('PA05','PA07') THEN ISNULL(AMT,0) ELSE 0 END) P,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA08' AND B.CREPART in('PB01', 'PO03') THEN ISNULL(AMT,0) ELSE 0 END) E"
                    strFormet = strFormet & " 	FROM PD_TAX_DTL "
                    strFormet = strFormet & " 	LEFT JOIN ("
                    strFormet = strFormet & " 		SELECT JOBNO, CREPART FROM PD_JOBNO"
                    strFormet = strFormet & " 	)B ON PD_TAX_DTL.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 	WHERE SUBSTRING(DEMANDDAY,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	AND ISNULL(ATTR10,0) <> 999999  "
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(DEMANDDAY,1,6)  "
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출액' GBN, '경영계획' AMTGBN, 2 SORT_GBN, 2 SORT_AMTGBN,"
                    strFormet = strFormet & " 	ISNULL(MM.A,0) A, ISNULL(MM.B,0) B, ISNULL(MM.O,0) O, "
                    strFormet = strFormet & " 	ISNULL(MM.D,0) D, ISNULL(MM.R,0) R, ISNULL(MM.P,0) P, "
                    strFormet = strFormet & " 	ISNULL(MM.E,0) E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA LEFT JOIN MD_REPORT_MSTTOTAL MM"
                    strFormet = strFormet & " 	ON MA.YEARMON = MM.YEARMON AND MM.GBN = '매출액'"
                    strFormet = strFormet & " 	WHERE MA.YEARMON  between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출액' GBN, '차이' AMTGBN, 2 SORT_GBN, 3 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, 0 B, 0 O, "
                    strFormet = strFormet & " 	0 D, 0 R, 0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA"
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	YEARMON,  "
                    strFormet = strFormet & " 	'매출원가' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 3 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('01','02','03','10','20','A2') THEN ISNULL(EXSUSU,0) ELSE 0 END )A,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('B','C') THEN ISNULL(EXSUSU,0) ELSE 0 END) B,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('O') THEN ISNULL(EXSUSU,0) ELSE 0 END) O,  "
                    strFormet = strFormet & " 	SUM(CASE WHEN MED_FLAG IN('D') THEN ISNULL(EXSUSU,0) ELSE 0 END) D,  "
                    strFormet = strFormet & " 	0 R,"
                    strFormet = strFormet & " 	0 P,"
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM MD_REPORTCOMMI_MST_V  "
                    strFormet = strFormet & " 	WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	GROUP BY YEARMON  "
                    strFormet = strFormet & " 	union all"
                    strFormet = strFormet & " 	SELECT"
                    strFormet = strFormet & " 	SUBSTRING(PURCHASENO,1,6) YEARMON, "
                    strFormet = strFormet & " 	'매출원가' GBN,  "
                    strFormet = strFormet & " 	'실적' AMTGBN, 3 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A,"
                    strFormet = strFormet & " 	0 B,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA07' THEN ISNULL(ADJAMT,0) ELSE 0 END) O,"
                    strFormet = strFormet & " 	0 D,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA05' THEN ISNULL(ADJAMT,0) ELSE 0 END) R,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN not in('PA05','PA07') THEN ISNULL(ADJAMT,0) ELSE 0 END) P,"
                    strFormet = strFormet & " 	SUM(CASE WHEN JOBGUBN = 'PA08' AND B.CREPART in('PB01', 'PO03') THEN ISNULL(ADJAMT,0) ELSE 0 END) E"
                    strFormet = strFormet & " 	FROM PD_EXE_DTL "
                    strFormet = strFormet & " 	LEFT JOIN ("
                    strFormet = strFormet & " 		SELECT JOBNO, JOBGUBN, CREPART FROM PD_JOBNO"
                    strFormet = strFormet & " 	)B ON PD_EXE_DTL.JOBNO = B.JOBNO"
                    strFormet = strFormet & " 	WHERE SUBSTRING(PURCHASENO,1,6) between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	GROUP BY SUBSTRING(PURCHASENO,1,6)  "
                    strFormet = strFormet & " 	UNION ALL"
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출원가' GBN, '경영계획' AMTGBN, 3 SORT_GBN, 2 SORT_AMTGBN,"
                    strFormet = strFormet & " 	ISNULL(MM.A,0) A, ISNULL(MM.B,0) B, ISNULL(MM.O,0) O, "
                    strFormet = strFormet & " 	ISNULL(MM.D,0) D, ISNULL(MM.R,0) R, ISNULL(MM.P,0) P, "
                    strFormet = strFormet & " 	ISNULL(MM.E,0) E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA LEFT JOIN MD_REPORT_MSTTOTAL MM"
                    strFormet = strFormet & " 	ON MA.YEARMON = MM.YEARMON AND MM.GBN = '매출원가'"
                    strFormet = strFormet & " 	WHERE MA.YEARMON  between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출원가' GBN, '차이' AMTGBN, 3 SORT_GBN, 3 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, 0 B, 0 O, "
                    strFormet = strFormet & " 	0 D, 0 R, 0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	A.YEARMON, "
                    strFormet = strFormet & " 	'매출이익' GBN, '실적' AMTGBN, 4 SORT_GBN, 1 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, "
                    strFormet = strFormet & " 	0 B, "
                    strFormet = strFormet & " 	0 O, "
                    strFormet = strFormet & " 	0 D, "
                    strFormet = strFormet & " 	0 R, "
                    strFormet = strFormet & " 	0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) a"
                    strFormet = strFormet & " 	GROUP BY A.YEARMON"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출이익' GBN, '경영계획' AMTGBN, 4 SORT_GBN, 2 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, 0 B, 0 O, "
                    strFormet = strFormet & " 	0 D, 0 R, 0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA"
                    strFormet = strFormet & " 	UNION ALL "
                    strFormet = strFormet & " 	SELECT "
                    strFormet = strFormet & " 	MA.YEARMON, "
                    strFormet = strFormet & " 	'매출이익' GBN, '차이' AMTGBN, 4 SORT_GBN, 3 SORT_AMTGBN,"
                    strFormet = strFormet & " 	0 A, 0 B, 0 O, "
                    strFormet = strFormet & " 	0 D, 0 R, 0 P, "
                    strFormet = strFormet & " 	0 E"
                    strFormet = strFormet & " 	FROM ("
                    strFormet = strFormet & " 		SELECT YEARMON"
                    strFormet = strFormet & " 		FROM V_YEARMON"
                    strFormet = strFormet & " 		WHERE YEARMON between '" & strFYEARMON & "' and '" & strYEARMON & "'"
                    strFormet = strFormet & " 		GROUP BY YEARMON"
                    strFormet = strFormet & " 	) MA"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '취급액' GBN, '실적' AMTGBN, 1 SORT_GBN, 1 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '취급액' GBN, '경영계획' AMTGBN, 1 SORT_GBN, 2 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '취급액' GBN, '차이' AMTGBN, 1 SORT_GBN, 3 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출액' GBN, '실적' AMTGBN, 2 SORT_GBN, 1 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출액' GBN, '경영계획' AMTGBN, 2 SORT_GBN, 2 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출액' GBN, '차이' AMTGBN, 2 SORT_GBN, 3 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출원가' GBN, '실적' AMTGBN, 3 SORT_GBN, 1 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출원가' GBN, '경영계획' AMTGBN, 3 SORT_GBN, 2 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출원가' GBN, '차이' AMTGBN, 3 SORT_GBN, 3 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출이익' GBN, '실적' AMTGBN, 4 SORT_GBN, 1 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출이익' GBN, '경영계획' AMTGBN, 4 SORT_GBN, 2 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " UNION ALL"
                    strFormet = strFormet & " SELECT '누계' YEARMON, '매출이익' GBN, '차이' AMTGBN, 4 SORT_GBN, 3 SORT_AMTGBN, 0 A, 0 B, 0 O, 0 D, 0 R, 0 P, 0 E"
                    strFormet = strFormet & " ) AMTMAIN"
                    strFormet = strFormet & " GROUP BY YEARMON, GBN, AMTGBN,SORT_GBN, SORT_AMTGBN"

                    strFormet = strFormet & " ORDER BY YEARMON, SORT_GBN, SORT_AMTGBN"

                End If

                strSQL = String.Format(strFormet, strWhere)

                .mobjSCGLSql.SQLConnect(.DBConnStr)

                If strGUBUN = "AO" Then
                    vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Else
                    vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , True)
                End If

                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function ProcessRtn(ByVal strInfoXML As String, _
    ByVal vntData As Object, _
    ByVal strYEARMON As String) As Object

        Dim intRtn As Integer
        Dim i, intColCnt, intRows As Integer
        Dim strFYEARMON
        Dim strSQL

        SetConfig(strInfoXML)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                If IsArray(vntData) Then
                    '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                    mobjceMD_REPORT_MSTTOTAL = New eMDCO.ceMD_REPORT_MSTTOTAL(mobjSCGLConfig)
                    '''vntData의 컬럼수, 로우수를 변수입력
                    intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)

                    strFYEARMON = Mid(strYEARMON, 1, 4) + "01"

                    strSQL = "DELETE FROM MD_REPORT_MSTTOTAL WHERE YEARMON BETWEEN '" & strFYEARMON & "' AND '" & strYEARMON & "'"

                    mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)

                    For i = 1 To intRows
                        If GetElement(vntData, "YEARMON", intColCnt, i, OPTIONAL_STR) <> "누계" And GetElement(vntData, "AMTGBN", intColCnt, i, OPTIONAL_STR) = "경영계획" Then
                            intRtn = InsertRtn_MD_REPORT_MSTTOTAL(vntData, intColCnt, i)
                        End If
                    Next
                End If
                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn_CUSTDTL")
            Finally
                .mobjSCGLSql.SQLDisconnect()
                mobjceMD_REPORT_MSTTOTAL.Dispose()
            End Try
        End With
    End Function

    '=================== AOR/대행수수료 제작사의 카운트를 가져온다.
    Public Function SelectRtn_CNT(ByVal strInfoXML As String, _
    ByRef strYEARMON As String) As Integer
        '여기부터 단순조회
        Dim strSQL, strFormat, strRtn As String

        SetConfig(strInfoXML)

        With mobjSCGLConfig '기본정보 Config 개체
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()


                strSQL = " select count(*) cnt"
                strSQL = strSQL & " from ("
                strSQL = strSQL & " 	select exclientcode"
                strSQL = strSQL & " 	from MD_REPORTCOMMI_MST_V "
                strSQL = strSQL & " 	where yearmon = '" & strYEARMON & "' and left(exclientcode,1) = 'G'"
                strSQL = strSQL & " 	group by exclientcode"
                strSQL = strSQL & " ) a"

                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)

                .mobjSCGLSql.SQLCommitTrans()
                Return strRtn

            Catch err As Exception
                ' 오류 전송
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CNT")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
        '여기까지 단순조회
    End Function
#End Region

#Region "GROUP BLOCK : 외부에 비공개 Method"
    Private Function InsertRtn_MD_REPORT_MSTTOTAL(ByVal vntData As Object, _
     ByVal intColCnt As Integer, _
     ByVal intRow As Integer) As Integer

        Dim intRtn As Integer
        intRtn = mobjceMD_REPORT_MSTTOTAL.InsertDo( _
      GetElement(vntData, "YEARMON", intColCnt, intRow), _
      GetElement(vntData, "GBN", intColCnt, intRow), _
      GetElement(vntData, "AMTGBN", intColCnt, intRow), _
      GetElement(vntData, "A", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "B", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "O", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "D", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "R", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "P", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "E", intColCnt, intRow, NULL_NUM, True), _
      GetElement(vntData, "ATTR01", intColCnt, intRow), _
      GetElement(vntData, "ATTR02", intColCnt, intRow), _
      GetElement(vntData, "ATTR03", intColCnt, intRow))
        Return intRtn

    End Function
#End Region
End Class
