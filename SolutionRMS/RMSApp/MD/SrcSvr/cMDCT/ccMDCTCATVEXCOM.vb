'****************************************************************************************
'Generated By :::BELLWORLD Making Entity Bean Ver1.0:::
'시스템구분 : SFAR/시스템명/Server단 Entity Base Component
'실행  환경 : COM+ Service Server Package
'프로그램명 : ccSCEXCOM.vb (Table한글명 Entity 처리 Class)
'기      능 : Table한글명(영문명) Entity에 대해Insert/Update/Delete/Select를 처리
'특이  사항 : -특이사항에 대해 표현
'             -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 2003-06-19 오후 2:35:59 By 작성자
'            2) 2003-06-19 오후 2:35:59 By 작성자 : 변경 내용 설명
'****************************************************************************************

Imports System.Xml                  'XML처리
Imports SCGLControl                 'ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       'ConfigurationClass
Imports SCGLUtil.cbSCGLErr          '오류처리클래스
Imports SCGLUtil.cbSCGLXml          'XML처리클래스
Imports SCGLUtil.cbSCGLUtil         '기타유틸리티 클래스
Imports eMDCO

Public Class ccMDCTCATVEXCOM
    Inherits ccControl

#Region "GROUP BLOCk : 전역 또는 모듈레벨의 변수/상수 선언"
    'Private Const .DBConnStr = "Provider=SQLOLEDB;Data Source=10.110.10.86;Initial Catalog=MCDEV;DSN=MCDEV;UID=devadmin;Pwd=password"  '커넥션Setting
    Private CLASS_NAME = "ccMDCTCATVEXCOM"         '자신의클래스명
    Private mobjceMD_CATV_MEDIUM As eMDCO.ceMD_CATV_MEDIUM
    Dim mobjceSC_USER_COL As eMDCO.ceSC_USER_COL
    Dim mobjceSC_USER_TAB As eMDCO.ceSC_USER_TAB
    Dim mobjceSC_EXCEL As eMDCO.ceSC_EXCEL

#End Region

#Region "GROUP BLOCk : Property 선언"
#End Region

#Region "GROUP BLOCk : Event 선언"
    Public Function ElecExcelUpload(ByVal strInfoXml As String, _
                                    ByVal strYEARMON As String) As Integer

        Dim dblID As Double
        Dim strYEAR As String
        Dim strMON As String

        Dim intRtn, intColCnt, intRows, i As Integer
        Try
            SetConfig(strInfoXml)
            With mobjSCGLConfig
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()
                mobjceSC_USER_COL = New ceSC_USER_COL(mobjSCGLConfig)
                intRtn = UpdateRtn_SC_USER_COL(strYEARMON)
                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            End With
        Catch err As Exception
            mobjSCGLConfig.mobjSCGLSql.SQLRollbackTrans()
            Throw RaiseSysErr(err, CLASS_NAME & ".ElecExcelUpload")
        End Try
    End Function
#End Region

#Region "GROUP BLOCk : 외부에 공개 Method"

    ' =============== 엑셀업로드시 채널 오류검사
    Public Function SelectRtn_MEDNAME(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strMEDNAME As String) As Object     'XML  데이터 조회시
        'strYEARMON,strCLIENTCODE
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                'If strYEARMON <> "" Then strWhere = String.Format(" AND (YEARMON = '{0}')", strYEARMON) '년월
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where and isnull(attr10,0) = 1 and RTRIM(LTrim(custname)) = '" & strMEDNAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MEDNAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_CLIENTNAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strCLIENTNAME As String) As Object     'XML  데이터 조회시
        'strYEARMON,strCLIENTCODE
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select HIGHCUSTCODE from sc_cust_temp where medflag='A' and isnull(attr10,0) = 1 AND DEMANDFLAG='1' and RTRIM(LTrim(COMPANYNAME)) = '" & strCLIENTNAME & "'"
                strSQL = strSQL & " GROUP BY HIGHCUSTCODE"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTNAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    ' =============== 엑셀업로드시 사업부 오류검사
    Public Function SelectRtn_CLIENTSUBNAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strCLIENTNAME As String) As Object     'XML  데이터 조회시
        'strYEARMON,strCLIENTCODE
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where medflag='A' and isnull(attr10,0) = 1 and RTRIM(LTrim(custname)) = '" & strCLIENTNAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTNAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    ' =============== 엑셀업로드시 매체사 오류검사 By KTH 2008.01.23
    Public Function SelectRtn_REALMEDCODE(ByVal strInfoXML As String, _
                                              ByRef intRowCnt As Integer, _
                                              ByRef intColCnt As Integer, _
                                              ByVal strMEDCODE As String) As Object     'XML  데이터 조회시
        'strYEARMON,strCLIENTCODE
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData2 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                'If strYEARMON <> "" Then strWhere = String.Format(" AND (YEARMON = '{0}')", strYEARMON) '년월
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select highcustcode from sc_cust_temp where 1=1 and isnull(attr10,0) = 1  and RTRIM(LTrim(custcode)) = '" & strMEDCODE & "'"
                vntData2 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData2
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_REALMEDCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_MEDCODENAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strMEDCODENAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode, mpp from sc_cust_temp where medflag='B' and isnull(attr10,0) = 1 and RTRIM(LTrim(custname)) = '" & strMEDCODENAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MEDCODENAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_MPPNAME(ByVal strInfoXML As String, _
                                      ByRef intRowCnt As Integer, _
                                      ByRef intColCnt As Integer, _
                                      ByVal strMPPNAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                .mobjSCGLSql.SQLConnect(.DBConnStr)

                strSQL = "select custcode from sc_cust_temp where medflag='P' and isnull(attr10,0) = 1 and RTRIM(LTrim(custname)) = '" & strMPPNAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MPPNAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_CODE(ByVal strInfoXML As String, _
                                   ByRef intRowCnt As Integer, _
                                   ByRef intColCnt As Integer, _
                                   ByVal strCLIENTCODE As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData3 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "SELECT  TOP 1 SEQNO,DEPTCD FROM SC_JOBCUST  WHERE CUSTCODE = '" & strCLIENTCODE & "'"
                vntData3 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData3
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    ' =============== 엑셀업로드시 중복검사 By KTH 2008.01.23
    Public Function SelectRtn_Dup(ByVal strInfoXML As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal strYEARMON As String) As Object

        Dim strSQL As String
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정
                strSQL = "select YEARMON from MD_CATV_MEDIUM where YEARMON = '" & strYEARMON & "'"

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData

            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_Dup")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    ' =============== 엑셀업로드시 거래명세서 존재유무 파악 By KTH 2008.01.23
    Public Function SelectRtn_TransFlag(ByVal strInfoXML As String, _
                                        ByVal strYEARMON As String) As String     'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtnDup As String

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                strSQL = "select DBO.MD_GET_TRANSFLAG_FUN('" & strYEARMON & "')"

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                intRtnDup = .mobjSCGLSql.SQLSelectOneScalar(strSQL)


                Return intRtnDup

            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_TransFlag")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
    '================= 중복투입시 우선 삭제 By KTH 2008.01.23
    Public Function DeleteRtn_Medium(ByVal strInfoXML As String, _
                                     ByVal strYEARMON As String) As Integer

        Dim intRtn As Integer      'Return변수( 처리건수 또는 0 )
        Dim i, intColCnt, intRows As Integer


        SetConfig(strInfoXML)    '기본정보 Setting
        With mobjSCGLConfig    '기본정보 Config 개체
            Try
                ' 사용할Entity 개체생성(Config 정보를 넘겨생성)

                ' DB 접속 및 트랜잭션 시작
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                '''사용할 Entity 개체생성(Config 정보를 넘겨생성)
                mobjceMD_CATV_MEDIUM = New ceMD_CATV_MEDIUM(mobjSCGLConfig)
                '''vntData의 컬럼수, 로우수를 변수입력

                intRtn = mobjceMD_CATV_MEDIUM.Delete_Batch(strYEARMON)


                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "DeleteRtn_Medium")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                '사용한 Entity(개체Dispose)
                mobjceMD_CATV_MEDIUM.Dispose()
            End Try
        End With
    End Function
    ' =============== SelectRtnSample Code
    Public Function SelectRtn(ByVal strInfoXML As String, _
                              ByRef intRowCnt As Integer, _
                              ByRef intColCnt As Integer, _
                              ByVal strCOL_NAME As String) As Object     'XML  데이터 조회시

        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                'If strYEARMON <> "" Then strWhere = String.Format(" AND (YEARMON = '{0}')", strYEARMON) '년월

                strSelFields = strCOL_NAME.Replace("|", ",")

                strFormet = "select {0} from MD_CATV_MEDIUM_TEMP "

                strSQL = String.Format(strFormet, strSelFields)

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)

                'MD_CATV_MEDIUM_TEMP 의 내용을 조회해온후 TEMP테이블의 내용을 삭제한다.
                '.mobjSCGLSql.SQLBeginTrans()
                'mobjceSC_USER_COL = New ceSC_USER_COL(mobjSCGLConfig)
                'intRtn = Delete_Temp_Rtn()
                '.mobjSCGLSql.SQLCommitTrans()

                Return vntData

            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function getTABCOLINFO(ByVal strInfoXml As String, ByRef intRowCnt As Integer, ByRef intColCnt As Integer, _
             ByVal dblTAB_ID As Double) As Object

        SetConfig(strInfoXml)   '모든Public 함수의 처음오는 기본정보 설정

        Dim vntData As Object     '''xmlData String
        Dim strFields As String   '''{0}번째 필드명
        Dim strKeys As String     '''{1}번째조건절
        Dim strFormat As String   '''Format을 맞추어 주는 String
        Dim strSQL As String      '''SQL 문을 만들어 주는 String

        ''''{0} 번째는 필드명으로한다.
        strFields = " A.TAB_ID, A.COL_NAME, A.COL_USER_NAME, A.COL_USE_YN, A.COL_DEFAULT_VALUE, A.COL_DATA_TYPE, A.COL_DATA_LENGTH, A.COL_COLUMN_ID, A.COL_NULLABLE "
        ''''{1} 번째는 WHERE 조건으로 한다.
        strKeys = BuildFields("AND", _
          GetFieldNameValue("A.TAB_ID", dblTAB_ID))
        ''''{1} 이후 또는 전에 필수적으로 들어가야할 SQL문장을 추가주거나 ORDER BY 절을 넣어준다.
        strFormat = "SELECT {0} FROM SC_USER_COL A " & _
           "WHERE {1} AND A.COL_USE_YN=1  ORDER BY A.COL_COLUMN_ID"
        ''''strSQL 문을 만들어 준다.
        strSQL = String.Format(strFormat, strFields, strKeys)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , False)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".getTABCOLINFO")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    'Public Function DataValidation(ByVal vntData As Object, _
    '                               ByVal strTAB_NAME As String, _
    '                               ByVal strCOL_NAME As String, _
    '                               ByVal vntData_DATATYPE As Object, _
    '                               ByVal intColCnt As String, _
    '                               ByRef intRows As Integer, _
    '                               ByRef strERR As String, _
    '                               ByRef strMEDCODE As String, _
    '                               ByRef strREALMEDCODE As String, _
    '                               ByRef strMEDCODENAME As String) As Integer
    '    Dim strSQL As String
    '    Dim strFormet, strSelFields, strWhere As String
    '    Dim strChkDate As String = ""
    '    Dim i
    '    Dim strArray
    '    Dim intNo
    '    Dim Rowcnt
    '    Dim Colcnt
    '    Dim codechk
    '    'Dim strMEDCODENAME
    '    Dim strMedAndReal
    '    DataValidation = False
    '    strArray = strCOL_NAME.Split("|")
    '    intNo = UBound(strArray)

    '    For i = 0 To intNo
    '        If strArray(i) = "MEDCODENAME" Then
    '            If Len(GetElement(vntData, "MEDCODENAME", intColCnt, intRows)) > 255 Then
    '                strERR = "매체사자릿수"
    '                Exit Function
    '            End If
    '            Rowcnt = 0
    '            Colcnt = 0
    '            'strMEDCODENAME = GetElement(vntData, "MEDCODENAME", intColCnt, intRows)
    '            strMedAndReal = DataValidation_Code(Rowcnt, Colcnt, strMEDCODENAME, "MED")
    '            If Rowcnt = 0 Then
    '                strERR = "매체사오류"
    '                Exit Function
    '            Else
    '                If IsArray(strMedAndReal) Then
    '                    strERR = ""
    '                    strMEDCODE = strMedAndReal(0, 0)
    '                    strREALMEDCODE = strMedAndReal(1, 0)
    '                End If
    '            End If
    '        ElseIf strArray(i) = "PROGRAM" Then
    '            If GetElement(vntData, "PROGRAM", intColCnt, intRows) <> "" Then
    '                If Len(GetElement(vntData, "PROGRAM", intColCnt, intRows)) > 255 Then
    '                    strERR = "소재명자릿수"
    '                    Exit Function
    '                End If
    '            End If
    '        ElseIf strArray(i) = "BRDTIME_TEMP" Then
    '            If GetElement(vntData, "BRDTIME_TEMP", intColCnt, intRows) <> "" Then
    '                If Len(GetElement(vntData, "BRDTIME_TEMP", intColCnt, intRows)) <> 9 Then
    '                    strERR = "방영시간자릿수"
    '                    Exit Function
    '                End If
    '            End If
    '        ElseIf strArray(i) = "TYPHOUR" Then
    '            If GetElement(vntData, "TYPHOUR", intColCnt, intRows) <> "SSA" And GetElement(vntData, "TYPHOUR", intColCnt, intRows) <> "SA" And GetElement(vntData, "TYPHOUR", intColCnt, intRows) <> "A" And GetElement(vntData, "TYPHOUR", intColCnt, intRows) <> "B" And GetElement(vntData, "TYPHOUR", intColCnt, intRows) <> "C" Then
    '                strERR = "시급코드"
    '                Exit Function
    '            End If
    '        ElseIf strArray(i) = "CMLOCATION" Then
    '            If GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "전CM" And GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "후CM" And GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "중CM" And GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "전END" And GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "중TOP" And GetElement(vntData, "CMLOCATION", intColCnt, intRows) <> "후TOP" Then
    '                strERR = "CM위치내용"
    '                Exit Function
    '            End If

    '        End If
    '    Next
    '    DataValidation = True
    'End Function


    Public Function DataValidation_Code(ByRef intRowCnt As Integer, _
                                        ByRef intColCnt As Integer, _
                                        ByVal strCODE As String, _
                                        ByVal strFLAG As String) As Object 'XML

        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim strCUSTCODE

        With mobjSCGLConfig
            Try
                If strFLAG = "MED" Then
                    If strCODE <> "" Then strSQL = "select custcode, highcustcode From SC_CUST_TEMP WHERE CUSTNAME = '" & strCODE & "'"
                    vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                    Return vntData
                End If
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".DataValidation_Code")
            Finally
            End Try
        End With
    End Function


    Public Function ProcessRtn(ByVal strInfoXML As String, _
                               ByVal vntData As Object, _
                               ByVal strYEARMON As String, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByVal vntData_DATALength As Object, _
                               ByRef blnIDs As Boolean) As Integer

        Dim dblSEQ As Double
        Dim strERR
        Dim intRtn, intColCnt, intRows, i As Integer
        Dim strCLIENTCODE, strMEDCODE, strREALMEDCODE
        Dim strMEDCODENAME As String
        Dim strArray
        Dim intNo
        Dim Rowcnt
        Dim Colcnt
        Dim intCnt
        Dim strMedAndReal

        Try
            SetConfig(strInfoXML)   '기본정보 설정
            With mobjSCGLConfig

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)

                mobjceSC_EXCEL = New ceSC_EXCEL(strTAB_NAME, mobjSCGLConfig)

                For i = 1 To intRows
                    dblSEQ = SelectRtn_SEQ(strYEARMON)
                    strCLIENTCODE = GetElement(vntData, "CLIENTCODE", intColCnt, i)

                    intRtn = InsertRtn(vntData, strTAB_NAME, strCOL_NAME, vntData_DATATYPE, vntData_DATALength, intColCnt, i, strYEARMON, dblSEQ, strCLIENTCODE)
                Next

                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            End With
        Catch err As Exception
            mobjSCGLConfig.mobjSCGLSql.SQLRollbackTrans()
            Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn::" & i & " 번째 로우에서 에러가 발생")
        Finally
            mobjceSC_EXCEL.Dispose()
            mobjSCGLConfig.mobjSCGLSql.SQLDisconnect()
        End Try
    End Function

    'SEQ생성
    Public Function SelectRtn_SEQ(ByRef strYEARMON As String) As String
        '여기부터 단순조회
        Dim strSQL, strFormat, strRtn As String

        With mobjSCGLConfig '기본정보 Config 개체

            Try
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                strSQL = "select isnull(Max(SEQ),0) +1 From MD_CATV_MEDIUM WHERE YEARMON = '" & strYEARMON & "'"
                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)
                Return strRtn
            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_SEQ")
            Finally
                ' DB 접속 종료
                '.mobjSCGLSql.SQLDisconnect()
            End Try
        End With
        '여기까지 단순조회
    End Function


    '임시테이블에 저장...
    Private Function InsertRtn_TEMP(ByVal vntData As Object, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByVal intCol As Integer, _
                               ByVal intRow As Integer, _
                               ByVal strERR As String) As Integer

        Dim strSQL As String
        Dim strFields As String
        Dim strTempValue As String
        Dim strValues As String
        Dim strBldValues As New System.Text.StringBuilder

        Dim i As Integer
        Try
            For i = 1 To intCol
                If vntData(i, intRow).ToString = "" Then
                    strTempValue = "NULL"
                Else
                    Select Case vntData_DATATYPE(i - 1).ToString
                        Case "VARCHAR2"
                            strTempValue = "'" & Replace(vntData(i, intRow).ToString, "'", " ") & "'"
                        Case "NUMBER"
                            strTempValue = vntData(i, intRow).ToString
                            ' Case "DATE"
                            'strTempValue = "('" & vntData(i, intRow) & "','YYYY-MM-DD')"
                        Case Else
                            strTempValue = "'" & vntData(i, intRow).ToString & "'"
                    End Select
                End If
                If strERR <> "" And i = intCol Then
                    strTempValue = "'" & strERR & "'"
                End If

                strBldValues.Append(strTempValue & ",")
            Next
            strFields = strCOL_NAME.Replace("|", ",").TrimEnd(",")
            strValues = strBldValues.ToString.TrimEnd(",")
            strSQL = String.Format("INSERT INTO {0} ({1}) VALUES({2})", strTAB_NAME, strFields, strValues)
            mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)
        Catch err As Exception
            Throw RaiseSysErr(err, CLASS_NAME & strTAB_NAME & ".InsertDo")
        End Try
    End Function


    Private Function InsertRtn(ByVal vntData As Object, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByVal vntData_DATALength As Object, _
                               ByVal intCol As Integer, _
                               ByVal intRow As Integer, _
                               ByVal strYEARMON As String, _
                               ByVal dblSEQ As Double, _
                               ByVal strCLIENTCODE As String) As Integer

        Dim strSQL As String
        Dim strFields As String
        Dim strTempValue As String
        Dim strValues As String
        Dim strGETMEDCODE As Object
        Dim intcolcnt, introwcnt
        Dim strADLOCALFLAG
        Dim strSUBSEQ
        Dim strDEPT_CD
        Dim strUSERINFO
        Dim strBldValues As New System.Text.StringBuilder
        Dim i As Integer
        Try
            For i = 1 To intCol
                If vntData(i, intRow).ToString = "" Then
                    strTempValue = "NULL"
                Else
                    Select Case vntData_DATATYPE(i - 1).ToString
                        Case "VARCHAR2"
                            strTempValue = "'" & Replace(vntData(i, intRow).ToString, "'", " ") & "'"
                        Case "NUMBER"
                            strTempValue = Trim(vntData(i, intRow)).ToString
                            'Case "DATE"
                            '    strTempValue = "TO_DATE('" & vntData(i, intRow) & "','YYYY-MM-DD')"
                        Case Else
                            strTempValue = "'" & vntData(i, intRow).ToString & "'"
                    End Select
                End If

                strBldValues.Append(strTempValue & ",")
            Next

            '입력자EMPNO, 입력날자, 수정자EMPNO, 수정날자를 알맞는 형식으로 바꿔주기 위함..TO_DATE 때면에..
            Dim strFields2 As New System.Text.StringBuilder
            Dim strValues2 As New System.Text.StringBuilder
            Dim strNOW As String '데이트형의 처리는 변수를 받아 텍스트로 처리 한다.. 
            strNOW = Now

            BuildNameValues(",", "CUSER", mobjSCGLConfig.WRKUSR, strFields2, strValues2)
            BuildNameValues(",", "CDATE", strNOW, strFields2, strValues2)
            BuildNameValues(",", "UUSER", mobjSCGLConfig.WRKUSR, strFields2, strValues2)
            BuildNameValues(",", "UDATE", strNOW, strFields2, strValues2)


            strUSERINFO = String.Format("{0}", strValues2)

            strCOL_NAME = strCOL_NAME & "|YEARMON|SEQ|CUSER|CDATE|UUSER|UDATE"
            strFields = strCOL_NAME.Replace("|", ",").TrimEnd(",")
            strValues = strBldValues.ToString.TrimEnd(",")
            strValues = strValues & ",'" & strYEARMON & "'," & dblSEQ & "," & strUSERINFO
            strSQL = String.Format("INSERT INTO {0} ({1}) VALUES({2})", strTAB_NAME, strFields, strValues)
            mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)
        Catch err As Exception
            Throw RaiseSysErr(err, CLASS_NAME & strTAB_NAME & ".InsertDo")
        End Try
    End Function

    Private Sub BuildNameValues2(ByVal strDelimiter As String, _
                                 ByVal strValue As String, _
                                 ByVal strType As String, _
                                 ByRef strValueList As System.Text.StringBuilder)

        If strType = "VARCHAR2" Then
            strValue = "'" & strValue & "'"
        End If
        strValueList.Append(strValue & strDelimiter)
    End Sub

    Private Function UpdateRtn_SC_USER_COL(ByVal strYEARMON As String) As Integer
        Dim strSQL_1 As String
        Try
            strSQL_1 = "UPDATE SC_USER_COL SET COL_DEFAULT_VALUE = '" & strYEARMON & "' WHERE COL_USER_NAME = 'YEARMON' AND TAB_ID = '33'"

            mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL_1)

        Catch err As Exception
            Throw RaiseSysErr(err, CLASS_NAME & ".UpdateRtn_SC_USER_COL")
        End Try
    End Function

    Private Function Delete_Temp_Rtn()

        Dim strSQL As String
        Dim strFormet, strWhere As String
        Dim intRtn

        strFormet = "DELETE FROM {0} "

        strSQL = String.Format(strFormet, "MD_ELECTRIC_MEDIUM_TEMP")

        intRtn = mobjceSC_USER_COL.DeleteDo_TEMP(strSQL)
        Return intRtn
    End Function

    '광고주 매칭작업
    Public Function SelectRtn_CLIENTCODE(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strCLIENTCODE As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where medflag='A' AND CUSTCODE = '" & strCLIENTCODE & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTSUBCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    '사업부 매칭작업
    Public Function SelectRtn_SUBSEQ(ByVal strInfoXML As String, _
                                     ByRef intRowCnt As Integer, _
                                     ByRef intColCnt As Integer, _
                                     ByVal strCLIENTCODE As String, _
                                     ByVal strSUBSEQNAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "SELECT TOP 1 SEQNO, CUSTCODE, DEPTCD, CLIENTSUBCODE FROM SC_JOBCUST WHERE  CUSTCODE = '" & strCLIENTCODE & "'  and (RTRIM(LTrim(SEQNAME)) = '" & strSUBSEQNAME & "' or seqno='" & strSUBSEQNAME & "')"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTSUBCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

#End Region
End Class
