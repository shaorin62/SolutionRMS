'****************************************************************************************
'Generated By :::BELLWORLD Making Entity Bean Ver1.0:::
'시스템구분 : SFAR/시스템명/Server단 Entity Base Component
'실행  환경 : COM+ Service Server Package
'프로그램명 : ccSCEXCOM.vb (Table한글명 Entity 처리 Class)
'기      능 : Table한글명(영문명) Entity에 대해Insert/Update/Delete/Select를 처리
'특이  사항 : -특이사항에 대해 표현
'             -
'----------------------------------------------------------------------------------------
'HISTORY    :1) 2003-06-19 오후 2:35:59 By 작성자
'            2) 2003-06-19 오후 2:35:59 By 작성자 : 변경 내용 설명
'****************************************************************************************

Imports System.Xml                  'XML처리
Imports SCGLControl                 'ControlClass의 Base Class
Imports SCGLUtil.cbSCGLConfig       'ConfigurationClass
Imports SCGLUtil.cbSCGLErr          '오류처리클래스
Imports SCGLUtil.cbSCGLXml          'XML처리클래스
Imports SCGLUtil.cbSCGLUtil         '기타유틸리티 클래스
Imports eMDCO


Public Class ccSCEXCOM
    Inherits ccControl

#Region "GROUP BLOCk : 전역 또는 모듈레벨의 변수/상수 선언"
    Private CLASS_NAME = "ccSCEXCOM"         '자신의클래스명
    'Private Const .DBConnStr = "Provider=SQLOLEDB;Data Source=10.110.10.86;Initial Catalog=MCDEV;DSN=MCDEV;UID=devadmin;Pwd=password"  '커넥션Setting
    Dim mobjceSC_USER_COL As eMDCO.ceSC_USER_COL
    Dim mobjceSC_USER_TAB As eMDCO.ceSC_USER_TAB
    Dim mobjceSC_EXCEL As eMDCO.ceSC_EXCEL

#End Region

#Region "GROUP BLOCk : Property 선언"
#End Region

#Region "GROUP BLOCk : Event 선언"

    Public Function SelectRtn_CLIENTNAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strCLIENTNAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where medflag='A' and RTRIM(LTrim(custname)) = '" & strCLIENTNAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTNAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_REALMEDCODE(ByVal strInfoXML As String, _
                                              ByRef intRowCnt As Integer, _
                                              ByRef intColCnt As Integer, _
                                              ByVal strMEDCODE As String) As Object        'XML  데이터 조회시

        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData2 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select highcustcode from sc_cust_temp where RTRIM(LTrim(custcode)) = '" & strMEDCODE & "'"
                vntData2 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData2
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_REALMEDCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_MEDCODENAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strMEDCODENAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where medflag='B' and RTRIM(LTrim(custname)) = '" & strMEDCODENAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MEDCODENAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_PUBFACENAME(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strPUB_FACEENAME As String, _
                                         ByVal strFLAG As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                .mobjSCGLSql.SQLConnect(.DBConnStr)

                If strFLAG Then
                    strSQL = "select CODE from sc_code where class_code='MP_MP01' and CODE_NAME = '" & strPUB_FACEENAME & "'"
                Else
                    strSQL = "select CODE from sc_code where class_code='MP_MP02' and CODE_NAME = '" & strPUB_FACEENAME & "'"
                End If

                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MEDCODENAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_CODE(ByVal strInfoXML As String, _
                                   ByRef intRowCnt As Integer, _
                                   ByRef intColCnt As Integer, _
                                   ByVal strCLIENTCODE As String) As Object     'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData3 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "SELECT  TOP 1 SEQNO,DEPTCD FROM SC_JOBCUST  WHERE CUSTCODE = '" & strCLIENTCODE & "'"
                vntData3 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData3
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    '사업부 매칭작업
    Public Function SelectRtn_CLIENTCODE(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strCLIENTCODE As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode from sc_cust_temp where medflag='A' AND CUSTCODE = '" & strCLIENTCODE & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTSUBCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    '사업부 매칭작업
    Public Function SelectRtn_CLIENTSUBCODE(ByVal strInfoXML As String, _
                                            ByRef intRowCnt As Integer, _
                                            ByRef intColCnt As Integer, _
                                            ByVal strCLIENTCODE As String, _
                                            ByVal strCLIENTSUBNAME As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "select custcode, HIGHCUSTCODE from sc_cust_temp where 1=1 AND ATTR10=1 AND  medflag='A' AND HIGHCUSTCODE = '" & strCLIENTCODE & "'  and RTRIM(LTrim(custname)) = '" & strCLIENTSUBNAME & "'"
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CLIENTSUBCODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_PUBFACECODE(ByVal strInfoXML As String, _
                                         ByRef intRowCnt As Integer, _
                                         ByRef intColCnt As Integer, _
                                         ByVal strPUB_FACECODE As String, _
                                         ByVal strFLAG As String) As Object         'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정


                .mobjSCGLSql.SQLConnect(.DBConnStr)

                If strFLAG Then
                    strSQL = "select CODE from sc_code where class_code='MP_MP01' and CODE = '" & strPUB_FACECODE & "'"
                Else
                    strSQL = "select CODE from sc_code where class_code='MP_MP02' and CODE = '" & strPUB_FACECODE & "'"
                End If

                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_MEDCODENAME")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_DEPT_CD(ByVal strInfoXML As String, _
                                      ByRef intRowCnt As Integer, _
                                      ByRef intColCnt As Integer, _
                                      ByVal strDEPT_CD As String) As Object     'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData3 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "SELECT  CC_CODE FROM SC_CC  WHERE CC_CODE = '" & strDEPT_CD & "'"
                vntData3 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData3
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    Public Function SelectRtn_DEPT_NAME(ByVal strInfoXML As String, _
                                        ByRef intRowCnt As Integer, _
                                        ByRef intColCnt As Integer, _
                                        ByVal strDEPT_CD As String) As Object     'XML  데이터 조회시
        Dim strSQL As String
        Dim strFormet, strSelFields, strWhere As String
        Dim strChkDate As String = ""
        Dim vntData3 As Object
        Dim intRtn As Integer

        With mobjSCGLConfig
            Try
                SetConfig(strInfoXML)   '기본정보 설정

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                strSQL = "SELECT  CC_CODE FROM SC_CC  WHERE CC_NAME = '" & strDEPT_CD & "'"
                vntData3 = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
                Return vntData3
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_CODE")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function
#End Region

#Region "GROUP BLOCk : 외부에 공개 Method"
    Public Function getTABCOLINFO(ByVal strInfoXml As String, _
                                  ByRef intRowCnt As Integer, _
                                  ByRef intColCnt As Integer, _
                                  ByVal dblTAB_ID As Double, _
                                  ByVal strMED_FLAG As Double) As Object

        SetConfig(strInfoXml)   '모든Public 함수의 처음오는 기본정보 설정

        Dim vntData As Object     '''xmlData String
        Dim strFields As String   '''{0}번째 필드명
        Dim strKeys As String     '''{1}번째조건절
        Dim strFormat As String   '''Format을 맞추어 주는 String
        Dim strSQL As String      '''SQL 문을 만들어 주는 String

        ''''{0} 번째는 필드명으로한다.
        strFields = " A.TAB_ID, A.COL_NAME, A.COL_USER_NAME, A.COL_USE_YN, A.COL_DEFAULT_VALUE, A.COL_DATA_TYPE, A.COL_DATA_LENGTH, A.COL_COLUMN_ID, A.COL_NULLABLE "
        ''''{1} 번째는 WHERE 조건으로 한다.
        strKeys = BuildFields("AND", _
          GetFieldNameValue("A.TAB_ID", dblTAB_ID))
        ''''{1} 이후 또는 전에 필수적으로 들어가야할 SQL문장을 추가주거나 ORDER BY 절을 넣어준다.
        If strMED_FLAG Then
            strFormat = "SELECT {0} FROM SC_USER_COL A " & _
                        "WHERE {1} AND A.COL_USE_YN=1 AND COL_USER_NAME NOT IN('STD') ORDER BY A.COL_COLUMN_ID"
        Else
            strFormat = "SELECT {0} FROM SC_USER_COL A " & _
                        "WHERE {1} AND A.COL_USE_YN=1 AND COL_USER_NAME NOT IN('STD_CM') ORDER BY A.COL_COLUMN_ID"
        End If

        ''''strSQL 문을 만들어 준다.
        strSQL = String.Format(strFormat, strFields, strKeys)
        With mobjSCGLConfig
            Try
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt, , False)
                Return vntData
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".getTABCOLINFO")
            Finally
                .mobjSCGLSql.SQLDisconnect()
            End Try
        End With
    End Function

    'Public Function DataValidation(ByVal vntData As Object, _
    '                               ByVal strTAB_NAME As String, _
    '                               ByVal strCOL_NAME As String, _
    '                               ByVal vntData_DATATYPE As Object, _
    '                               ByVal intColCnt As String, _
    '                               ByRef intRows As Integer, _
    '                               ByRef strERR As String, _
    '                               ByRef strCUSTCODE As String, _
    '                               ByRef strMEDCODE As String, _
    '                               ByRef strREALMEDCODE As String, _
    '                               ByRef strSUBSEQ As String, _
    '                               ByRef strDEPT_CD As String, _
    '                               ByRef strCLIENTSUBCODE As String) As Integer

    '    Dim strSQL As String
    '    Dim strFormet, strSelFields, strWhere As String
    '    Dim strChkDate As String = ""
    '    Dim i
    '    Dim strArray
    '    Dim intNo
    '    Dim Rowcnt
    '    Dim Colcnt
    '    Dim codechk
    '    Dim strMedAndReal
    '    DataValidation = False
    '    strArray = strCOL_NAME.Split("|")
    '    intNo = UBound(strArray)


    '    For i = 0 To intNo
    '        If strArray(i) = "PUB_DATE" Then
    '            If Len(GetElement(vntData, "PUB_DATE", intColCnt, intRows)) = 0 Then
    '                strERR = "게재일자릿수"
    '                Exit Function
    '            End If
    '        ElseIf strArray(i) = "CLIENTCODE" Then
    '            If Len(GetElement(vntData, "CLIENTCODE", intColCnt, intRows)) <> 6 Then
    '                strERR = "광고주자릿수"
    '                Exit Function
    '            End If
    '            Rowcnt = 0
    '            Colcnt = 0
    '            strCUSTCODE = DataValidation_Code(Rowcnt, Colcnt, GetElement(vntData, "CLIENTCODE", intColCnt, intRows), "CUST")
    '            If strCUSTCODE = "" Then
    '                strERR = "광고주코드오류"
    '                Exit Function
    '            Else
    '                strSUBSEQ = GetClientSeq(strCUSTCODE)
    '                strDEPT_CD = GetDEPT_CODE(strSUBSEQ)
    '                'strCLIENTSUBCODE = GetClientSubSeq(strCUSTCODE)
    '                strCLIENTSUBCODE = strCUSTCODE

    '                If strSUBSEQ <> "" And strDEPT_CD <> "" Then
    '                    strERR = ""
    '                    strSUBSEQ = strSUBSEQ
    '                    strDEPT_CD = strDEPT_CD
    '                Else
    '                    If strSUBSEQ = "" Then
    '                        strERR = "시퀀스코드오류"
    '                        Exit Function
    '                    ElseIf strDEPT_CD = "" Then
    '                        strERR = "담당부서코드오류"
    '                        Exit Function
    '                    End If
    '                End If
    '                strERR = ""
    '            End If
    '        ElseIf strArray(i) = "MEDCODE" Then
    '            If Len(GetElement(vntData, "MEDCODE", intColCnt, intRows)) <> 6 Then
    '                strERR = "매체사자릿수"
    '                Exit Function
    '            End If
    '            Rowcnt = 0
    '            Colcnt = 0
    '            strMedAndReal = DataValidation_Code(Rowcnt, Colcnt, GetElement(vntData, "MEDCODE", intColCnt, intRows), "MED")
    '            If Rowcnt = 0 Then
    '                strERR = "매체사코드오류"
    '                Exit Function
    '            Else
    '                If IsArray(strMedAndReal) Then
    '                    strERR = ""
    '                    strREALMEDCODE = strMedAndReal(0, 0)
    '                End If
    '            End If
    '        ElseIf strArray(i) = "REAL_MED_CODE" Then
    '            If Len(GetElement(vntData, "REAL_MED_CODE", intColCnt, intRows)) <> 6 Then
    '                strERR = "매체명자릿수"
    '                Exit Function
    '            End If
    '            Rowcnt = 0
    '            Colcnt = 0
    '            codechk = DataValidation_Code(Rowcnt, Colcnt, GetElement(vntData, "REAL_MED_CODE", intColCnt, intRows), "REAL")
    '            If Rowcnt = 0 Then
    '                strERR = "매체명코드오류"
    '                Exit Function
    '            End If
    '        ElseIf strArray(i) = "MED_FLAG" Then
    '            If Len(GetElement(vntData, "MED_FLAG", intColCnt, intRows)) <> 4 Then
    '                strERR = "매체종류자릿수"
    '                Exit Function
    '            End If
    '            Rowcnt = 0
    '            Colcnt = 0
    '            codechk = DataValidation_Code(Rowcnt, Colcnt, GetElement(vntData, "MED_FLAG", intColCnt, intRows), "MED_FLAG")
    '            If Rowcnt = 0 Then
    '                strERR = "매체종류코드오류"
    '                Exit Function
    '            End If
    '        End If
    '    Next
    '    DataValidation = True
    'End Function

    'Public Function DataValidation_Code(ByRef intRowCnt As Integer, ByRef intColCnt As Integer, _
    '                            ByVal strCODE As String, _
    '                            ByVal strFLAG As String) As Object                                      'XML  데이터 조회시

    '    Dim strSQL As String
    '    Dim strFormet, strSelFields, strWhere As String
    '    Dim strChkDate As String = ""
    '    Dim vntData As Object
    '    Dim strCUSTCODE

    '    With mobjSCGLConfig
    '        Try
    '            'SetConfig(strInfoXML)   '기본정보 설정
    '            If strFLAG = "CUST" Then
    '                If strCODE <> "" Then strWhere = String.Format(" AND (CUSTCODE = '{0}')", strCODE)
    '                strFormet = "SELECT CUSTCODE FROM SC_CUST_TEMP WHERE 1=1 AND CUSTCODE LIKE 'A%' {0}"
    '                strSQL = String.Format(strFormet, strWhere)
    '                strCUSTCODE = .mobjSCGLSql.SQLSelectOneScalar(strSQL)
    '                Return strCUSTCODE
    '            ElseIf strFLAG = "MED" Then
    '                If strCODE <> "" Then strSQL = "select CASE highcustcode WHEN '' THEN '" & strCODE & "' ELSE highcustcode END  From SC_CUST_TEMP WHERE CUSTCODE = '" & strCODE & "'"
    '                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
    '                Return vntData
    '            ElseIf strFLAG = "REAL" Then
    '                If strCODE <> "" Then strWhere = String.Format(" AND (HIGHCUSTCODE = '{0}')", strCODE)
    '                strFormet = "SELECT CUSTCODE FROM SC_CUST_TEMP WHERE 1=1 AND HIGHCUSTCODE IS NOT NULL {0}"
    '                strSQL = String.Format(strFormet, strWhere)
    '                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
    '                Return vntData
    '            ElseIf strFLAG = "MED_FLAG" Then
    '                If strCODE <> "" Then strWhere = String.Format(" AND (CODE = '{0}')", strCODE)
    '                strFormet = "SELECT CODE FROM SC_CODE WHERE 1=1 AND CLASS_CODE = 'MP_KIND'  {0}"
    '                strSQL = String.Format(strFormet, strWhere)
    '                vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
    '                Return vntData
    '            End If

    '            '.mobjSCGLSql.SQLConnect(.DBConnStr)
    '            vntData = .mobjSCGLSql.SQLSelectArr(strSQL, intRowCnt, intColCnt)
    '            Return vntData
    '        Catch err As Exception
    '            Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn")
    '        Finally
    '            '.mobjSCGLSql.SQLDisconnect()
    '        End Try
    '    End With
    'End Function



    Public Function ProcessRtn(ByVal strInfoXML As String, _
                               ByVal vntData As Object, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByRef blnIDs As Boolean, _
                               ByRef strMED_FLAG As String) As Integer
        Dim dblID As Double
        Dim intRtn, intColCnt, intRows, i As Integer
        Dim strYEARMON
        Dim strERR
        Dim strSPONSOR
        Dim strAMOUNT
        Dim strCOMMISSION
        Dim strCOMMI_RATE
        Dim strSUBSEQCODE
        Dim strCUSTCODE, strMEDCODE, strREALMEDCODE
        Dim strSUBSEQ, strDEPT_CD
        Dim strMED_FLAGCODE
        Dim strLASTDATE
        Dim intRtnLastDate

        Try
            SetConfig(strInfoXML)   '기본정보 설정
            With mobjSCGLConfig
                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                intColCnt = UBound(vntData, 1) : intRows = UBound(vntData, 2)

                mobjceSC_EXCEL = New ceSC_EXCEL(strTAB_NAME, mobjSCGLConfig)

                If strMED_FLAG Then
                    strMED_FLAGCODE = "MP01"
                Else
                    strMED_FLAGCODE = "MP02"
                End If

                For i = 1 To intRows
                    strYEARMON = Replace(GetElement(vntData, "PUB_DATE", intColCnt, i, NULL_NUM, True), "-", "").Substring(0, 6)
                    dblID = SelectRtn_SEQ(strYEARMON)
                    strLASTDATE = ""
                    intRtnLastDate = DateLastDate(strYEARMON, strLASTDATE)
                    intRtn = InsertRtn(vntData, strTAB_NAME, strCOL_NAME, vntData_DATATYPE, intColCnt, i, dblID, strYEARMON, strMED_FLAGCODE, strLASTDATE)
                Next

                .mobjSCGLSql.SQLCommitTrans()
                Return intRows
            End With
        Catch err As Exception
            mobjSCGLConfig.mobjSCGLSql.SQLRollbackTrans()
            Throw RaiseSysErr(err, CLASS_NAME & ".ProcessRtn::" & i & " 번째 로우에서 에러가 발생")
        Finally
            mobjceSC_EXCEL.Dispose()
        End Try
    End Function

    '청구일세팅
    Public Function DateLastDate(ByRef strYEARMON As String, ByRef strLASTDATE As String)
        Dim date1
        Dim date2
        Dim strDATE

        strDATE = Mid(strYEARMON, 1, 4) & "-" & Mid(strYEARMON, 5, 2)
        date1 = Mid(strDATE, 1, 7) & "-01"
        date2 = DateAdd("d", -1, DateAdd("m", 1, date1))
        strLASTDATE = Replace(date2, "-", "")
    End Function

    Public Function Delete_Temp_Rtn(ByVal strInfoXML As String, _
                                    ByVal strYEARMON As String) As Integer

        Dim strSQL As String
        Dim strFormet, strWhere As String
        Dim intRtn
        Dim strPUBYEARMON

        SetConfig(strInfoXML)    '기본정보 Setting

        If strPUBYEARMON <> "" Then strWhere = String.Format(" AND (YEARMON = '{0}')", strPUBYEARMON) '년월

        With mobjSCGLConfig
            Try
                mobjceSC_USER_COL = New ceSC_USER_COL(mobjSCGLConfig)

                strFormet = "DELETE FROM {0} WHERE 1=1 {1}"
                strSQL = String.Format(strFormet, "MD_BOOKING_MEDIUM_TEMP", strWhere)

                .mobjSCGLSql.SQLConnect(.DBConnStr)
                .mobjSCGLSql.SQLBeginTrans()

                intRtn = mobjceSC_USER_COL.DeleteDo_TEMP(strSQL)

                .mobjSCGLSql.SQLCommitTrans()
                Return intRtn
            Catch err As Exception
                .mobjSCGLSql.SQLRollbackTrans()
                Throw RaiseSysErr(err, CLASS_NAME & "Delete_Temp_Rtn")
            Finally
                'DB접속 종료
                .mobjSCGLSql.SQLDisconnect()
                mobjceSC_USER_COL.Dispose()
            End Try
        End With
    End Function

    'SEQ생성
    Public Function SelectRtn_SEQ(ByRef strYEARMON As String) As String
        '여기부터 단순조회
        Dim strSQL, strFormat, strRtn As String

        With mobjSCGLConfig '기본정보 Config 개체

            Try
                ' ------ Array 데이터 조회 (True 일때 헤더정보 포함 조회(Sheet Data Binding 할 경우 사용), False 일때 데이터만 조회)
                strSQL = "select ISNULL(Max(SEQ),0) +1 From MD_BOOKING_MEDIUM WHERE YEARMON = '" & strYEARMON & "'"
                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)
                Return strRtn
            Catch err As Exception
                Throw RaiseSysErr(err, CLASS_NAME & ".SelectRtn_SEQ")
            Finally
            End Try
        End With
    End Function

    Private Function GetClientSubSeq(ByVal strCLIENTCODE As String) As String
        Dim strSQL, strFormat, strRtn As String

        With mobjSCGLConfig '기본정보 Config 개체
            Try ', highcustcode


                strSQL = "select top 1 CUSTCODE from SC_CUST_TEMP where 1=1 AND CUSTCODE LIKE 'A%' AND ATTR10 =1 AND (HIGHCUSTCODE like '%" & strCLIENTCODE & "%') ORDER BY"
                strSQL = strSQL & " CASE SUBSTRING(LTRIM(CUSTNAME),1,3) WHEN '(주)' THEN LTRIM(SUBSTRING(CUSTNAME,4,LEN(CUSTNAME))) "
                strSQL = strSQL & " WHEN '(사)' THEN LTRIM(SUBSTRING(CUSTNAME,4,LEN(CUSTNAME))) "
                strSQL = strSQL & " WHEN '(유)' THEN LTRIM(SUBSTRING(CUSTNAME,4,LEN(CUSTNAME))) "
                strSQL = strSQL & " WHEN '(재)' THEN LTRIM(SUBSTRING(CUSTNAME,4,LEN(CUSTNAME))) "
                strSQL = strSQL & " WHEN '(사단' THEN LTRIM(SUBSTRING(CUSTNAME,5,LEN(CUSTNAME))) "
                strSQL = strSQL & " WHEN '(학)' THEN LTRIM(SUBSTRING(CUSTNAME,4,LEN(CUSTNAME))) "
                strSQL = strSQL & " ELSE LTRIM(CUSTNAME) END "

                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)

                Return strRtn

            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".GetClientSubSeq")
            Finally
            End Try
        End With
    End Function

    Private Function GetClientSeq(ByVal strCLIENTCODE As String) As String
        Dim strSQL, strFormat, strRtn As String

        With mobjSCGLConfig '기본정보 Config 개체
            Try ', highcustcode
                strSQL = "select CASE DBO.SC_CUSTCODE_SEQCODE_FUN('" & strCLIENTCODE & "') WHEN '' THEN '' ELSE DBO.SC_CUSTCODE_SEQCODE_FUN('" & strCLIENTCODE & "') END"
                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)

                Return strRtn

            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".GetClientCode")
            Finally
            End Try
        End With
    End Function

    Private Function GetDEPT_CODE(ByVal strSUBSEQCODE As String) As String
        Dim strSQL, strFormat, strRtn As String

        With mobjSCGLConfig '기본정보 Config 개체
            Try ', highcustcode
                strSQL = "select CASE DBO.SC_SEQCODE_DEPTCD_FUN('" & strSUBSEQCODE & "') WHEN '' THEN '' ELSE DBO.SC_SEQCODE_DEPTCD_FUN('" & strSUBSEQCODE & "')  END"
                strRtn = .mobjSCGLSql.SQLSelectOneScalar(strSQL)

                Return strRtn

            Catch err As Exception
                ' 오류 전송
                Throw RaiseSysErr(err, CLASS_NAME & ".GetClientCode")
            Finally
            End Try
        End With
    End Function

    Private Function InsertRtn(ByVal vntData As Object, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByVal intCol As Integer, _
                               ByVal intRow As Integer, _
                               ByRef dblID As String, _
                               ByRef strYEARMON As String, _
                               ByRef strMED_FLAGCODE As String, _
                               ByRef strLASTDATE As String) As Integer
        Dim strSQL As String
        Dim strFields As String
        Dim strTempValue As String
        Dim strValues As String
        Dim strBldValues As New System.Text.StringBuilder
        Dim i As Integer
        Dim strEMPNO
        Dim strUSERINFO

        Dim strNOW As String '데이트형의 처리는 변수를 받아 텍스트로 처리 한다..   
        strNOW = Now


        '업로드하는 사용자의 EMPNO를 가져온다.
        strEMPNO = mobjSCGLConfig.WRKUSR

        Try
            For i = 1 To intCol
                If vntData(i, intRow).ToString = "" Then
                    strTempValue = "NULL"
                Else
                    Select Case vntData_DATATYPE(i - 1).ToString
                        Case "VARCHAR2"
                            strTempValue = "'" & Replace(vntData(i, intRow).ToString, "'", " ") & "'"
                        Case "NUMBER"
                            strTempValue = vntData(i, intRow).ToString
                        Case "DATE"
                            strTempValue = "TO_DATE('" & vntData(i, intRow) & "','YYYYMMDD')"
                        Case "DATE2"
                            strTempValue = "'" & Replace(vntData(i, intRow).ToString, "-", "") & "'"
                        Case "RATE"
                            strTempValue = Replace(vntData(i, intRow).ToString, "%", "")
                        Case Else
                            strTempValue = "'" & vntData(i, intRow).ToString & "'"
                    End Select
                End If

                strBldValues.Append(strTempValue & ",")
            Next
            '입력자EMPNO, 입력날자, 수정자EMPNO, 수정날자를 알맞는 형식으로 바꿔주기 위함..TO_DATE 때면에..
            Dim strFields2 As New System.Text.StringBuilder
            Dim strValues2 As New System.Text.StringBuilder

            BuildNameValues(",", "CUSER", mobjSCGLConfig.WRKUSR, strFields2, strValues2)
            BuildNameValues(",", "CDATE", strNOW, strFields2, strValues2)
            BuildNameValues(",", "UUSER", mobjSCGLConfig.WRKUSR, strFields2, strValues2)
            BuildNameValues(",", "UDATE", strNOW, strFields2, strValues2)

            strUSERINFO = String.Format("{0}", strValues2)

            strCOL_NAME = strCOL_NAME & "|SEQ|YEARMON|MED_FLAG|DEMANDDAY|GFLAG|TRU_TAX_FLAG|COMMI_TAX_FLAG|CUSER|CDATE|UUSER|UDATE"
            strFields = strCOL_NAME.Replace("|", ",").TrimEnd(",")
            strValues = strBldValues.ToString.TrimEnd(",")
            strValues = strValues & "," & dblID & ",'" & strYEARMON & "','" & strMED_FLAGCODE & "','" & strLASTDATE & "','M','Y','Y'," & strUSERINFO
            strSQL = String.Format("INSERT INTO {0} ({1}) VALUES({2})", strTAB_NAME, strFields, strValues)
            mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)
        Catch err As Exception
            Throw RaiseSysErr(err, CLASS_NAME & strTAB_NAME & ".InsertDo")
        End Try
    End Function

    Private Function InsertRtn_TEMP(ByVal vntData As Object, _
                               ByVal strTAB_NAME As String, _
                               ByVal strCOL_NAME As String, _
                               ByVal vntData_DATATYPE As Object, _
                               ByVal intCol As Integer, _
                               ByVal intRow As Integer, _
                               ByVal strERR As String) As Integer

        Dim strSQL As String
        Dim strFields As String
        Dim strTempValue As String
        Dim strValues As String
        Dim strBldValues As New System.Text.StringBuilder

        Dim i As Integer
        Try
            For i = 1 To intCol
                If vntData(i, intRow).ToString = "" Then
                    strTempValue = "NULL"
                Else
                    Select Case vntData_DATATYPE(i - 1).ToString
                        Case "VARCHAR2"
                            strTempValue = "'" & vntData(i, intRow).ToString & "'"
                        Case "NUMBER"
                            strTempValue = vntData(i, intRow).ToString
                        Case "DATE"
                            strTempValue = "TO_DATE('" & vntData(i, intRow) & "','YYYY-MM-DD')"
                        Case Else
                            strTempValue = "'" & vntData(i, intRow).ToString & "'"
                    End Select
                End If
                If strERR <> "" And i = intCol Then
                    strTempValue = "'" & strERR & "'"
                End If

                strBldValues.Append(strTempValue & ",")
            Next
            strFields = strCOL_NAME.Replace("|", ",").TrimEnd(",")
            strValues = strBldValues.ToString.TrimEnd(",")
            strSQL = String.Format("INSERT INTO {0} ({1}) VALUES({2})", strTAB_NAME, strFields, strValues)
            mobjSCGLConfig.mobjSCGLSql.SQLDo(strSQL)
        Catch err As Exception
            Throw RaiseSysErr(err, CLASS_NAME & strTAB_NAME & ".InsertDo")
        End Try
    End Function

    Private Sub BuildNameValues2(ByVal strDelimiter As String, _
                                 ByVal strValue As String, _
                                 ByVal strType As String, _
                                 ByRef strValueList As System.Text.StringBuilder)

        If strType = "VARCHAR2" Then
            strValue = "'" & strValue & "'"
        End If
        strValueList.Append(strValue & strDelimiter)
    End Sub

#End Region
End Class
